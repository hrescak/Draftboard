{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Users/matejhrescak/src/draftboard/src/components/ui/input.tsx"],"sourcesContent":["import * as React from \"react\";\nimport { cn } from \"~/lib/utils\";\n\nconst Input = React.forwardRef<HTMLInputElement, React.ComponentProps<\"input\">>(\n  ({ className, type, ...props }, ref) => {\n    return (\n      <input\n        type={type}\n        className={cn(\n          \"flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-base shadow-sm transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 md:text-sm\",\n          className\n        )}\n        ref={ref}\n        {...props}\n      />\n    );\n  }\n);\nInput.displayName = \"Input\";\n\nexport { Input };\n"],"names":[],"mappings":";;;;;AAAA;AACA;;;;AAEA,MAAM,sBAAQ,mNAAgB,CAC5B,CAAC,EAAE,SAAS,EAAE,IAAI,EAAE,GAAG,OAAO,EAAE;IAC9B,qBACE,8OAAC;QACC,MAAM;QACN,WAAW,IAAA,yHAAE,EACX,2WACA;QAEF,KAAK;QACJ,GAAG,KAAK;;;;;;AAGf;AAEF,MAAM,WAAW,GAAG","debugId":null}},
    {"offset": {"line": 32, "column": 0}, "map": {"version":3,"sources":["file:///Users/matejhrescak/src/draftboard/src/components/ui/badge.tsx"],"sourcesContent":["import * as React from \"react\";\nimport { cva, type VariantProps } from \"class-variance-authority\";\nimport { cn } from \"~/lib/utils\";\n\nconst badgeVariants = cva(\n  \"inline-flex items-center rounded-md border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2\",\n  {\n    variants: {\n      variant: {\n        default:\n          \"border-transparent bg-primary text-primary-foreground shadow hover:bg-primary/80\",\n        secondary:\n          \"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80\",\n        destructive:\n          \"border-transparent bg-destructive text-destructive-foreground shadow hover:bg-destructive/80\",\n        outline: \"text-foreground\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n);\n\nexport interface BadgeProps\n  extends React.HTMLAttributes<HTMLDivElement>,\n    VariantProps<typeof badgeVariants> {}\n\nfunction Badge({ className, variant, ...props }: BadgeProps) {\n  return (\n    <div className={cn(badgeVariants({ variant }), className)} {...props} />\n  );\n}\n\nexport { Badge, badgeVariants };\n"],"names":[],"mappings":";;;;;;;AACA;AACA;;;;AAEA,MAAM,gBAAgB,IAAA,uKAAG,EACvB,wKACA;IACE,UAAU;QACR,SAAS;YACP,SACE;YACF,WACE;YACF,aACE;YACF,SAAS;QACX;IACF;IACA,iBAAiB;QACf,SAAS;IACX;AACF;AAOF,SAAS,MAAM,EAAE,SAAS,EAAE,OAAO,EAAE,GAAG,OAAmB;IACzD,qBACE,8OAAC;QAAI,WAAW,IAAA,yHAAE,EAAC,cAAc;YAAE;QAAQ,IAAI;QAAa,GAAG,KAAK;;;;;;AAExE","debugId":null}},
    {"offset": {"line": 74, "column": 0}, "map": {"version":3,"sources":["file:///Users/matejhrescak/src/draftboard/src/components/ui/popover.tsx"],"sourcesContent":["\"use client\";\n\nimport * as React from \"react\";\nimport * as PopoverPrimitive from \"@radix-ui/react-popover\";\nimport { cn } from \"~/lib/utils\";\n\nconst Popover = PopoverPrimitive.Root;\n\nconst PopoverTrigger = PopoverPrimitive.Trigger;\n\nconst PopoverAnchor = PopoverPrimitive.Anchor;\n\nconst PopoverContent = React.forwardRef<\n  React.ElementRef<typeof PopoverPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof PopoverPrimitive.Content>\n>(({ className, align = \"center\", sideOffset = 4, ...props }, ref) => (\n  <PopoverPrimitive.Portal>\n    <PopoverPrimitive.Content\n      ref={ref}\n      align={align}\n      sideOffset={sideOffset}\n      className={cn(\n        \"z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2\",\n        className\n      )}\n      {...props}\n    />\n  </PopoverPrimitive.Portal>\n));\nPopoverContent.displayName = PopoverPrimitive.Content.displayName;\n\nexport { Popover, PopoverTrigger, PopoverContent, PopoverAnchor };\n"],"names":[],"mappings":";;;;;;;;;;;AAEA;AACA;AACA;AAJA;;;;;AAMA,MAAM,UAAU,2KAAqB;AAErC,MAAM,iBAAiB,8KAAwB;AAE/C,MAAM,gBAAgB,6KAAuB;AAE7C,MAAM,+BAAiB,mNAAgB,CAGrC,CAAC,EAAE,SAAS,EAAE,QAAQ,QAAQ,EAAE,aAAa,CAAC,EAAE,GAAG,OAAO,EAAE,oBAC5D,8OAAC,6KAAuB;kBACtB,cAAA,8OAAC,8KAAwB;YACvB,KAAK;YACL,OAAO;YACP,YAAY;YACZ,WAAW,IAAA,yHAAE,EACX,8aACA;YAED,GAAG,KAAK;;;;;;;;;;;AAIf,eAAe,WAAW,GAAG,8KAAwB,CAAC,WAAW","debugId":null}},
    {"offset": {"line": 119, "column": 0}, "map": {"version":3,"sources":["file:///Users/matejhrescak/src/draftboard/src/components/editor/nodes/MentionNode.tsx"],"sourcesContent":["import {\n  type DOMConversionMap,\n  type DOMExportOutput,\n  type EditorConfig,\n  type LexicalNode,\n  type NodeKey,\n  type SerializedTextNode,\n  type Spread,\n  TextNode,\n} from \"lexical\";\n\nexport type MentionType = \"user\" | \"project\";\n\nexport type SerializedMentionNode = Spread<\n  {\n    mentionType: MentionType;\n    mentionId: string;\n    mentionName: string;\n  },\n  SerializedTextNode\n>;\n\nexport class MentionNode extends TextNode {\n  __mentionType: MentionType;\n  __mentionId: string;\n  __mentionName: string;\n\n  static getType(): string {\n    return \"mention\";\n  }\n\n  static clone(node: MentionNode): MentionNode {\n    return new MentionNode(\n      node.__mentionType,\n      node.__mentionId,\n      node.__mentionName,\n      node.__key\n    );\n  }\n\n  constructor(\n    mentionType: MentionType,\n    mentionId: string,\n    mentionName: string,\n    key?: NodeKey\n  ) {\n    super(`@${mentionName}`, key);\n    this.__mentionType = mentionType;\n    this.__mentionId = mentionId;\n    this.__mentionName = mentionName;\n  }\n\n  createDOM(config: EditorConfig): HTMLElement {\n    const element = super.createDOM(config);\n    element.className = \"mention\";\n    element.setAttribute(\"data-mention-type\", this.__mentionType);\n    element.setAttribute(\"data-mention-id\", this.__mentionId);\n    return element;\n  }\n\n  exportDOM(): DOMExportOutput {\n    const element = document.createElement(\"span\");\n    element.className = \"mention\";\n    element.setAttribute(\"data-mention-type\", this.__mentionType);\n    element.setAttribute(\"data-mention-id\", this.__mentionId);\n    element.textContent = `@${this.__mentionName}`;\n    return { element };\n  }\n\n  static importDOM(): DOMConversionMap | null {\n    return {\n      span: (domNode: HTMLElement) => {\n        if (!domNode.classList.contains(\"mention\")) {\n          return null;\n        }\n        return {\n          conversion: (element) => {\n            const mentionType =\n              (element.getAttribute(\"data-mention-type\") as MentionType) ||\n              \"user\";\n            const mentionId = element.getAttribute(\"data-mention-id\") || \"\";\n            const mentionName =\n              element.textContent?.replace(\"@\", \"\") || \"\";\n            return {\n              node: $createMentionNode(mentionType, mentionId, mentionName),\n            };\n          },\n          priority: 1,\n        };\n      },\n    };\n  }\n\n  static importJSON(serializedNode: SerializedMentionNode): MentionNode {\n    return $createMentionNode(\n      serializedNode.mentionType,\n      serializedNode.mentionId,\n      serializedNode.mentionName\n    );\n  }\n\n  exportJSON(): SerializedMentionNode {\n    return {\n      ...super.exportJSON(),\n      type: \"mention\",\n      mentionType: this.__mentionType,\n      mentionId: this.__mentionId,\n      mentionName: this.__mentionName,\n    };\n  }\n\n  getMentionType(): MentionType {\n    return this.__mentionType;\n  }\n\n  getMentionId(): string {\n    return this.__mentionId;\n  }\n\n  getMentionName(): string {\n    return this.__mentionName;\n  }\n\n  canInsertTextBefore(): boolean {\n    return false;\n  }\n\n  canInsertTextAfter(): boolean {\n    return false;\n  }\n\n  isTextEntity(): boolean {\n    return true;\n  }\n}\n\nexport function $createMentionNode(\n  mentionType: MentionType,\n  mentionId: string,\n  mentionName: string\n): MentionNode {\n  return new MentionNode(mentionType, mentionId, mentionName).setMode(\"token\");\n}\n\nexport function $isMentionNode(\n  node: LexicalNode | null | undefined\n): node is MentionNode {\n  return node instanceof MentionNode;\n}\n"],"names":[],"mappings":";;;;;;;;AAAA;;AAsBO,MAAM,oBAAoB,sJAAQ;IACvC,cAA2B;IAC3B,YAAoB;IACpB,cAAsB;IAEtB,OAAO,UAAkB;QACvB,OAAO;IACT;IAEA,OAAO,MAAM,IAAiB,EAAe;QAC3C,OAAO,IAAI,YACT,KAAK,aAAa,EAClB,KAAK,WAAW,EAChB,KAAK,aAAa,EAClB,KAAK,KAAK;IAEd;IAEA,YACE,WAAwB,EACxB,SAAiB,EACjB,WAAmB,EACnB,GAAa,CACb;QACA,KAAK,CAAC,CAAC,CAAC,EAAE,aAAa,EAAE;QACzB,IAAI,CAAC,aAAa,GAAG;QACrB,IAAI,CAAC,WAAW,GAAG;QACnB,IAAI,CAAC,aAAa,GAAG;IACvB;IAEA,UAAU,MAAoB,EAAe;QAC3C,MAAM,UAAU,KAAK,CAAC,UAAU;QAChC,QAAQ,SAAS,GAAG;QACpB,QAAQ,YAAY,CAAC,qBAAqB,IAAI,CAAC,aAAa;QAC5D,QAAQ,YAAY,CAAC,mBAAmB,IAAI,CAAC,WAAW;QACxD,OAAO;IACT;IAEA,YAA6B;QAC3B,MAAM,UAAU,SAAS,aAAa,CAAC;QACvC,QAAQ,SAAS,GAAG;QACpB,QAAQ,YAAY,CAAC,qBAAqB,IAAI,CAAC,aAAa;QAC5D,QAAQ,YAAY,CAAC,mBAAmB,IAAI,CAAC,WAAW;QACxD,QAAQ,WAAW,GAAG,CAAC,CAAC,EAAE,IAAI,CAAC,aAAa,EAAE;QAC9C,OAAO;YAAE;QAAQ;IACnB;IAEA,OAAO,YAAqC;QAC1C,OAAO;YACL,MAAM,CAAC;gBACL,IAAI,CAAC,QAAQ,SAAS,CAAC,QAAQ,CAAC,YAAY;oBAC1C,OAAO;gBACT;gBACA,OAAO;oBACL,YAAY,CAAC;wBACX,MAAM,cACJ,AAAC,QAAQ,YAAY,CAAC,wBACtB;wBACF,MAAM,YAAY,QAAQ,YAAY,CAAC,sBAAsB;wBAC7D,MAAM,cACJ,QAAQ,WAAW,EAAE,QAAQ,KAAK,OAAO;wBAC3C,OAAO;4BACL,MAAM,mBAAmB,aAAa,WAAW;wBACnD;oBACF;oBACA,UAAU;gBACZ;YACF;QACF;IACF;IAEA,OAAO,WAAW,cAAqC,EAAe;QACpE,OAAO,mBACL,eAAe,WAAW,EAC1B,eAAe,SAAS,EACxB,eAAe,WAAW;IAE9B;IAEA,aAAoC;QAClC,OAAO;YACL,GAAG,KAAK,CAAC,YAAY;YACrB,MAAM;YACN,aAAa,IAAI,CAAC,aAAa;YAC/B,WAAW,IAAI,CAAC,WAAW;YAC3B,aAAa,IAAI,CAAC,aAAa;QACjC;IACF;IAEA,iBAA8B;QAC5B,OAAO,IAAI,CAAC,aAAa;IAC3B;IAEA,eAAuB;QACrB,OAAO,IAAI,CAAC,WAAW;IACzB;IAEA,iBAAyB;QACvB,OAAO,IAAI,CAAC,aAAa;IAC3B;IAEA,sBAA+B;QAC7B,OAAO;IACT;IAEA,qBAA8B;QAC5B,OAAO;IACT;IAEA,eAAwB;QACtB,OAAO;IACT;AACF;AAEO,SAAS,mBACd,WAAwB,EACxB,SAAiB,EACjB,WAAmB;IAEnB,OAAO,IAAI,YAAY,aAAa,WAAW,aAAa,OAAO,CAAC;AACtE;AAEO,SAAS,eACd,IAAoC;IAEpC,OAAO,gBAAgB;AACzB","debugId":null}},
    {"offset": {"line": 223, "column": 0}, "map": {"version":3,"sources":["file:///Users/matejhrescak/src/draftboard/src/components/editor/nodes/ImageNode.tsx"],"sourcesContent":["import * as React from \"react\";\nimport {\n  type DOMConversionMap,\n  type DOMExportOutput,\n  type EditorConfig,\n  type LexicalNode,\n  type NodeKey,\n  type SerializedLexicalNode,\n  type Spread,\n  DecoratorNode,\n} from \"lexical\";\nimport { Suspense } from \"react\";\n\nexport type SerializedImageNode = Spread<\n  {\n    src: string;\n    altText: string;\n    width?: number;\n    height?: number;\n    caption?: string;\n  },\n  SerializedLexicalNode\n>;\n\nfunction ImageComponent({\n  src,\n  altText,\n  width,\n  height,\n}: {\n  src: string;\n  altText: string;\n  width?: number;\n  height?: number;\n}) {\n  return (\n    <div className=\"my-4\">\n      <img\n        src={src}\n        alt={altText}\n        width={width}\n        height={height}\n        className=\"max-w-full rounded-lg\"\n        loading=\"lazy\"\n      />\n    </div>\n  );\n}\n\nexport class ImageNode extends DecoratorNode<React.ReactElement> {\n  __src: string;\n  __altText: string;\n  __width?: number;\n  __height?: number;\n  __caption?: string;\n\n  static getType(): string {\n    return \"image\";\n  }\n\n  static clone(node: ImageNode): ImageNode {\n    return new ImageNode(\n      node.__src,\n      node.__altText,\n      node.__width,\n      node.__height,\n      node.__caption,\n      node.__key\n    );\n  }\n\n  constructor(\n    src: string,\n    altText: string,\n    width?: number,\n    height?: number,\n    caption?: string,\n    key?: NodeKey\n  ) {\n    super(key);\n    this.__src = src;\n    this.__altText = altText;\n    this.__width = width;\n    this.__height = height;\n    this.__caption = caption;\n  }\n\n  createDOM(_config: EditorConfig): HTMLElement {\n    const div = document.createElement(\"div\");\n    div.className = \"editor-image\";\n    return div;\n  }\n\n  updateDOM(): false {\n    return false;\n  }\n\n  exportDOM(): DOMExportOutput {\n    const element = document.createElement(\"img\");\n    element.setAttribute(\"src\", this.__src);\n    element.setAttribute(\"alt\", this.__altText);\n    if (this.__width) {\n      element.setAttribute(\"width\", this.__width.toString());\n    }\n    if (this.__height) {\n      element.setAttribute(\"height\", this.__height.toString());\n    }\n    return { element };\n  }\n\n  static importDOM(): DOMConversionMap | null {\n    return {\n      img: () => ({\n        conversion: (domNode: HTMLElement) => {\n          const img = domNode as HTMLImageElement;\n          const node = $createImageNode({\n            src: img.src,\n            altText: img.alt,\n            width: img.width || undefined,\n            height: img.height || undefined,\n          });\n          return { node };\n        },\n        priority: 0,\n      }),\n    };\n  }\n\n  static importJSON(serializedNode: SerializedImageNode): ImageNode {\n    return $createImageNode({\n      src: serializedNode.src,\n      altText: serializedNode.altText,\n      width: serializedNode.width,\n      height: serializedNode.height,\n      caption: serializedNode.caption,\n    });\n  }\n\n  exportJSON(): SerializedImageNode {\n    return {\n      type: \"image\",\n      version: 1,\n      src: this.__src,\n      altText: this.__altText,\n      width: this.__width,\n      height: this.__height,\n      caption: this.__caption,\n    };\n  }\n\n  getSrc(): string {\n    return this.__src;\n  }\n\n  getAltText(): string {\n    return this.__altText;\n  }\n\n  decorate(): React.ReactElement {\n    return (\n      <Suspense fallback={null}>\n        <ImageComponent\n          src={this.__src}\n          altText={this.__altText}\n          width={this.__width}\n          height={this.__height}\n        />\n      </Suspense>\n    );\n  }\n\n  isInline(): boolean {\n    return false;\n  }\n\n  isKeyboardSelectable(): boolean {\n    return true;\n  }\n}\n\nexport function $createImageNode({\n  src,\n  altText,\n  width,\n  height,\n  caption,\n}: {\n  src: string;\n  altText: string;\n  width?: number;\n  height?: number;\n  caption?: string;\n}): ImageNode {\n  return new ImageNode(src, altText, width, height, caption);\n}\n\nexport function $isImageNode(\n  node: LexicalNode | null | undefined\n): node is ImageNode {\n  return node instanceof ImageNode;\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 381, "column": 0}, "map": {"version":3,"sources":["file:///Users/matejhrescak/src/draftboard/src/components/editor/nodes/AttachmentNode.tsx"],"sourcesContent":["\"use client\";\n\nimport * as React from \"react\";\nimport {\n  type DOMExportOutput,\n  type EditorConfig,\n  type LexicalNode,\n  type NodeKey,\n  type SerializedLexicalNode,\n  type Spread,\n  DecoratorNode,\n} from \"lexical\";\nimport { Suspense, useEffect, useState } from \"react\";\nimport { FileIcon, Download, Play, ExternalLink, Loader2 } from \"lucide-react\";\nimport { api } from \"~/lib/trpc/client\";\n\nexport type AttachmentType = \"IMAGE\" | \"VIDEO\" | \"FILE\" | \"FIGMA\" | \"LOOM\";\n\nexport type SerializedAttachmentNode = Spread<\n  {\n    attachmentType: AttachmentType;\n    url: string;\n    filename: string;\n    mimeType: string;\n    size: number;\n    thumbnailUrl?: string;\n    width?: number;\n    height?: number;\n    metadata?: Record<string, unknown>;\n  },\n  SerializedLexicalNode\n>;\n\nfunction formatFileSize(bytes: number): string {\n  if (bytes < 1024) return `${bytes} B`;\n  if (bytes < 1024 * 1024) return `${(bytes / 1024).toFixed(1)} KB`;\n  return `${(bytes / (1024 * 1024)).toFixed(1)} MB`;\n}\n\n// Extract R2 key from URL if it's an R2 URL\nfunction extractR2Key(url: string): string | null {\n  // Match patterns like:\n  // https://bucket.accountid.r2.cloudflarestorage.com/uploads/userid/timestamp-filename\n  // https://custom-domain.com/uploads/userid/timestamp-filename\n  const match = url.match(/uploads\\/[^\\/]+\\/[^\\/]+$/);\n  if (match) {\n    return match[0];\n  }\n  return null;\n}\n\nfunction AttachmentComponent({\n  attachmentType,\n  url,\n  filename,\n  mimeType,\n  size,\n  thumbnailUrl,\n  width,\n  height,\n}: {\n  attachmentType: AttachmentType;\n  url: string;\n  filename: string;\n  mimeType: string;\n  size: number;\n  thumbnailUrl?: string;\n  width?: number;\n  height?: number;\n}) {\n  const [displayUrl, setDisplayUrl] = useState<string | null>(null);\n  const [isLoading, setIsLoading] = useState(true);\n  const [error, setError] = useState<string | null>(null);\n\n  const r2Key = extractR2Key(url);\n  const { data: signedUrlData, isLoading: isLoadingUrl, error: urlError } = api.upload.getDownloadUrl.useQuery(\n    { key: r2Key! },\n    {\n      enabled: !!r2Key && (attachmentType === \"IMAGE\" || attachmentType === \"VIDEO\"),\n      staleTime: 30 * 60 * 1000, // Cache for 30 minutes (URL expires in 1 hour)\n      refetchOnWindowFocus: false,\n    }\n  );\n\n  useEffect(() => {\n    if (attachmentType !== \"IMAGE\" && attachmentType !== \"VIDEO\") {\n      // For non-media types, use original URL\n      setDisplayUrl(url);\n      setIsLoading(false);\n      return;\n    }\n\n    if (!r2Key) {\n      // If we can't extract a key, try using the URL directly\n      setDisplayUrl(url);\n      setIsLoading(false);\n      return;\n    }\n\n    if (signedUrlData) {\n      setDisplayUrl(signedUrlData.url);\n      setIsLoading(false);\n    } else if (urlError) {\n      // If signed URL fails, try original URL\n      setDisplayUrl(url);\n      setIsLoading(false);\n      setError(\"Could not load signed URL, trying direct URL\");\n    } else if (isLoadingUrl) {\n      setIsLoading(true);\n    }\n  }, [attachmentType, url, r2Key, signedUrlData, urlError, isLoadingUrl]);\n\n  if (attachmentType === \"IMAGE\") {\n    if (isLoading) {\n      return (\n        <div className=\"my-4 flex h-48 items-center justify-center rounded-lg bg-muted\">\n          <Loader2 className=\"h-6 w-6 animate-spin text-muted-foreground\" />\n        </div>\n      );\n    }\n\n    return (\n      <div className=\"my-4\">\n        <img\n          src={displayUrl || url}\n          alt={filename}\n          width={width}\n          height={height}\n          className=\"max-w-full rounded-lg\"\n          loading=\"lazy\"\n          onError={(e) => {\n            // If image fails to load, show error state\n            const target = e.target as HTMLImageElement;\n            target.style.display = 'none';\n            console.error(\"Image failed to load:\", displayUrl || url);\n          }}\n        />\n      </div>\n    );\n  }\n\n  if (attachmentType === \"VIDEO\") {\n    if (isLoading) {\n      return (\n        <div className=\"my-4 flex h-48 items-center justify-center rounded-lg bg-muted\">\n          <Loader2 className=\"h-6 w-6 animate-spin text-muted-foreground\" />\n        </div>\n      );\n    }\n\n    return (\n      <div className=\"my-4\">\n        <video\n          src={displayUrl || url}\n          poster={thumbnailUrl}\n          controls\n          className=\"max-w-full rounded-lg\"\n        >\n          <track kind=\"captions\" />\n        </video>\n      </div>\n    );\n  }\n\n  if (attachmentType === \"FIGMA\") {\n    return (\n      <a\n        href={url}\n        target=\"_blank\"\n        rel=\"noopener noreferrer\"\n        className=\"my-4 flex items-center gap-3 rounded-lg border border-border bg-card p-4 transition-colors hover:bg-muted\"\n      >\n        <div className=\"flex h-10 w-10 items-center justify-center rounded-lg bg-[#1e1e1e]\">\n          <svg viewBox=\"0 0 38 57\" className=\"h-6 w-6\" fill=\"none\">\n            <path\n              d=\"M19 28.5a9.5 9.5 0 1 1 19 0 9.5 9.5 0 0 1-19 0z\"\n              fill=\"#1ABCFE\"\n            />\n            <path\n              d=\"M0 47.5A9.5 9.5 0 0 1 9.5 38H19v9.5a9.5 9.5 0 1 1-19 0z\"\n              fill=\"#0ACF83\"\n            />\n            <path\n              d=\"M19 0v19h9.5a9.5 9.5 0 1 0 0-19H19z\"\n              fill=\"#FF7262\"\n            />\n            <path\n              d=\"M0 9.5A9.5 9.5 0 0 0 9.5 19H19V0H9.5A9.5 9.5 0 0 0 0 9.5z\"\n              fill=\"#F24E1E\"\n            />\n            <path\n              d=\"M0 28.5A9.5 9.5 0 0 0 9.5 38H19V19H9.5A9.5 9.5 0 0 0 0 28.5z\"\n              fill=\"#A259FF\"\n            />\n          </svg>\n        </div>\n        <div className=\"flex-1 overflow-hidden\">\n          <p className=\"truncate font-medium\">{filename}</p>\n          <p className=\"text-sm text-muted-foreground\">Figma Design</p>\n        </div>\n        <ExternalLink className=\"h-4 w-4 text-muted-foreground\" />\n      </a>\n    );\n  }\n\n  if (attachmentType === \"LOOM\") {\n    return (\n      <a\n        href={url}\n        target=\"_blank\"\n        rel=\"noopener noreferrer\"\n        className=\"my-4 flex items-center gap-3 rounded-lg border border-border bg-card p-4 transition-colors hover:bg-muted\"\n      >\n        <div className=\"flex h-10 w-10 items-center justify-center rounded-lg bg-[#625df5]\">\n          <Play className=\"h-5 w-5 fill-white text-white\" />\n        </div>\n        <div className=\"flex-1 overflow-hidden\">\n          <p className=\"truncate font-medium\">{filename}</p>\n          <p className=\"text-sm text-muted-foreground\">Loom Recording</p>\n        </div>\n        <ExternalLink className=\"h-4 w-4 text-muted-foreground\" />\n      </a>\n    );\n  }\n\n  // Generic file attachment - use signed URL for download\n  const downloadKey = extractR2Key(url);\n  const { data: downloadUrlData } = api.upload.getDownloadUrl.useQuery(\n    { key: downloadKey! },\n    {\n      enabled: !!downloadKey,\n      staleTime: 30 * 60 * 1000,\n      refetchOnWindowFocus: false,\n    }\n  );\n\n  return (\n    <a\n      href={downloadUrlData?.url || url}\n      download={filename}\n      className=\"my-4 flex items-center gap-3 rounded-lg border border-border bg-card p-4 transition-colors hover:bg-muted\"\n    >\n      <div className=\"flex h-10 w-10 items-center justify-center rounded-lg bg-muted\">\n        <FileIcon className=\"h-5 w-5 text-muted-foreground\" />\n      </div>\n      <div className=\"flex-1 overflow-hidden\">\n        <p className=\"truncate font-medium\">{filename}</p>\n        <p className=\"text-sm text-muted-foreground\">\n          {mimeType} Â· {formatFileSize(size)}\n        </p>\n      </div>\n      <Download className=\"h-4 w-4 text-muted-foreground\" />\n    </a>\n  );\n}\n\nexport class AttachmentNode extends DecoratorNode<React.ReactElement> {\n  __attachmentType: AttachmentType;\n  __url: string;\n  __filename: string;\n  __mimeType: string;\n  __size: number;\n  __thumbnailUrl?: string;\n  __width?: number;\n  __height?: number;\n  __metadata?: Record<string, unknown>;\n\n  static getType(): string {\n    return \"attachment\";\n  }\n\n  static clone(node: AttachmentNode): AttachmentNode {\n    return new AttachmentNode(\n      node.__attachmentType,\n      node.__url,\n      node.__filename,\n      node.__mimeType,\n      node.__size,\n      node.__thumbnailUrl,\n      node.__width,\n      node.__height,\n      node.__metadata,\n      node.__key\n    );\n  }\n\n  constructor(\n    attachmentType: AttachmentType,\n    url: string,\n    filename: string,\n    mimeType: string,\n    size: number,\n    thumbnailUrl?: string,\n    width?: number,\n    height?: number,\n    metadata?: Record<string, unknown>,\n    key?: NodeKey\n  ) {\n    super(key);\n    this.__attachmentType = attachmentType;\n    this.__url = url;\n    this.__filename = filename;\n    this.__mimeType = mimeType;\n    this.__size = size;\n    this.__thumbnailUrl = thumbnailUrl;\n    this.__width = width;\n    this.__height = height;\n    this.__metadata = metadata;\n  }\n\n  createDOM(_config: EditorConfig): HTMLElement {\n    const div = document.createElement(\"div\");\n    div.className = \"editor-attachment\";\n    return div;\n  }\n\n  updateDOM(): false {\n    return false;\n  }\n\n  exportDOM(): DOMExportOutput {\n    const element = document.createElement(\"div\");\n    element.setAttribute(\"data-attachment-type\", this.__attachmentType);\n    element.setAttribute(\"data-url\", this.__url);\n    element.setAttribute(\"data-filename\", this.__filename);\n    return { element };\n  }\n\n  static importJSON(serializedNode: SerializedAttachmentNode): AttachmentNode {\n    return $createAttachmentNode({\n      attachmentType: serializedNode.attachmentType,\n      url: serializedNode.url,\n      filename: serializedNode.filename,\n      mimeType: serializedNode.mimeType,\n      size: serializedNode.size,\n      thumbnailUrl: serializedNode.thumbnailUrl,\n      width: serializedNode.width,\n      height: serializedNode.height,\n      metadata: serializedNode.metadata,\n    });\n  }\n\n  exportJSON(): SerializedAttachmentNode {\n    return {\n      type: \"attachment\",\n      version: 1,\n      attachmentType: this.__attachmentType,\n      url: this.__url,\n      filename: this.__filename,\n      mimeType: this.__mimeType,\n      size: this.__size,\n      thumbnailUrl: this.__thumbnailUrl,\n      width: this.__width,\n      height: this.__height,\n      metadata: this.__metadata,\n    };\n  }\n\n  getUrl(): string {\n    return this.__url;\n  }\n\n  getFilename(): string {\n    return this.__filename;\n  }\n\n  decorate(): React.ReactElement {\n    return (\n      <Suspense fallback={<div className=\"my-4 h-48 animate-pulse rounded-lg bg-muted\" />}>\n        <AttachmentComponent\n          attachmentType={this.__attachmentType}\n          url={this.__url}\n          filename={this.__filename}\n          mimeType={this.__mimeType}\n          size={this.__size}\n          thumbnailUrl={this.__thumbnailUrl}\n          width={this.__width}\n          height={this.__height}\n        />\n      </Suspense>\n    );\n  }\n\n  isInline(): boolean {\n    return false;\n  }\n\n  isKeyboardSelectable(): boolean {\n    return true;\n  }\n}\n\nexport function $createAttachmentNode({\n  attachmentType,\n  url,\n  filename,\n  mimeType,\n  size,\n  thumbnailUrl,\n  width,\n  height,\n  metadata,\n}: {\n  attachmentType: AttachmentType;\n  url: string;\n  filename: string;\n  mimeType: string;\n  size: number;\n  thumbnailUrl?: string;\n  width?: number;\n  height?: number;\n  metadata?: Record<string, unknown>;\n}): AttachmentNode {\n  return new AttachmentNode(\n    attachmentType,\n    url,\n    filename,\n    mimeType,\n    size,\n    thumbnailUrl,\n    width,\n    height,\n    metadata\n  );\n}\n\nexport function $isAttachmentNode(\n  node: LexicalNode | null | undefined\n): node is AttachmentNode {\n  return node instanceof AttachmentNode;\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 909, "column": 0}, "map": {"version":3,"sources":["file:///Users/matejhrescak/src/draftboard/src/components/editor/plugins/MentionPlugin.tsx"],"sourcesContent":["\"use client\";\n\nimport { useCallback, useEffect, useMemo, useState } from \"react\";\nimport { useLexicalComposerContext } from \"@lexical/react/LexicalComposerContext\";\nimport {\n  LexicalTypeaheadMenuPlugin,\n  MenuOption,\n  useBasicTypeaheadTriggerMatch,\n} from \"@lexical/react/LexicalTypeaheadMenuPlugin\";\nimport { TextNode } from \"lexical\";\nimport { createPortal } from \"react-dom\";\nimport { $createMentionNode, type MentionType } from \"../nodes/MentionNode\";\nimport { api } from \"~/lib/trpc/client\";\nimport { Avatar, AvatarFallback, AvatarImage } from \"~/components/ui/avatar\";\nimport { getInitials } from \"~/lib/utils\";\nimport { FolderKanban, User } from \"lucide-react\";\n\nclass MentionOption extends MenuOption {\n  id: string;\n  name: string;\n  type: MentionType;\n  avatarUrl?: string | null;\n\n  constructor(\n    id: string,\n    name: string,\n    type: MentionType,\n    avatarUrl?: string | null\n  ) {\n    super(name);\n    this.id = id;\n    this.name = name;\n    this.type = type;\n    this.avatarUrl = avatarUrl;\n  }\n}\n\nfunction MentionMenuItem({\n  isSelected,\n  onClick,\n  onMouseEnter,\n  option,\n}: {\n  isSelected: boolean;\n  onClick: () => void;\n  onMouseEnter: () => void;\n  option: MentionOption;\n}) {\n  return (\n    <li\n      role=\"option\"\n      aria-selected={isSelected}\n      onClick={onClick}\n      onMouseEnter={onMouseEnter}\n      className={`flex cursor-pointer items-center gap-2 rounded-md px-2 py-1.5 text-sm ${\n        isSelected ? \"bg-accent text-accent-foreground\" : \"\"\n      }`}\n    >\n      {option.type === \"user\" ? (\n        <Avatar className=\"h-6 w-6\">\n          <AvatarImage src={option.avatarUrl ?? undefined} />\n          <AvatarFallback className=\"text-xs\">\n            {getInitials(option.name)}\n          </AvatarFallback>\n        </Avatar>\n      ) : (\n        <div className=\"flex h-6 w-6 items-center justify-center rounded-md bg-muted\">\n          <FolderKanban className=\"h-3.5 w-3.5\" />\n        </div>\n      )}\n      <span>{option.name}</span>\n      <span className=\"ml-auto text-xs text-muted-foreground\">\n        {option.type === \"user\" ? \"User\" : \"Project\"}\n      </span>\n    </li>\n  );\n}\n\nexport function MentionPlugin() {\n  const [editor] = useLexicalComposerContext();\n  const [queryString, setQueryString] = useState<string | null>(null);\n\n  const { data: users } = api.user.search.useQuery(\n    { query: queryString ?? \"\" },\n    { enabled: !!queryString && queryString.length > 0 }\n  );\n\n  const { data: projects } = api.project.search.useQuery(\n    { query: queryString ?? \"\" },\n    { enabled: !!queryString && queryString.length > 0 }\n  );\n\n  const checkForTriggerMatch = useBasicTypeaheadTriggerMatch(\"@\", {\n    minLength: 0,\n  });\n\n  const options = useMemo(() => {\n    const results: MentionOption[] = [];\n\n    if (users) {\n      results.push(\n        ...users.map(\n          (user) =>\n            new MentionOption(user.id, user.displayName, \"user\", user.avatarUrl)\n        )\n      );\n    }\n\n    if (projects) {\n      results.push(\n        ...projects.map(\n          (project) =>\n            new MentionOption(project.id, project.name, \"project\", project.coverUrl)\n        )\n      );\n    }\n\n    return results.slice(0, 10);\n  }, [users, projects]);\n\n  const onSelectOption = useCallback(\n    (\n      selectedOption: MentionOption,\n      nodeToReplace: TextNode | null,\n      closeMenu: () => void\n    ) => {\n      editor.update(() => {\n        const mentionNode = $createMentionNode(\n          selectedOption.type,\n          selectedOption.id,\n          selectedOption.name\n        );\n        if (nodeToReplace) {\n          nodeToReplace.replace(mentionNode);\n        }\n        mentionNode.select();\n        closeMenu();\n      });\n    },\n    [editor]\n  );\n\n  return (\n    <LexicalTypeaheadMenuPlugin<MentionOption>\n      onQueryChange={setQueryString}\n      onSelectOption={onSelectOption}\n      triggerFn={checkForTriggerMatch}\n      options={options}\n      menuRenderFn={(\n        anchorElementRef,\n        { selectedIndex, selectOptionAndCleanUp, setHighlightedIndex }\n      ) =>\n        anchorElementRef.current && options.length > 0\n          ? createPortal(\n              <div className=\"z-50 min-w-[200px] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md\">\n                <ul role=\"listbox\">\n                  {options.map((option, i) => (\n                    <MentionMenuItem\n                      key={option.id}\n                      isSelected={selectedIndex === i}\n                      onClick={() => {\n                        setHighlightedIndex(i);\n                        selectOptionAndCleanUp(option);\n                      }}\n                      onMouseEnter={() => {\n                        setHighlightedIndex(i);\n                      }}\n                      option={option}\n                    />\n                  ))}\n                </ul>\n              </div>,\n              anchorElementRef.current\n            )\n          : null\n      }\n    />\n  );\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 1099, "column": 0}, "map": {"version":3,"sources":["file:///Users/matejhrescak/src/draftboard/src/components/editor/plugins/SlashCommandPlugin.tsx"],"sourcesContent":["\"use client\";\n\nimport { useCallback, useEffect, useMemo, useState, useRef } from \"react\";\nimport { useLexicalComposerContext } from \"@lexical/react/LexicalComposerContext\";\nimport {\n  $createParagraphNode,\n  $getSelection,\n  $isRangeSelection,\n  COMMAND_PRIORITY_LOW,\n  KEY_ARROW_DOWN_COMMAND,\n  KEY_ARROW_UP_COMMAND,\n  KEY_ENTER_COMMAND,\n  KEY_ESCAPE_COMMAND,\n  KEY_TAB_COMMAND,\n  TextNode,\n} from \"lexical\";\nimport { $setBlocksType } from \"@lexical/selection\";\nimport { $createHeadingNode, $createQuoteNode } from \"@lexical/rich-text\";\nimport { INSERT_ORDERED_LIST_COMMAND, INSERT_UNORDERED_LIST_COMMAND } from \"@lexical/list\";\nimport { mergeRegister } from \"@lexical/utils\";\nimport { createPortal } from \"react-dom\";\nimport {\n  Heading1,\n  Heading2,\n  Heading3,\n  List,\n  ListOrdered,\n  Quote,\n  ImagePlus,\n  FileUp,\n} from \"lucide-react\";\nimport { $createAttachmentNode, type AttachmentType } from \"../nodes/AttachmentNode\";\nimport { api } from \"~/lib/trpc/client\";\n\ninterface CommandOption {\n  name: string;\n  command: string;\n  icon: React.ReactNode;\n  description: string;\n}\n\nconst COMMANDS: CommandOption[] = [\n  {\n    name: \"Heading 1\",\n    command: \"heading1\",\n    icon: <Heading1 className=\"h-4 w-4\" />,\n    description: \"Large section heading\",\n  },\n  {\n    name: \"Heading 2\",\n    command: \"heading2\",\n    icon: <Heading2 className=\"h-4 w-4\" />,\n    description: \"Medium section heading\",\n  },\n  {\n    name: \"Heading 3\",\n    command: \"heading3\",\n    icon: <Heading3 className=\"h-4 w-4\" />,\n    description: \"Small section heading\",\n  },\n  {\n    name: \"Bullet List\",\n    command: \"bulletList\",\n    icon: <List className=\"h-4 w-4\" />,\n    description: \"Create a bullet list\",\n  },\n  {\n    name: \"Numbered List\",\n    command: \"numberedList\",\n    icon: <ListOrdered className=\"h-4 w-4\" />,\n    description: \"Create a numbered list\",\n  },\n  {\n    name: \"Quote\",\n    command: \"quote\",\n    icon: <Quote className=\"h-4 w-4\" />,\n    description: \"Add a block quote\",\n  },\n  {\n    name: \"Image\",\n    command: \"image\",\n    icon: <ImagePlus className=\"h-4 w-4\" />,\n    description: \"Upload an image\",\n  },\n  {\n    name: \"File\",\n    command: \"file\",\n    icon: <FileUp className=\"h-4 w-4\" />,\n    description: \"Upload any file\",\n  },\n];\n\ninterface SlashCommandPluginProps {\n  anchorElem: HTMLElement;\n}\n\nexport function SlashCommandPlugin({ anchorElem }: SlashCommandPluginProps) {\n  const [editor] = useLexicalComposerContext();\n  const [isOpen, setIsOpen] = useState(false);\n  const [query, setQuery] = useState(\"\");\n  const [selectedIndex, setSelectedIndex] = useState(0);\n  const [position, setPosition] = useState({ top: 0, left: 0 });\n  const menuRef = useRef<HTMLDivElement>(null);\n  const fileInputRef = useRef<HTMLInputElement>(null);\n  const uploadMutation = api.upload.getUploadUrl.useMutation();\n  const pendingCommandRef = useRef<string | null>(null);\n\n  const filteredCommands = useMemo(() => {\n    if (!query) return COMMANDS;\n    const lowerQuery = query.toLowerCase();\n    return COMMANDS.filter(\n      (cmd) =>\n        cmd.name.toLowerCase().includes(lowerQuery) ||\n        cmd.description.toLowerCase().includes(lowerQuery) ||\n        cmd.command.toLowerCase().includes(lowerQuery)\n    );\n  }, [query]);\n\n  // Reset selected index when filtered commands change\n  useEffect(() => {\n    setSelectedIndex(0);\n  }, [filteredCommands.length]);\n\n  const handleFileUpload = useCallback(\n    async (file: File) => {\n      try {\n        const result = await uploadMutation.mutateAsync({\n          filename: file.name,\n          contentType: file.type,\n          size: file.size,\n        });\n\n        const uploadResponse = await fetch(result.uploadUrl, {\n          method: \"PUT\",\n          body: file,\n          headers: {\n            \"Content-Type\": file.type,\n          },\n        });\n\n        if (!uploadResponse.ok) {\n          const errorText = await uploadResponse.text();\n          console.error(\"R2 upload failed:\", uploadResponse.status, errorText);\n          alert(`Upload failed: ${uploadResponse.status} - ${errorText || \"Unknown error\"}`);\n          return;\n        }\n\n        let attachmentType: AttachmentType = \"FILE\";\n        if (file.type.startsWith(\"image/\")) {\n          attachmentType = \"IMAGE\";\n        } else if (file.type.startsWith(\"video/\")) {\n          attachmentType = \"VIDEO\";\n        }\n\n        editor.update(() => {\n          const selection = $getSelection();\n          if ($isRangeSelection(selection)) {\n            const attachmentNode = $createAttachmentNode({\n              attachmentType,\n              url: result.publicUrl,\n              filename: file.name,\n              mimeType: file.type,\n              size: file.size,\n            });\n            selection.insertNodes([attachmentNode, $createParagraphNode()]);\n          }\n        });\n      } catch (error) {\n        console.error(\"Upload failed:\", error);\n        alert(`Upload failed: ${error instanceof Error ? error.message : \"Unknown error\"}`);\n      }\n    },\n    [editor, uploadMutation]\n  );\n\n  const executeCommand = useCallback(\n    (command: string) => {\n      editor.update(() => {\n        const selection = $getSelection();\n        if (!$isRangeSelection(selection)) return;\n\n        // Remove the slash and query text\n        const anchor = selection.anchor;\n        const anchorNode = anchor.getNode();\n        if (anchorNode instanceof TextNode) {\n          const textContent = anchorNode.getTextContent();\n          const slashIndex = textContent.lastIndexOf(\"/\");\n          if (slashIndex !== -1) {\n            const newText = textContent.slice(0, slashIndex);\n            if (newText) {\n              anchorNode.setTextContent(newText);\n              selection.setTextNodeRange(anchorNode, newText.length, anchorNode, newText.length);\n            } else {\n              anchorNode.remove();\n            }\n          }\n        }\n\n        switch (command) {\n          case \"heading1\":\n            $setBlocksType(selection, () => $createHeadingNode(\"h1\"));\n            break;\n          case \"heading2\":\n            $setBlocksType(selection, () => $createHeadingNode(\"h2\"));\n            break;\n          case \"heading3\":\n            $setBlocksType(selection, () => $createHeadingNode(\"h3\"));\n            break;\n          case \"bulletList\":\n            editor.dispatchCommand(INSERT_UNORDERED_LIST_COMMAND, undefined);\n            break;\n          case \"numberedList\":\n            editor.dispatchCommand(INSERT_ORDERED_LIST_COMMAND, undefined);\n            break;\n          case \"quote\":\n            $setBlocksType(selection, () => $createQuoteNode());\n            break;\n          case \"image\":\n          case \"file\":\n            pendingCommandRef.current = command;\n            setTimeout(() => {\n              if (fileInputRef.current) {\n                fileInputRef.current.accept = command === \"image\" ? \"image/*,video/*\" : \"*/*\";\n                fileInputRef.current.click();\n              }\n            }, 0);\n            break;\n        }\n      });\n\n      setIsOpen(false);\n      setQuery(\"\");\n    },\n    [editor]\n  );\n\n  // Listen for text changes to detect slash commands\n  useEffect(() => {\n    return editor.registerTextContentListener((text) => {\n      editor.getEditorState().read(() => {\n        const selection = $getSelection();\n        if (!$isRangeSelection(selection)) {\n          setIsOpen(false);\n          return;\n        }\n\n        const anchor = selection.anchor;\n        const anchorNode = anchor.getNode();\n\n        if (!(anchorNode instanceof TextNode)) {\n          setIsOpen(false);\n          return;\n        }\n\n        const textContent = anchorNode.getTextContent();\n        const anchorOffset = anchor.offset;\n        const textBeforeCursor = textContent.slice(0, anchorOffset);\n\n        // Find the last slash in the text before cursor\n        const slashIndex = textBeforeCursor.lastIndexOf(\"/\");\n\n        if (slashIndex === -1) {\n          setIsOpen(false);\n          return;\n        }\n\n        // Check if slash is at start of line or preceded by whitespace\n        const charBeforeSlash = textBeforeCursor[slashIndex - 1];\n        if (slashIndex > 0 && charBeforeSlash !== \" \" && charBeforeSlash !== \"\\n\") {\n          setIsOpen(false);\n          return;\n        }\n\n        // Extract query after slash\n        const queryText = textBeforeCursor.slice(slashIndex + 1);\n\n        // Don't show menu if there's a space in the query (command ended)\n        if (queryText.includes(\" \")) {\n          setIsOpen(false);\n          return;\n        }\n\n        setQuery(queryText);\n        setIsOpen(true);\n\n        // Get position for menu\n        const domSelection = window.getSelection();\n        if (domSelection && domSelection.rangeCount > 0) {\n          const range = domSelection.getRangeAt(0);\n          const rect = range.getBoundingClientRect();\n          const editorRect = anchorElem.getBoundingClientRect();\n\n          setPosition({\n            top: rect.bottom - editorRect.top + 4,\n            left: rect.left - editorRect.left,\n          });\n        }\n      });\n    });\n  }, [editor, anchorElem]);\n\n  // Handle keyboard navigation\n  useEffect(() => {\n    if (!isOpen) return;\n\n    return mergeRegister(\n      editor.registerCommand(\n        KEY_ARROW_DOWN_COMMAND,\n        (event) => {\n          event.preventDefault();\n          setSelectedIndex((prev) =>\n            prev < filteredCommands.length - 1 ? prev + 1 : 0\n          );\n          return true;\n        },\n        COMMAND_PRIORITY_LOW\n      ),\n      editor.registerCommand(\n        KEY_ARROW_UP_COMMAND,\n        (event) => {\n          event.preventDefault();\n          setSelectedIndex((prev) =>\n            prev > 0 ? prev - 1 : filteredCommands.length - 1\n          );\n          return true;\n        },\n        COMMAND_PRIORITY_LOW\n      ),\n      editor.registerCommand(\n        KEY_ENTER_COMMAND,\n        (event) => {\n          if (filteredCommands[selectedIndex]) {\n            event?.preventDefault();\n            executeCommand(filteredCommands[selectedIndex].command);\n            return true;\n          }\n          return false;\n        },\n        COMMAND_PRIORITY_LOW\n      ),\n      editor.registerCommand(\n        KEY_TAB_COMMAND,\n        (event) => {\n          if (filteredCommands[selectedIndex]) {\n            event.preventDefault();\n            executeCommand(filteredCommands[selectedIndex].command);\n            return true;\n          }\n          return false;\n        },\n        COMMAND_PRIORITY_LOW\n      ),\n      editor.registerCommand(\n        KEY_ESCAPE_COMMAND,\n        () => {\n          setIsOpen(false);\n          setQuery(\"\");\n          return true;\n        },\n        COMMAND_PRIORITY_LOW\n      )\n    );\n  }, [editor, isOpen, filteredCommands, selectedIndex, executeCommand]);\n\n  // Click outside to close\n  useEffect(() => {\n    if (!isOpen) return;\n\n    const handleClickOutside = (event: MouseEvent) => {\n      if (menuRef.current && !menuRef.current.contains(event.target as Node)) {\n        setIsOpen(false);\n        setQuery(\"\");\n      }\n    };\n\n    document.addEventListener(\"mousedown\", handleClickOutside);\n    return () => document.removeEventListener(\"mousedown\", handleClickOutside);\n  }, [isOpen]);\n\n  return (\n    <>\n      <input\n        ref={fileInputRef}\n        type=\"file\"\n        className=\"hidden\"\n        onChange={(e) => {\n          const file = e.target.files?.[0];\n          if (file) {\n            handleFileUpload(file);\n          }\n          e.target.value = \"\";\n          pendingCommandRef.current = null;\n        }}\n      />\n      {isOpen && filteredCommands.length > 0 && createPortal(\n        <div\n          ref={menuRef}\n          className=\"absolute z-50 min-w-[280px] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md\"\n          style={{ top: position.top, left: position.left }}\n        >\n          <ul role=\"listbox\">\n            {filteredCommands.map((option, index) => (\n              <li\n                key={option.command}\n                role=\"option\"\n                aria-selected={selectedIndex === index}\n                onClick={() => executeCommand(option.command)}\n                onMouseEnter={() => setSelectedIndex(index)}\n                className={`flex cursor-pointer items-center gap-3 rounded-md px-2 py-2 text-sm ${\n                  selectedIndex === index ? \"bg-accent text-accent-foreground\" : \"\"\n                }`}\n              >\n                <div className=\"flex h-8 w-8 items-center justify-center rounded-md border bg-background\">\n                  {option.icon}\n                </div>\n                <div>\n                  <p className=\"font-medium\">{option.name}</p>\n                  <p className=\"text-xs text-muted-foreground\">{option.description}</p>\n                </div>\n              </li>\n            ))}\n          </ul>\n        </div>,\n        anchorElem\n      )}\n    </>\n  );\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 1562, "column": 0}, "map": {"version":3,"sources":["file:///Users/matejhrescak/src/draftboard/src/components/editor/plugins/DragDropPlugin.tsx"],"sourcesContent":["\"use client\";\n\nimport { useCallback, useEffect } from \"react\";\nimport { useLexicalComposerContext } from \"@lexical/react/LexicalComposerContext\";\nimport {\n  $getSelection,\n  $isRangeSelection,\n  $createParagraphNode,\n  COMMAND_PRIORITY_HIGH,\n  DROP_COMMAND,\n  DRAGOVER_COMMAND,\n} from \"lexical\";\nimport { $createAttachmentNode, type AttachmentType } from \"../nodes/AttachmentNode\";\nimport { api } from \"~/lib/trpc/client\";\n\nexport function DragDropPlugin() {\n  const [editor] = useLexicalComposerContext();\n  const uploadMutation = api.upload.getUploadUrl.useMutation();\n\n  const handleDrop = useCallback(\n    async (event: DragEvent) => {\n      const files = event.dataTransfer?.files;\n      if (!files || files.length === 0) return false;\n\n      event.preventDefault();\n\n      for (const file of Array.from(files)) {\n        try {\n          const result = await uploadMutation.mutateAsync({\n            filename: file.name,\n            contentType: file.type,\n            size: file.size,\n          });\n\n          // Upload to R2\n          await fetch(result.uploadUrl, {\n            method: \"PUT\",\n            body: file,\n            headers: {\n              \"Content-Type\": file.type,\n            },\n          });\n\n          // Determine attachment type\n          let attachmentType: AttachmentType = \"FILE\";\n          if (file.type.startsWith(\"image/\")) {\n            attachmentType = \"IMAGE\";\n          } else if (file.type.startsWith(\"video/\")) {\n            attachmentType = \"VIDEO\";\n          }\n\n          // Insert attachment node\n          editor.update(() => {\n            const selection = $getSelection();\n            if ($isRangeSelection(selection)) {\n              const attachmentNode = $createAttachmentNode({\n                attachmentType,\n                url: result.publicUrl,\n                filename: file.name,\n                mimeType: file.type,\n                size: file.size,\n              });\n              selection.insertNodes([attachmentNode, $createParagraphNode()]);\n            }\n          });\n        } catch (error) {\n          console.error(\"Upload failed:\", error);\n        }\n      }\n\n      return true;\n    },\n    [editor, uploadMutation]\n  );\n\n  useEffect(() => {\n    return editor.registerCommand(\n      DRAGOVER_COMMAND,\n      (event) => {\n        event.preventDefault();\n        return true;\n      },\n      COMMAND_PRIORITY_HIGH\n    );\n  }, [editor]);\n\n  useEffect(() => {\n    return editor.registerCommand(\n      DROP_COMMAND,\n      (event) => {\n        handleDrop(event);\n        return true;\n      },\n      COMMAND_PRIORITY_HIGH\n    );\n  }, [editor, handleDrop]);\n\n  return null;\n}\n"],"names":[],"mappings":";;;;AAEA;AACA;AACA;AAQA;AACA;AAbA;;;;;;AAeO,SAAS;IACd,MAAM,CAAC,OAAO,GAAG,IAAA,iMAAyB;IAC1C,MAAM,iBAAiB,mIAAG,CAAC,MAAM,CAAC,YAAY,CAAC,WAAW;IAE1D,MAAM,aAAa,IAAA,oNAAW,EAC5B,OAAO;QACL,MAAM,QAAQ,MAAM,YAAY,EAAE;QAClC,IAAI,CAAC,SAAS,MAAM,MAAM,KAAK,GAAG,OAAO;QAEzC,MAAM,cAAc;QAEpB,KAAK,MAAM,QAAQ,MAAM,IAAI,CAAC,OAAQ;YACpC,IAAI;gBACF,MAAM,SAAS,MAAM,eAAe,WAAW,CAAC;oBAC9C,UAAU,KAAK,IAAI;oBACnB,aAAa,KAAK,IAAI;oBACtB,MAAM,KAAK,IAAI;gBACjB;gBAEA,eAAe;gBACf,MAAM,MAAM,OAAO,SAAS,EAAE;oBAC5B,QAAQ;oBACR,MAAM;oBACN,SAAS;wBACP,gBAAgB,KAAK,IAAI;oBAC3B;gBACF;gBAEA,4BAA4B;gBAC5B,IAAI,iBAAiC;gBACrC,IAAI,KAAK,IAAI,CAAC,UAAU,CAAC,WAAW;oBAClC,iBAAiB;gBACnB,OAAO,IAAI,KAAK,IAAI,CAAC,UAAU,CAAC,WAAW;oBACzC,iBAAiB;gBACnB;gBAEA,yBAAyB;gBACzB,OAAO,MAAM,CAAC;oBACZ,MAAM,YAAY,IAAA,2JAAa;oBAC/B,IAAI,IAAA,+JAAiB,EAAC,YAAY;wBAChC,MAAM,iBAAiB,IAAA,gLAAqB,EAAC;4BAC3C;4BACA,KAAK,OAAO,SAAS;4BACrB,UAAU,KAAK,IAAI;4BACnB,UAAU,KAAK,IAAI;4BACnB,MAAM,KAAK,IAAI;wBACjB;wBACA,UAAU,WAAW,CAAC;4BAAC;4BAAgB,IAAA,kKAAoB;yBAAG;oBAChE;gBACF;YACF,EAAE,OAAO,OAAO;gBACd,QAAQ,KAAK,CAAC,kBAAkB;YAClC;QACF;QAEA,OAAO;IACT,GACA;QAAC;QAAQ;KAAe;IAG1B,IAAA,kNAAS,EAAC;QACR,OAAO,OAAO,eAAe,CAC3B,8JAAgB,EAChB,CAAC;YACC,MAAM,cAAc;YACpB,OAAO;QACT,GACA,mKAAqB;IAEzB,GAAG;QAAC;KAAO;IAEX,IAAA,kNAAS,EAAC;QACR,OAAO,OAAO,eAAe,CAC3B,0JAAY,EACZ,CAAC;YACC,WAAW;YACX,OAAO;QACT,GACA,mKAAqB;IAEzB,GAAG;QAAC;QAAQ;KAAW;IAEvB,OAAO;AACT","debugId":null}},
    {"offset": {"line": 1655, "column": 0}, "map": {"version":3,"sources":["file:///Users/matejhrescak/src/draftboard/src/components/editor/plugins/FloatingAddButtonPlugin.tsx"],"sourcesContent":["\"use client\";\n\nimport { useCallback, useEffect, useRef, useState } from \"react\";\nimport { useLexicalComposerContext } from \"@lexical/react/LexicalComposerContext\";\nimport {\n  $getSelection,\n  $isRangeSelection,\n  $createParagraphNode,\n  $getNodeByKey,\n  $isParagraphNode,\n  COMMAND_PRIORITY_LOW,\n  KEY_ARROW_DOWN_COMMAND,\n  KEY_ARROW_UP_COMMAND,\n} from \"lexical\";\nimport { createPortal } from \"react-dom\";\nimport {\n  Plus,\n  ImagePlus,\n  FileUp,\n  Heading1,\n  Heading2,\n  List,\n  ListOrdered,\n  Quote,\n  X,\n} from \"lucide-react\";\nimport { $createAttachmentNode, type AttachmentType } from \"../nodes/AttachmentNode\";\nimport { $setBlocksType } from \"@lexical/selection\";\nimport { $createHeadingNode, $createQuoteNode } from \"@lexical/rich-text\";\nimport { INSERT_ORDERED_LIST_COMMAND, INSERT_UNORDERED_LIST_COMMAND } from \"@lexical/list\";\nimport { api } from \"~/lib/trpc/client\";\nimport { cn } from \"~/lib/utils\";\n\ninterface FloatingAddButtonPluginProps {\n  anchorElem: HTMLElement;\n}\n\nexport function FloatingAddButtonPlugin({ anchorElem }: FloatingAddButtonPluginProps) {\n  const [editor] = useLexicalComposerContext();\n  const [isVisible, setIsVisible] = useState(false);\n  const [isMenuOpen, setIsMenuOpen] = useState(false);\n  const [position, setPosition] = useState({ top: 0 });\n  const [isEmpty, setIsEmpty] = useState(false);\n  const buttonRef = useRef<HTMLDivElement>(null);\n  const fileInputRef = useRef<HTMLInputElement>(null);\n  const uploadMutation = api.upload.getUploadUrl.useMutation();\n\n  const updatePosition = useCallback(() => {\n    editor.getEditorState().read(() => {\n      const selection = $getSelection();\n      if (!$isRangeSelection(selection)) {\n        setIsVisible(false);\n        return;\n      }\n\n      const anchor = selection.anchor;\n      const anchorNode = anchor.getNode();\n      const topLevelElement = anchorNode.getTopLevelElement();\n\n      if (!topLevelElement) {\n        setIsVisible(false);\n        return;\n      }\n\n      // Check if the current block is empty (only for paragraphs)\n      const isEmptyParagraph = $isParagraphNode(topLevelElement) &&\n        topLevelElement.getTextContent().trim() === \"\";\n\n      setIsEmpty(isEmptyParagraph);\n\n      const key = topLevelElement.getKey();\n      const elem = editor.getElementByKey(key);\n\n      if (!elem) {\n        setIsVisible(false);\n        return;\n      }\n\n      const editorRect = anchorElem.getBoundingClientRect();\n      const elemRect = elem.getBoundingClientRect();\n\n      setPosition({\n        top: elemRect.top - editorRect.top + 4,\n      });\n      setIsVisible(true);\n    });\n  }, [editor, anchorElem]);\n\n  useEffect(() => {\n    return editor.registerUpdateListener(({ editorState }) => {\n      editorState.read(() => {\n        updatePosition();\n      });\n    });\n  }, [editor, updatePosition]);\n\n  // Close menu when clicking outside\n  useEffect(() => {\n    if (!isMenuOpen) return;\n\n    const handleClickOutside = (e: MouseEvent) => {\n      if (buttonRef.current && !buttonRef.current.contains(e.target as Node)) {\n        setIsMenuOpen(false);\n      }\n    };\n\n    document.addEventListener(\"mousedown\", handleClickOutside);\n    return () => document.removeEventListener(\"mousedown\", handleClickOutside);\n  }, [isMenuOpen]);\n\n  const handleFileUpload = useCallback(\n    async (file: File) => {\n      setIsMenuOpen(false);\n      try {\n        const result = await uploadMutation.mutateAsync({\n          filename: file.name,\n          contentType: file.type,\n          size: file.size,\n        });\n\n        // Upload to R2\n        const uploadResponse = await fetch(result.uploadUrl, {\n          method: \"PUT\",\n          body: file,\n          headers: {\n            \"Content-Type\": file.type,\n          },\n        });\n\n        if (!uploadResponse.ok) {\n          const errorText = await uploadResponse.text();\n          console.error(\"R2 upload failed:\", uploadResponse.status, errorText);\n          alert(`Upload failed: ${uploadResponse.status} - Check CORS configuration on R2 bucket`);\n          return;\n        }\n\n        // Determine attachment type\n        let attachmentType: AttachmentType = \"FILE\";\n        if (file.type.startsWith(\"image/\")) {\n          attachmentType = \"IMAGE\";\n        } else if (file.type.startsWith(\"video/\")) {\n          attachmentType = \"VIDEO\";\n        }\n\n        // Insert attachment node\n        editor.update(() => {\n          const selection = $getSelection();\n          if ($isRangeSelection(selection)) {\n            const attachmentNode = $createAttachmentNode({\n              attachmentType,\n              url: result.publicUrl,\n              filename: file.name,\n              mimeType: file.type,\n              size: file.size,\n            });\n            selection.insertNodes([attachmentNode, $createParagraphNode()]);\n          }\n        });\n      } catch (error) {\n        console.error(\"Upload failed:\", error);\n        const message = error instanceof Error ? error.message : \"Unknown error\";\n        alert(`Upload failed: ${message}`);\n      }\n    },\n    [editor, uploadMutation]\n  );\n\n  const triggerFileInput = (accept: string) => {\n    if (fileInputRef.current) {\n      fileInputRef.current.accept = accept;\n      fileInputRef.current.click();\n    }\n  };\n\n  const insertBlock = (type: string) => {\n    setIsMenuOpen(false);\n    editor.update(() => {\n      const selection = $getSelection();\n      if (!$isRangeSelection(selection)) return;\n\n      switch (type) {\n        case \"h1\":\n          $setBlocksType(selection, () => $createHeadingNode(\"h1\"));\n          break;\n        case \"h2\":\n          $setBlocksType(selection, () => $createHeadingNode(\"h2\"));\n          break;\n        case \"bulletList\":\n          editor.dispatchCommand(INSERT_UNORDERED_LIST_COMMAND, undefined);\n          break;\n        case \"numberedList\":\n          editor.dispatchCommand(INSERT_ORDERED_LIST_COMMAND, undefined);\n          break;\n        case \"quote\":\n          $setBlocksType(selection, () => $createQuoteNode());\n          break;\n      }\n    });\n  };\n\n  if (!isVisible) return null;\n\n  return createPortal(\n    <div\n      ref={buttonRef}\n      className=\"absolute -left-8 z-10 transition-opacity\"\n      style={{ top: position.top }}\n    >\n      <input\n        ref={fileInputRef}\n        type=\"file\"\n        className=\"hidden\"\n        onChange={(e) => {\n          const file = e.target.files?.[0];\n          if (file) {\n            handleFileUpload(file);\n          }\n          e.target.value = \"\";\n        }}\n      />\n\n      <button\n        type=\"button\"\n        onClick={() => setIsMenuOpen(!isMenuOpen)}\n        className={cn(\n          \"flex h-6 w-6 items-center justify-center rounded-full border bg-background text-muted-foreground transition-all hover:bg-muted hover:text-foreground\",\n          isMenuOpen && \"rotate-45 bg-muted text-foreground\",\n          !isEmpty && \"opacity-0 hover:opacity-100\"\n        )}\n      >\n        <Plus className=\"h-4 w-4\" />\n      </button>\n\n      {isMenuOpen && (\n        <div className=\"absolute left-0 top-8 z-50 min-w-[200px] overflow-hidden rounded-lg border bg-popover p-1 shadow-lg animate-in fade-in-0 zoom-in-95\">\n          <p className=\"px-2 py-1 text-xs font-medium text-muted-foreground\">\n            Add blocks\n          </p>\n          <button\n            onClick={() => triggerFileInput(\"image/*\")}\n            className=\"flex w-full items-center gap-2 rounded-md px-2 py-1.5 text-sm hover:bg-muted\"\n          >\n            <div className=\"flex h-7 w-7 items-center justify-center rounded-md border bg-background\">\n              <ImagePlus className=\"h-4 w-4\" />\n            </div>\n            <div className=\"text-left\">\n              <p className=\"font-medium\">Image</p>\n              <p className=\"text-xs text-muted-foreground\">Upload an image</p>\n            </div>\n          </button>\n          <button\n            onClick={() => triggerFileInput(\"*/*\")}\n            className=\"flex w-full items-center gap-2 rounded-md px-2 py-1.5 text-sm hover:bg-muted\"\n          >\n            <div className=\"flex h-7 w-7 items-center justify-center rounded-md border bg-background\">\n              <FileUp className=\"h-4 w-4\" />\n            </div>\n            <div className=\"text-left\">\n              <p className=\"font-medium\">File</p>\n              <p className=\"text-xs text-muted-foreground\">Upload any file</p>\n            </div>\n          </button>\n          <div className=\"my-1 h-px bg-border\" />\n          <button\n            onClick={() => insertBlock(\"h1\")}\n            className=\"flex w-full items-center gap-2 rounded-md px-2 py-1.5 text-sm hover:bg-muted\"\n          >\n            <div className=\"flex h-7 w-7 items-center justify-center rounded-md border bg-background\">\n              <Heading1 className=\"h-4 w-4\" />\n            </div>\n            <span>Heading 1</span>\n          </button>\n          <button\n            onClick={() => insertBlock(\"h2\")}\n            className=\"flex w-full items-center gap-2 rounded-md px-2 py-1.5 text-sm hover:bg-muted\"\n          >\n            <div className=\"flex h-7 w-7 items-center justify-center rounded-md border bg-background\">\n              <Heading2 className=\"h-4 w-4\" />\n            </div>\n            <span>Heading 2</span>\n          </button>\n          <button\n            onClick={() => insertBlock(\"bulletList\")}\n            className=\"flex w-full items-center gap-2 rounded-md px-2 py-1.5 text-sm hover:bg-muted\"\n          >\n            <div className=\"flex h-7 w-7 items-center justify-center rounded-md border bg-background\">\n              <List className=\"h-4 w-4\" />\n            </div>\n            <span>Bullet List</span>\n          </button>\n          <button\n            onClick={() => insertBlock(\"numberedList\")}\n            className=\"flex w-full items-center gap-2 rounded-md px-2 py-1.5 text-sm hover:bg-muted\"\n          >\n            <div className=\"flex h-7 w-7 items-center justify-center rounded-md border bg-background\">\n              <ListOrdered className=\"h-4 w-4\" />\n            </div>\n            <span>Numbered List</span>\n          </button>\n          <button\n            onClick={() => insertBlock(\"quote\")}\n            className=\"flex w-full items-center gap-2 rounded-md px-2 py-1.5 text-sm hover:bg-muted\"\n          >\n            <div className=\"flex h-7 w-7 items-center justify-center rounded-md border bg-background\">\n              <Quote className=\"h-4 w-4\" />\n            </div>\n            <span>Quote</span>\n          </button>\n        </div>\n      )}\n    </div>,\n    anchorElem\n  );\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 2172, "column": 0}, "map": {"version":3,"sources":["file:///Users/matejhrescak/src/draftboard/src/components/editor/plugins/NodeDeletionPlugin.tsx"],"sourcesContent":["\"use client\";\n\nimport { useEffect } from \"react\";\nimport { useLexicalComposerContext } from \"@lexical/react/LexicalComposerContext\";\nimport {\n  $getSelection,\n  $isNodeSelection,\n  COMMAND_PRIORITY_LOW,\n  KEY_BACKSPACE_COMMAND,\n  KEY_DELETE_COMMAND,\n} from \"lexical\";\n\nexport function NodeDeletionPlugin() {\n  const [editor] = useLexicalComposerContext();\n\n  useEffect(() => {\n    const removeBackspace = editor.registerCommand(\n      KEY_BACKSPACE_COMMAND,\n      () => {\n        const selection = $getSelection();\n        if ($isNodeSelection(selection)) {\n          const nodes = selection.getNodes();\n          nodes.forEach((node) => {\n            node.remove();\n          });\n          return true;\n        }\n        return false;\n      },\n      COMMAND_PRIORITY_LOW\n    );\n\n    const removeDelete = editor.registerCommand(\n      KEY_DELETE_COMMAND,\n      () => {\n        const selection = $getSelection();\n        if ($isNodeSelection(selection)) {\n          const nodes = selection.getNodes();\n          nodes.forEach((node) => {\n            node.remove();\n          });\n          return true;\n        }\n        return false;\n      },\n      COMMAND_PRIORITY_LOW\n    );\n\n    return () => {\n      removeBackspace();\n      removeDelete();\n    };\n  }, [editor]);\n\n  return null;\n}\n"],"names":[],"mappings":";;;;AAEA;AACA;AACA;AAJA;;;;AAYO,SAAS;IACd,MAAM,CAAC,OAAO,GAAG,IAAA,iMAAyB;IAE1C,IAAA,kNAAS,EAAC;QACR,MAAM,kBAAkB,OAAO,eAAe,CAC5C,mKAAqB,EACrB;YACE,MAAM,YAAY,IAAA,2JAAa;YAC/B,IAAI,IAAA,8JAAgB,EAAC,YAAY;gBAC/B,MAAM,QAAQ,UAAU,QAAQ;gBAChC,MAAM,OAAO,CAAC,CAAC;oBACb,KAAK,MAAM;gBACb;gBACA,OAAO;YACT;YACA,OAAO;QACT,GACA,kKAAoB;QAGtB,MAAM,eAAe,OAAO,eAAe,CACzC,gKAAkB,EAClB;YACE,MAAM,YAAY,IAAA,2JAAa;YAC/B,IAAI,IAAA,8JAAgB,EAAC,YAAY;gBAC/B,MAAM,QAAQ,UAAU,QAAQ;gBAChC,MAAM,OAAO,CAAC,CAAC;oBACb,KAAK,MAAM;gBACb;gBACA,OAAO;YACT;YACA,OAAO;QACT,GACA,kKAAoB;QAGtB,OAAO;YACL;YACA;QACF;IACF,GAAG;QAAC;KAAO;IAEX,OAAO;AACT","debugId":null}},
    {"offset": {"line": 2221, "column": 0}, "map": {"version":3,"sources":["file:///Users/matejhrescak/src/draftboard/src/components/editor/toolbar/ToolbarPlugin.tsx"],"sourcesContent":["\"use client\";\n\nimport { useCallback, useEffect, useState, useRef } from \"react\";\nimport { useLexicalComposerContext } from \"@lexical/react/LexicalComposerContext\";\nimport {\n  $getSelection,\n  $isRangeSelection,\n  $createParagraphNode,\n  FORMAT_TEXT_COMMAND,\n  SELECTION_CHANGE_COMMAND,\n  COMMAND_PRIORITY_CRITICAL,\n} from \"lexical\";\nimport { mergeRegister } from \"@lexical/utils\";\nimport { Button } from \"~/components/ui/button\";\nimport {\n  Bold,\n  Italic,\n  Underline,\n  Strikethrough,\n  Code,\n  ImagePlus,\n  Paperclip,\n} from \"lucide-react\";\nimport { cn } from \"~/lib/utils\";\nimport { $createAttachmentNode, type AttachmentType } from \"../nodes/AttachmentNode\";\nimport { api } from \"~/lib/trpc/client\";\n\nexport function ToolbarPlugin() {\n  const [editor] = useLexicalComposerContext();\n  const [isBold, setIsBold] = useState(false);\n  const [isItalic, setIsItalic] = useState(false);\n  const [isUnderline, setIsUnderline] = useState(false);\n  const [isStrikethrough, setIsStrikethrough] = useState(false);\n  const [isCode, setIsCode] = useState(false);\n  const [isUploading, setIsUploading] = useState(false);\n  const imageInputRef = useRef<HTMLInputElement>(null);\n  const fileInputRef = useRef<HTMLInputElement>(null);\n  const uploadMutation = api.upload.getUploadUrl.useMutation();\n\n  const updateToolbar = useCallback(() => {\n    const selection = $getSelection();\n    if ($isRangeSelection(selection)) {\n      setIsBold(selection.hasFormat(\"bold\"));\n      setIsItalic(selection.hasFormat(\"italic\"));\n      setIsUnderline(selection.hasFormat(\"underline\"));\n      setIsStrikethrough(selection.hasFormat(\"strikethrough\"));\n      setIsCode(selection.hasFormat(\"code\"));\n    }\n  }, []);\n\n  useEffect(() => {\n    return mergeRegister(\n      editor.registerUpdateListener(({ editorState }) => {\n        editorState.read(() => {\n          updateToolbar();\n        });\n      }),\n      editor.registerCommand(\n        SELECTION_CHANGE_COMMAND,\n        () => {\n          updateToolbar();\n          return false;\n        },\n        COMMAND_PRIORITY_CRITICAL\n      )\n    );\n  }, [editor, updateToolbar]);\n\n  const handleFileUpload = useCallback(\n    async (file: File) => {\n      setIsUploading(true);\n      try {\n        // Get presigned URL\n        const result = await uploadMutation.mutateAsync({\n          filename: file.name,\n          contentType: file.type,\n          size: file.size,\n        });\n\n        // Upload to R2\n        const uploadResponse = await fetch(result.uploadUrl, {\n          method: \"PUT\",\n          body: file,\n          headers: {\n            \"Content-Type\": file.type,\n          },\n        });\n\n        if (!uploadResponse.ok) {\n          const errorText = await uploadResponse.text();\n          console.error(\"R2 upload failed:\", uploadResponse.status, errorText);\n          alert(`Upload failed: ${uploadResponse.status} - Check CORS configuration on R2 bucket`);\n          return;\n        }\n\n        // Determine attachment type\n        let attachmentType: AttachmentType = \"FILE\";\n        if (file.type.startsWith(\"image/\")) {\n          attachmentType = \"IMAGE\";\n        } else if (file.type.startsWith(\"video/\")) {\n          attachmentType = \"VIDEO\";\n        }\n\n        // Insert attachment node\n        editor.update(() => {\n          const selection = $getSelection();\n          if ($isRangeSelection(selection)) {\n            const attachmentNode = $createAttachmentNode({\n              attachmentType,\n              url: result.publicUrl,\n              filename: file.name,\n              mimeType: file.type,\n              size: file.size,\n            });\n            selection.insertNodes([attachmentNode, $createParagraphNode()]);\n          }\n        });\n      } catch (error) {\n        console.error(\"Upload failed:\", error);\n        const message = error instanceof Error ? error.message : \"Unknown error\";\n        alert(`Upload failed: ${message}`);\n      } finally {\n        setIsUploading(false);\n      }\n    },\n    [editor, uploadMutation]\n  );\n\n  return (\n    <div className=\"relative z-20 flex items-center gap-0.5 border-b border-border px-2 py-1\">\n      {/* Hidden file inputs */}\n      <input\n        ref={imageInputRef}\n        type=\"file\"\n        accept=\"image/*,video/*\"\n        className=\"hidden\"\n        onChange={(e) => {\n          const file = e.target.files?.[0];\n          if (file) {\n            handleFileUpload(file);\n          }\n          e.target.value = \"\";\n        }}\n      />\n      <input\n        ref={fileInputRef}\n        type=\"file\"\n        accept=\"*/*\"\n        className=\"hidden\"\n        onChange={(e) => {\n          const file = e.target.files?.[0];\n          if (file) {\n            handleFileUpload(file);\n          }\n          e.target.value = \"\";\n        }}\n      />\n\n      {/* Text formatting buttons */}\n      <Button\n        type=\"button\"\n        variant=\"ghost\"\n        size=\"sm\"\n        className={cn(\"h-8 w-8 p-0\", isBold && \"bg-muted\")}\n        onClick={() => editor.dispatchCommand(FORMAT_TEXT_COMMAND, \"bold\")}\n        title=\"Bold (âB)\"\n      >\n        <Bold className=\"h-4 w-4\" />\n      </Button>\n      <Button\n        type=\"button\"\n        variant=\"ghost\"\n        size=\"sm\"\n        className={cn(\"h-8 w-8 p-0\", isItalic && \"bg-muted\")}\n        onClick={() => editor.dispatchCommand(FORMAT_TEXT_COMMAND, \"italic\")}\n        title=\"Italic (âI)\"\n      >\n        <Italic className=\"h-4 w-4\" />\n      </Button>\n      <Button\n        type=\"button\"\n        variant=\"ghost\"\n        size=\"sm\"\n        className={cn(\"h-8 w-8 p-0\", isUnderline && \"bg-muted\")}\n        onClick={() => editor.dispatchCommand(FORMAT_TEXT_COMMAND, \"underline\")}\n        title=\"Underline (âU)\"\n      >\n        <Underline className=\"h-4 w-4\" />\n      </Button>\n      <Button\n        type=\"button\"\n        variant=\"ghost\"\n        size=\"sm\"\n        className={cn(\"h-8 w-8 p-0\", isStrikethrough && \"bg-muted\")}\n        onClick={() => editor.dispatchCommand(FORMAT_TEXT_COMMAND, \"strikethrough\")}\n        title=\"Strikethrough\"\n      >\n        <Strikethrough className=\"h-4 w-4\" />\n      </Button>\n      <div className=\"mx-1 h-4 w-px bg-border\" />\n      <Button\n        type=\"button\"\n        variant=\"ghost\"\n        size=\"sm\"\n        className={cn(\"h-8 w-8 p-0\", isCode && \"bg-muted\")}\n        onClick={() => editor.dispatchCommand(FORMAT_TEXT_COMMAND, \"code\")}\n        title=\"Inline Code\"\n      >\n        <Code className=\"h-4 w-4\" />\n      </Button>\n\n      <div className=\"mx-1 h-4 w-px bg-border\" />\n\n      {/* Direct attachment buttons */}\n      <Button\n        type=\"button\"\n        variant=\"ghost\"\n        size=\"sm\"\n        className=\"h-8 gap-1.5 px-2\"\n        disabled={isUploading}\n        onClick={() => imageInputRef.current?.click()}\n        title=\"Add image or video\"\n      >\n        <ImagePlus className=\"h-4 w-4\" />\n        <span className=\"text-xs\">Image</span>\n      </Button>\n      <Button\n        type=\"button\"\n        variant=\"ghost\"\n        size=\"sm\"\n        className=\"h-8 gap-1.5 px-2\"\n        disabled={isUploading}\n        onClick={() => fileInputRef.current?.click()}\n        title=\"Add file\"\n      >\n        <Paperclip className=\"h-4 w-4\" />\n        <span className=\"text-xs\">File</span>\n      </Button>\n\n      {isUploading && (\n        <span className=\"ml-2 text-xs text-muted-foreground\">Uploading...</span>\n      )}\n    </div>\n  );\n}\n"],"names":[],"mappings":";;;;;AAEA;AACA;AACA;AAQA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AASA;AACA;AACA;AAzBA;;;;;;;;;;;AA2BO,SAAS;IACd,MAAM,CAAC,OAAO,GAAG,IAAA,iMAAyB;IAC1C,MAAM,CAAC,QAAQ,UAAU,GAAG,IAAA,iNAAQ,EAAC;IACrC,MAAM,CAAC,UAAU,YAAY,GAAG,IAAA,iNAAQ,EAAC;IACzC,MAAM,CAAC,aAAa,eAAe,GAAG,IAAA,iNAAQ,EAAC;IAC/C,MAAM,CAAC,iBAAiB,mBAAmB,GAAG,IAAA,iNAAQ,EAAC;IACvD,MAAM,CAAC,QAAQ,UAAU,GAAG,IAAA,iNAAQ,EAAC;IACrC,MAAM,CAAC,aAAa,eAAe,GAAG,IAAA,iNAAQ,EAAC;IAC/C,MAAM,gBAAgB,IAAA,+MAAM,EAAmB;IAC/C,MAAM,eAAe,IAAA,+MAAM,EAAmB;IAC9C,MAAM,iBAAiB,mIAAG,CAAC,MAAM,CAAC,YAAY,CAAC,WAAW;IAE1D,MAAM,gBAAgB,IAAA,oNAAW,EAAC;QAChC,MAAM,YAAY,IAAA,2JAAa;QAC/B,IAAI,IAAA,+JAAiB,EAAC,YAAY;YAChC,UAAU,UAAU,SAAS,CAAC;YAC9B,YAAY,UAAU,SAAS,CAAC;YAChC,eAAe,UAAU,SAAS,CAAC;YACnC,mBAAmB,UAAU,SAAS,CAAC;YACvC,UAAU,UAAU,SAAS,CAAC;QAChC;IACF,GAAG,EAAE;IAEL,IAAA,kNAAS,EAAC;QACR,OAAO,IAAA,2LAAa,EAClB,OAAO,sBAAsB,CAAC,CAAC,EAAE,WAAW,EAAE;YAC5C,YAAY,IAAI,CAAC;gBACf;YACF;QACF,IACA,OAAO,eAAe,CACpB,sKAAwB,EACxB;YACE;YACA,OAAO;QACT,GACA,uKAAyB;IAG/B,GAAG;QAAC;QAAQ;KAAc;IAE1B,MAAM,mBAAmB,IAAA,oNAAW,EAClC,OAAO;QACL,eAAe;QACf,IAAI;YACF,oBAAoB;YACpB,MAAM,SAAS,MAAM,eAAe,WAAW,CAAC;gBAC9C,UAAU,KAAK,IAAI;gBACnB,aAAa,KAAK,IAAI;gBACtB,MAAM,KAAK,IAAI;YACjB;YAEA,eAAe;YACf,MAAM,iBAAiB,MAAM,MAAM,OAAO,SAAS,EAAE;gBACnD,QAAQ;gBACR,MAAM;gBACN,SAAS;oBACP,gBAAgB,KAAK,IAAI;gBAC3B;YACF;YAEA,IAAI,CAAC,eAAe,EAAE,EAAE;gBACtB,MAAM,YAAY,MAAM,eAAe,IAAI;gBAC3C,QAAQ,KAAK,CAAC,qBAAqB,eAAe,MAAM,EAAE;gBAC1D,MAAM,CAAC,eAAe,EAAE,eAAe,MAAM,CAAC,wCAAwC,CAAC;gBACvF;YACF;YAEA,4BAA4B;YAC5B,IAAI,iBAAiC;YACrC,IAAI,KAAK,IAAI,CAAC,UAAU,CAAC,WAAW;gBAClC,iBAAiB;YACnB,OAAO,IAAI,KAAK,IAAI,CAAC,UAAU,CAAC,WAAW;gBACzC,iBAAiB;YACnB;YAEA,yBAAyB;YACzB,OAAO,MAAM,CAAC;gBACZ,MAAM,YAAY,IAAA,2JAAa;gBAC/B,IAAI,IAAA,+JAAiB,EAAC,YAAY;oBAChC,MAAM,iBAAiB,IAAA,gLAAqB,EAAC;wBAC3C;wBACA,KAAK,OAAO,SAAS;wBACrB,UAAU,KAAK,IAAI;wBACnB,UAAU,KAAK,IAAI;wBACnB,MAAM,KAAK,IAAI;oBACjB;oBACA,UAAU,WAAW,CAAC;wBAAC;wBAAgB,IAAA,kKAAoB;qBAAG;gBAChE;YACF;QACF,EAAE,OAAO,OAAO;YACd,QAAQ,KAAK,CAAC,kBAAkB;YAChC,MAAM,UAAU,iBAAiB,QAAQ,MAAM,OAAO,GAAG;YACzD,MAAM,CAAC,eAAe,EAAE,SAAS;QACnC,SAAU;YACR,eAAe;QACjB;IACF,GACA;QAAC;QAAQ;KAAe;IAG1B,qBACE,8OAAC;QAAI,WAAU;;0BAEb,8OAAC;gBACC,KAAK;gBACL,MAAK;gBACL,QAAO;gBACP,WAAU;gBACV,UAAU,CAAC;oBACT,MAAM,OAAO,EAAE,MAAM,CAAC,KAAK,EAAE,CAAC,EAAE;oBAChC,IAAI,MAAM;wBACR,iBAAiB;oBACnB;oBACA,EAAE,MAAM,CAAC,KAAK,GAAG;gBACnB;;;;;;0BAEF,8OAAC;gBACC,KAAK;gBACL,MAAK;gBACL,QAAO;gBACP,WAAU;gBACV,UAAU,CAAC;oBACT,MAAM,OAAO,EAAE,MAAM,CAAC,KAAK,EAAE,CAAC,EAAE;oBAChC,IAAI,MAAM;wBACR,iBAAiB;oBACnB;oBACA,EAAE,MAAM,CAAC,KAAK,GAAG;gBACnB;;;;;;0BAIF,8OAAC,4IAAM;gBACL,MAAK;gBACL,SAAQ;gBACR,MAAK;gBACL,WAAW,IAAA,yHAAE,EAAC,eAAe,UAAU;gBACvC,SAAS,IAAM,OAAO,eAAe,CAAC,iKAAmB,EAAE;gBAC3D,OAAM;0BAEN,cAAA,8OAAC,0MAAI;oBAAC,WAAU;;;;;;;;;;;0BAElB,8OAAC,4IAAM;gBACL,MAAK;gBACL,SAAQ;gBACR,MAAK;gBACL,WAAW,IAAA,yHAAE,EAAC,eAAe,YAAY;gBACzC,SAAS,IAAM,OAAO,eAAe,CAAC,iKAAmB,EAAE;gBAC3D,OAAM;0BAEN,cAAA,8OAAC,gNAAM;oBAAC,WAAU;;;;;;;;;;;0BAEpB,8OAAC,4IAAM;gBACL,MAAK;gBACL,SAAQ;gBACR,MAAK;gBACL,WAAW,IAAA,yHAAE,EAAC,eAAe,eAAe;gBAC5C,SAAS,IAAM,OAAO,eAAe,CAAC,iKAAmB,EAAE;gBAC3D,OAAM;0BAEN,cAAA,8OAAC,yNAAS;oBAAC,WAAU;;;;;;;;;;;0BAEvB,8OAAC,4IAAM;gBACL,MAAK;gBACL,SAAQ;gBACR,MAAK;gBACL,WAAW,IAAA,yHAAE,EAAC,eAAe,mBAAmB;gBAChD,SAAS,IAAM,OAAO,eAAe,CAAC,iKAAmB,EAAE;gBAC3D,OAAM;0BAEN,cAAA,8OAAC,qOAAa;oBAAC,WAAU;;;;;;;;;;;0BAE3B,8OAAC;gBAAI,WAAU;;;;;;0BACf,8OAAC,4IAAM;gBACL,MAAK;gBACL,SAAQ;gBACR,MAAK;gBACL,WAAW,IAAA,yHAAE,EAAC,eAAe,UAAU;gBACvC,SAAS,IAAM,OAAO,eAAe,CAAC,iKAAmB,EAAE;gBAC3D,OAAM;0BAEN,cAAA,8OAAC,0MAAI;oBAAC,WAAU;;;;;;;;;;;0BAGlB,8OAAC;gBAAI,WAAU;;;;;;0BAGf,8OAAC,4IAAM;gBACL,MAAK;gBACL,SAAQ;gBACR,MAAK;gBACL,WAAU;gBACV,UAAU;gBACV,SAAS,IAAM,cAAc,OAAO,EAAE;gBACtC,OAAM;;kCAEN,8OAAC,6NAAS;wBAAC,WAAU;;;;;;kCACrB,8OAAC;wBAAK,WAAU;kCAAU;;;;;;;;;;;;0BAE5B,8OAAC,4IAAM;gBACL,MAAK;gBACL,SAAQ;gBACR,MAAK;gBACL,WAAU;gBACV,UAAU;gBACV,SAAS,IAAM,aAAa,OAAO,EAAE;gBACrC,OAAM;;kCAEN,8OAAC,yNAAS;wBAAC,WAAU;;;;;;kCACrB,8OAAC;wBAAK,WAAU;kCAAU;;;;;;;;;;;;YAG3B,6BACC,8OAAC;gBAAK,WAAU;0BAAqC;;;;;;;;;;;;AAI7D","debugId":null}},
    {"offset": {"line": 2569, "column": 0}, "map": {"version":3,"sources":["file:///Users/matejhrescak/src/draftboard/src/components/editor/Editor.tsx"],"sourcesContent":["\"use client\";\n\nimport { useCallback, useState } from \"react\";\nimport {\n  LexicalComposer,\n  type InitialConfigType,\n} from \"@lexical/react/LexicalComposer\";\nimport { RichTextPlugin } from \"@lexical/react/LexicalRichTextPlugin\";\nimport { ContentEditable } from \"@lexical/react/LexicalContentEditable\";\nimport { HistoryPlugin } from \"@lexical/react/LexicalHistoryPlugin\";\nimport { OnChangePlugin } from \"@lexical/react/LexicalOnChangePlugin\";\nimport { LexicalErrorBoundary } from \"@lexical/react/LexicalErrorBoundary\";\nimport { MarkdownShortcutPlugin } from \"@lexical/react/LexicalMarkdownShortcutPlugin\";\nimport { ListPlugin } from \"@lexical/react/LexicalListPlugin\";\nimport { LinkPlugin } from \"@lexical/react/LexicalLinkPlugin\";\nimport { HeadingNode, QuoteNode } from \"@lexical/rich-text\";\nimport { ListItemNode, ListNode } from \"@lexical/list\";\nimport { LinkNode, AutoLinkNode } from \"@lexical/link\";\nimport { CodeNode, CodeHighlightNode } from \"@lexical/code\";\nimport { TRANSFORMERS } from \"@lexical/markdown\";\nimport type { EditorState, SerializedEditorState } from \"lexical\";\n\nimport { MentionNode } from \"./nodes/MentionNode\";\nimport { ImageNode } from \"./nodes/ImageNode\";\nimport { AttachmentNode } from \"./nodes/AttachmentNode\";\nimport { MentionPlugin } from \"./plugins/MentionPlugin\";\nimport { SlashCommandPlugin } from \"./plugins/SlashCommandPlugin\";\nimport { DragDropPlugin } from \"./plugins/DragDropPlugin\";\nimport { FloatingAddButtonPlugin } from \"./plugins/FloatingAddButtonPlugin\";\nimport { NodeDeletionPlugin } from \"./plugins/NodeDeletionPlugin\";\nimport { ToolbarPlugin } from \"./toolbar/ToolbarPlugin\";\nimport { cn } from \"~/lib/utils\";\n\ninterface EditorProps {\n  initialContent?: SerializedEditorState | null;\n  onChange?: (editorState: SerializedEditorState) => void;\n  placeholder?: string;\n  editable?: boolean;\n  showToolbar?: boolean;\n  minHeight?: string;\n  className?: string;\n}\n\nconst theme = {\n  paragraph: \"mb-2\",\n  heading: {\n    h1: \"text-3xl font-bold mb-4 mt-6\",\n    h2: \"text-2xl font-bold mb-3 mt-5\",\n    h3: \"text-xl font-bold mb-2 mt-4\",\n  },\n  list: {\n    ul: \"list-disc ml-4 mb-2\",\n    ol: \"list-decimal ml-4 mb-2\",\n    listitem: \"mb-1\",\n  },\n  quote: \"border-l-4 border-primary/30 pl-4 italic text-muted-foreground my-4\",\n  code: \"font-mono bg-muted px-1.5 py-0.5 rounded text-sm\",\n  codeHighlight: {\n    atrule: \"text-purple-500\",\n    attr: \"text-yellow-500\",\n    boolean: \"text-purple-500\",\n    builtin: \"text-cyan-500\",\n    cdata: \"text-gray-500\",\n    char: \"text-green-500\",\n    class: \"text-yellow-500\",\n    \"class-name\": \"text-yellow-500\",\n    comment: \"text-gray-500\",\n    constant: \"text-purple-500\",\n    deleted: \"text-red-500\",\n    doctype: \"text-gray-500\",\n    entity: \"text-red-500\",\n    function: \"text-blue-500\",\n    important: \"text-purple-500\",\n    inserted: \"text-green-500\",\n    keyword: \"text-purple-500\",\n    namespace: \"text-purple-500\",\n    number: \"text-purple-500\",\n    operator: \"text-gray-500\",\n    prolog: \"text-gray-500\",\n    property: \"text-red-500\",\n    punctuation: \"text-gray-500\",\n    regex: \"text-green-500\",\n    selector: \"text-green-500\",\n    string: \"text-green-500\",\n    symbol: \"text-purple-500\",\n    tag: \"text-red-500\",\n    url: \"text-blue-500\",\n    variable: \"text-orange-500\",\n  },\n  link: \"text-primary underline cursor-pointer hover:text-primary/80\",\n  text: {\n    bold: \"font-bold\",\n    italic: \"italic\",\n    underline: \"underline\",\n    strikethrough: \"line-through\",\n    code: \"font-mono bg-muted px-1.5 py-0.5 rounded text-sm\",\n  },\n};\n\nexport function Editor({\n  initialContent,\n  onChange,\n  placeholder = \"Start writing, type / for commands or click + to add...\",\n  editable = true,\n  showToolbar = true,\n  minHeight = \"200px\",\n  className,\n}: EditorProps) {\n  const [floatingAnchorElem, setFloatingAnchorElem] =\n    useState<HTMLDivElement | null>(null);\n\n  const onRef = useCallback((elem: HTMLDivElement | null) => {\n    if (elem !== null) {\n      setFloatingAnchorElem(elem);\n    }\n  }, []);\n\n  const handleChange = useCallback(\n    (editorState: EditorState) => {\n      if (onChange) {\n        onChange(editorState.toJSON());\n      }\n    },\n    [onChange]\n  );\n\n  const initialConfig: InitialConfigType = {\n    namespace: \"DraftboardEditor\",\n    theme,\n    onError: (error: Error) => {\n      console.error(\"Lexical error:\", error);\n    },\n    nodes: [\n      HeadingNode,\n      QuoteNode,\n      ListNode,\n      ListItemNode,\n      LinkNode,\n      AutoLinkNode,\n      CodeNode,\n      CodeHighlightNode,\n      MentionNode,\n      ImageNode,\n      AttachmentNode,\n    ],\n    editorState: initialContent ? JSON.stringify(initialContent) : undefined,\n    editable,\n  };\n\n  return (\n    <LexicalComposer initialConfig={initialConfig}>\n      <div className={cn(\"editor-container relative\", className)}>\n        {showToolbar && editable && <ToolbarPlugin />}\n        <div className=\"relative\" ref={onRef}>\n          <RichTextPlugin\n            contentEditable={\n              <ContentEditable\n                className=\"editor-input outline-none\"\n                style={{ minHeight }}\n              />\n            }\n            placeholder={\n              <div className=\"editor-placeholder\">{placeholder}</div>\n            }\n            ErrorBoundary={LexicalErrorBoundary}\n          />\n        </div>\n        <HistoryPlugin />\n        <ListPlugin />\n        <LinkPlugin />\n        <MarkdownShortcutPlugin transformers={TRANSFORMERS} />\n        <OnChangePlugin onChange={handleChange} />\n        {editable && <MentionPlugin />}\n        {editable && <NodeDeletionPlugin />}\n        {editable && floatingAnchorElem && (\n          <>\n            <SlashCommandPlugin anchorElem={floatingAnchorElem} />\n            <DragDropPlugin />\n            <FloatingAddButtonPlugin anchorElem={floatingAnchorElem} />\n          </>\n        )}\n      </div>\n    </LexicalComposer>\n  );\n}\n\n// Read-only version for displaying content\nexport function EditorContent({\n  content,\n  className,\n}: {\n  content: SerializedEditorState;\n  className?: string;\n}) {\n  return (\n    <Editor\n      initialContent={content}\n      editable={false}\n      showToolbar={false}\n      minHeight=\"auto\"\n      className={className}\n    />\n  );\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 2853, "column": 0}, "map": {"version":3,"sources":["file:///Users/matejhrescak/src/draftboard/src/app/%28main%29/post/%5Bid%5D/edit/page.tsx"],"sourcesContent":["\"use client\";\n\nimport { useState, useCallback, useEffect, use } from \"react\";\nimport { useRouter } from \"next/navigation\";\nimport { X, Loader2, Link as LinkIcon, FolderKanban } from \"lucide-react\";\nimport { Button } from \"~/components/ui/button\";\nimport { Input } from \"~/components/ui/input\";\nimport { Badge } from \"~/components/ui/badge\";\nimport {\n  Popover,\n  PopoverContent,\n  PopoverTrigger,\n} from \"~/components/ui/popover\";\nimport { Editor } from \"~/components/editor/Editor\";\nimport { api } from \"~/lib/trpc/client\";\nimport type { SerializedEditorState } from \"lexical\";\nimport { cn } from \"~/lib/utils\";\n\ninterface EditPostPageProps {\n  params: Promise<{ id: string }>;\n}\n\nexport default function EditPostPage({ params }: EditPostPageProps) {\n  const { id } = use(params);\n  const router = useRouter();\n  const [title, setTitle] = useState(\"\");\n  const [content, setContent] = useState<SerializedEditorState | null>(null);\n  const [initialContent, setInitialContent] = useState<SerializedEditorState | null>(null);\n  const [liveUrl, setLiveUrl] = useState(\"\");\n  const [selectedProjects, setSelectedProjects] = useState<\n    Array<{ id: string; name: string }>\n  >([]);\n  const [projectSearch, setProjectSearch] = useState(\"\");\n  const [isLoading, setIsLoading] = useState(true);\n\n  const { data: post, isLoading: isLoadingPost } = api.post.getById.useQuery({ id });\n  const { data: projects } = api.project.search.useQuery(\n    { query: projectSearch },\n    { enabled: projectSearch.length > 0 }\n  );\n\n  useEffect(() => {\n    if (post) {\n      setTitle(post.title || \"\");\n      setLiveUrl(post.liveUrl || \"\");\n      setSelectedProjects(post.projects.map((p) => p.project));\n      setInitialContent(post.content as SerializedEditorState);\n      setContent(post.content as SerializedEditorState);\n      setIsLoading(false);\n    }\n  }, [post]);\n\n  const updateMutation = api.post.update.useMutation({\n    onSuccess: (updatedPost) => {\n      router.push(`/post/${updatedPost.id}`);\n    },\n  });\n\n  const handleContentChange = useCallback((state: SerializedEditorState) => {\n    setContent(state);\n  }, []);\n\n  const handleSubmit = () => {\n    if (!content) return;\n\n    // Extract attachments from editor content\n    const attachments: Array<{\n      type: \"IMAGE\" | \"VIDEO\" | \"FILE\" | \"FIGMA\" | \"LOOM\";\n      url: string;\n      filename: string;\n      mimeType: string;\n      size: number;\n      width?: number;\n      height?: number;\n      thumbnailUrl?: string;\n      metadata?: Record<string, unknown>;\n      order: number;\n    }> = [];\n\n    // Parse editor state to extract attachment nodes\n    const root = content.root;\n    if (root && \"children\" in root && Array.isArray(root.children)) {\n      let order = 0;\n      const extractAttachments = (node: unknown): void => {\n        if (!node || typeof node !== \"object\") return;\n        const nodeObj = node as Record<string, unknown>;\n\n        if (nodeObj.type === \"attachment\") {\n          attachments.push({\n            type: nodeObj.attachmentType as \"IMAGE\" | \"VIDEO\" | \"FILE\" | \"FIGMA\" | \"LOOM\",\n            url: nodeObj.url as string,\n            filename: nodeObj.filename as string,\n            mimeType: nodeObj.mimeType as string,\n            size: nodeObj.size as number,\n            width: nodeObj.width as number | undefined,\n            height: nodeObj.height as number | undefined,\n            thumbnailUrl: nodeObj.thumbnailUrl as string | undefined,\n            metadata: nodeObj.metadata as Record<string, unknown> | undefined,\n            order: order++,\n          });\n        }\n\n        if (Array.isArray(nodeObj.children)) {\n          nodeObj.children.forEach(extractAttachments);\n        }\n      };\n\n      root.children.forEach(extractAttachments);\n    }\n\n    updateMutation.mutate({\n      id,\n      title: title || undefined,\n      content,\n      liveUrl: liveUrl || undefined,\n      projectIds: selectedProjects.map((p) => p.id),\n      attachments,\n    });\n  };\n\n  const addProject = (project: { id: string; name: string }) => {\n    if (!selectedProjects.find((p) => p.id === project.id)) {\n      setSelectedProjects([...selectedProjects, project]);\n    }\n    setProjectSearch(\"\");\n  };\n\n  const removeProject = (projectId: string) => {\n    setSelectedProjects(selectedProjects.filter((p) => p.id !== projectId));\n  };\n\n  if (isLoadingPost || isLoading) {\n    return (\n      <div className=\"fixed inset-0 z-50 flex items-center justify-center bg-background\">\n        <Loader2 className=\"h-8 w-8 animate-spin text-muted-foreground\" />\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"fixed inset-0 z-50 flex flex-col bg-background\">\n      {/* Header */}\n      <header className=\"flex h-14 shrink-0 items-center justify-between border-b px-4\">\n        <Button\n          variant=\"ghost\"\n          size=\"icon\"\n          onClick={() => router.back()}\n          className=\"h-9 w-9\"\n        >\n          <X className=\"h-5 w-5\" />\n        </Button>\n        <Button\n          onClick={handleSubmit}\n          disabled={!content || updateMutation.isPending}\n        >\n          {updateMutation.isPending && (\n            <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />\n          )}\n          Save Changes\n        </Button>\n      </header>\n\n      {/* Content - scrollable */}\n      <div className=\"flex-1 overflow-y-auto\">\n        <div className=\"mx-auto max-w-3xl px-4 py-8\">\n          {/* Title */}\n          <Input\n            type=\"text\"\n            placeholder=\"Add a title (optional)\"\n            value={title}\n            onChange={(e) => setTitle(e.target.value)}\n            className=\"mb-4 border-none text-2xl font-bold placeholder:text-muted-foreground/50 focus-visible:ring-0\"\n          />\n\n          {/* Editor */}\n          {initialContent && (\n            <Editor\n              initialContent={initialContent}\n              onChange={handleContentChange}\n              placeholder=\"Write something, use / for commands, @ to mention...\"\n              minHeight=\"400px\"\n              showToolbar={false}\n              className=\"border-none shadow-none\"\n            />\n          )}\n\n          {/* Footer options */}\n          <div className=\"mt-6 flex flex-wrap items-center gap-3 border-t pt-6\">\n            {/* Live URL */}\n            <div className=\"flex items-center gap-2\">\n              <LinkIcon className=\"h-4 w-4 text-muted-foreground\" />\n              <Input\n                type=\"url\"\n                placeholder=\"Live URL (optional)\"\n                value={liveUrl}\n                onChange={(e) => setLiveUrl(e.target.value)}\n                className=\"h-8 w-64\"\n              />\n            </div>\n\n            {/* Projects */}\n            <Popover>\n              <PopoverTrigger asChild>\n                <Button variant=\"outline\" size=\"sm\" className=\"gap-2\">\n                  <FolderKanban className=\"h-4 w-4\" />\n                  Add to project\n                </Button>\n              </PopoverTrigger>\n              <PopoverContent className=\"w-64 p-2\">\n                <Input\n                  placeholder=\"Search projects...\"\n                  value={projectSearch}\n                  onChange={(e) => setProjectSearch(e.target.value)}\n                  className=\"mb-2\"\n                />\n                {projects && projects.length > 0 && (\n                  <div className=\"space-y-1\">\n                    {projects.map((project) => (\n                      <button\n                        key={project.id}\n                        onClick={() => addProject(project)}\n                        className={cn(\n                          \"flex w-full items-center gap-2 rounded-md px-2 py-1.5 text-sm hover:bg-muted\",\n                          selectedProjects.find((p) => p.id === project.id) &&\n                            \"bg-muted\"\n                        )}\n                      >\n                        <FolderKanban className=\"h-4 w-4 text-muted-foreground\" />\n                        {project.name}\n                      </button>\n                    ))}\n                  </div>\n                )}\n              </PopoverContent>\n            </Popover>\n\n            {/* Selected projects */}\n            {selectedProjects.map((project) => (\n              <Badge\n                key={project.id}\n                variant=\"secondary\"\n                className=\"gap-1 pr-1\"\n              >\n                {project.name}\n                <button\n                  onClick={() => removeProject(project.id)}\n                  className=\"ml-1 rounded-full p-0.5 hover:bg-muted\"\n                >\n                  <X className=\"h-3 w-3\" />\n                </button>\n              </Badge>\n            ))}\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n"],"names":[],"mappings":"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","debugId":null}}]
}