{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Users/matejhrescak/src/draftboard/src/components/ui/button.tsx"],"sourcesContent":["import * as React from \"react\";\nimport { Slot } from \"@radix-ui/react-slot\";\nimport { cva, type VariantProps } from \"class-variance-authority\";\nimport { cn } from \"~/lib/utils\";\n\nconst buttonVariants = cva(\n  \"inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium cursor-pointer transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n  {\n    variants: {\n      variant: {\n        default:\n          \"bg-primary text-primary-foreground shadow hover:bg-primary/90\",\n        destructive:\n          \"bg-destructive text-destructive-foreground shadow-sm hover:bg-destructive/90\",\n        outline:\n          \"border border-input bg-background shadow-sm hover:bg-accent hover:text-accent-foreground\",\n        secondary:\n          \"bg-secondary text-secondary-foreground shadow-sm hover:bg-secondary/80\",\n        ghost: \"hover:bg-accent hover:text-accent-foreground\",\n        link: \"text-primary underline-offset-4 hover:underline\",\n      },\n      size: {\n        default: \"h-9 px-4 py-2\",\n        sm: \"h-8 rounded-md px-3 text-xs\",\n        lg: \"h-10 rounded-md px-8\",\n        icon: \"h-9 w-9\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n);\n\nexport interface ButtonProps\n  extends React.ButtonHTMLAttributes<HTMLButtonElement>,\n    VariantProps<typeof buttonVariants> {\n  asChild?: boolean;\n}\n\nconst Button = React.forwardRef<HTMLButtonElement, ButtonProps>(\n  ({ className, variant, size, asChild = false, ...props }, ref) => {\n    const Comp = asChild ? Slot : \"button\";\n    return (\n      <Comp\n        className={cn(buttonVariants({ variant, size, className }))}\n        ref={ref}\n        {...props}\n      />\n    );\n  }\n);\nButton.displayName = \"Button\";\n\nexport { Button, buttonVariants };\n"],"names":[],"mappings":";;;;;;;AAAA;AACA;AACA;AACA;;;;;;AAEA,MAAM,iBAAiB,IAAA,uKAAG,EACxB,oVACA;IACE,UAAU;QACR,SAAS;YACP,SACE;YACF,aACE;YACF,SACE;YACF,WACE;YACF,OAAO;YACP,MAAM;QACR;QACA,MAAM;YACJ,SAAS;YACT,IAAI;YACJ,IAAI;YACJ,MAAM;QACR;IACF;IACA,iBAAiB;QACf,SAAS;QACT,MAAM;IACR;AACF;AASF,MAAM,uBAAS,mNAAgB,CAC7B,CAAC,EAAE,SAAS,EAAE,OAAO,EAAE,IAAI,EAAE,UAAU,KAAK,EAAE,GAAG,OAAO,EAAE;IACxD,MAAM,OAAO,UAAU,wKAAI,GAAG;IAC9B,qBACE,8OAAC;QACC,WAAW,IAAA,yHAAE,EAAC,eAAe;YAAE;YAAS;YAAM;QAAU;QACxD,KAAK;QACJ,GAAG,KAAK;;;;;;AAGf;AAEF,OAAO,WAAW,GAAG","debugId":null}},
    {"offset": {"line": 64, "column": 0}, "map": {"version":3,"sources":["file:///Users/matejhrescak/src/draftboard/src/components/ui/card.tsx"],"sourcesContent":["import * as React from \"react\";\nimport { cn } from \"~/lib/utils\";\n\nconst Card = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\n      \"rounded-[20px] border bg-card text-card-foreground shadow-sm\",\n      className\n    )}\n    {...props}\n  />\n));\nCard.displayName = \"Card\";\n\nconst CardHeader = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex flex-col space-y-1.5 p-6\", className)}\n    {...props}\n  />\n));\nCardHeader.displayName = \"CardHeader\";\n\nconst CardTitle = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"font-semibold leading-none tracking-tight\", className)}\n    {...props}\n  />\n));\nCardTitle.displayName = \"CardTitle\";\n\nconst CardDescription = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n));\nCardDescription.displayName = \"CardDescription\";\n\nconst CardContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn(\"p-6 pt-0\", className)} {...props} />\n));\nCardContent.displayName = \"CardContent\";\n\nconst CardFooter = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex items-center p-6 pt-0\", className)}\n    {...props}\n  />\n));\nCardFooter.displayName = \"CardFooter\";\n\nexport { Card, CardHeader, CardFooter, CardTitle, CardDescription, CardContent };\n"],"names":[],"mappings":";;;;;;;;;;;;;;;AAAA;AACA;;;;AAEA,MAAM,qBAAO,mNAAgB,CAG3B,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBAC1B,8OAAC;QACC,KAAK;QACL,WAAW,IAAA,yHAAE,EACX,gEACA;QAED,GAAG,KAAK;;;;;;AAGb,KAAK,WAAW,GAAG;AAEnB,MAAM,2BAAa,mNAAgB,CAGjC,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBAC1B,8OAAC;QACC,KAAK;QACL,WAAW,IAAA,yHAAE,EAAC,iCAAiC;QAC9C,GAAG,KAAK;;;;;;AAGb,WAAW,WAAW,GAAG;AAEzB,MAAM,0BAAY,mNAAgB,CAGhC,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBAC1B,8OAAC;QACC,KAAK;QACL,WAAW,IAAA,yHAAE,EAAC,6CAA6C;QAC1D,GAAG,KAAK;;;;;;AAGb,UAAU,WAAW,GAAG;AAExB,MAAM,gCAAkB,mNAAgB,CAGtC,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBAC1B,8OAAC;QACC,KAAK;QACL,WAAW,IAAA,yHAAE,EAAC,iCAAiC;QAC9C,GAAG,KAAK;;;;;;AAGb,gBAAgB,WAAW,GAAG;AAE9B,MAAM,4BAAc,mNAAgB,CAGlC,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBAC1B,8OAAC;QAAI,KAAK;QAAK,WAAW,IAAA,yHAAE,EAAC,YAAY;QAAa,GAAG,KAAK;;;;;;AAEhE,YAAY,WAAW,GAAG;AAE1B,MAAM,2BAAa,mNAAgB,CAGjC,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBAC1B,8OAAC;QACC,KAAK;QACL,WAAW,IAAA,yHAAE,EAAC,8BAA8B;QAC3C,GAAG,KAAK;;;;;;AAGb,WAAW,WAAW,GAAG","debugId":null}},
    {"offset": {"line": 149, "column": 0}, "map": {"version":3,"sources":["file:///Users/matejhrescak/src/draftboard/src/components/ui/popover.tsx"],"sourcesContent":["\"use client\";\n\nimport * as React from \"react\";\nimport * as PopoverPrimitive from \"@radix-ui/react-popover\";\nimport { cn } from \"~/lib/utils\";\n\nconst Popover = PopoverPrimitive.Root;\n\nconst PopoverTrigger = PopoverPrimitive.Trigger;\n\nconst PopoverAnchor = PopoverPrimitive.Anchor;\n\nconst PopoverContent = React.forwardRef<\n  React.ElementRef<typeof PopoverPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof PopoverPrimitive.Content>\n>(({ className, align = \"center\", sideOffset = 4, ...props }, ref) => (\n  <PopoverPrimitive.Portal>\n    <PopoverPrimitive.Content\n      ref={ref}\n      align={align}\n      sideOffset={sideOffset}\n      className={cn(\n        \"z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2\",\n        className\n      )}\n      {...props}\n    />\n  </PopoverPrimitive.Portal>\n));\nPopoverContent.displayName = PopoverPrimitive.Content.displayName;\n\nexport { Popover, PopoverTrigger, PopoverContent, PopoverAnchor };\n"],"names":[],"mappings":";;;;;;;;;;;AAEA;AACA;AACA;AAJA;;;;;AAMA,MAAM,UAAU,2KAAqB;AAErC,MAAM,iBAAiB,8KAAwB;AAE/C,MAAM,gBAAgB,6KAAuB;AAE7C,MAAM,+BAAiB,mNAAgB,CAGrC,CAAC,EAAE,SAAS,EAAE,QAAQ,QAAQ,EAAE,aAAa,CAAC,EAAE,GAAG,OAAO,EAAE,oBAC5D,8OAAC,6KAAuB;kBACtB,cAAA,8OAAC,8KAAwB;YACvB,KAAK;YACL,OAAO;YACP,YAAY;YACZ,WAAW,IAAA,yHAAE,EACX,8aACA;YAED,GAAG,KAAK;;;;;;;;;;;AAIf,eAAe,WAAW,GAAG,8KAAwB,CAAC,WAAW","debugId":null}},
    {"offset": {"line": 194, "column": 0}, "map": {"version":3,"sources":["file:///Users/matejhrescak/src/draftboard/src/components/reactions/ReactionButton.tsx"],"sourcesContent":["\"use client\";\n\nimport { useState } from \"react\";\nimport { Button } from \"~/components/ui/button\";\nimport {\n  Popover,\n  PopoverContent,\n  PopoverTrigger,\n} from \"~/components/ui/popover\";\nimport {\n  Tooltip,\n  TooltipContent,\n  TooltipProvider,\n  TooltipTrigger,\n} from \"~/components/ui/tooltip\";\nimport { api } from \"~/lib/trpc/client\";\nimport { Heart, Sparkles, ThumbsUp, SmilePlus } from \"lucide-react\";\nimport { cn } from \"~/lib/utils\";\n\ninterface ReactionButtonProps {\n  postId?: string;\n  commentId?: string;\n  reactions: Array<{\n    type: string;\n    userId: string;\n  }>;\n  count: number;\n}\n\nconst DEFAULT_REACTIONS = [\n  { type: \"like\", icon: ThumbsUp, label: \"Like\" },\n  { type: \"wow\", icon: Sparkles, label: \"Wow\" },\n  { type: \"cool\", icon: Heart, label: \"Cool\" },\n];\n\nexport function ReactionButton({\n  postId,\n  commentId,\n  reactions,\n  count,\n}: ReactionButtonProps) {\n  const [isOpen, setIsOpen] = useState(false);\n  const utils = api.useUtils();\n\n  const toggleMutation = api.reaction.toggle.useMutation({\n    onSuccess: () => {\n      if (postId) {\n        utils.post.feed.invalidate();\n        utils.post.getById.invalidate({ id: postId });\n      }\n      if (commentId) {\n        utils.comment.byPost.invalidate();\n      }\n    },\n  });\n\n  // Group reactions by type\n  const reactionCounts = reactions.reduce(\n    (acc, r) => {\n      acc[r.type] = (acc[r.type] || 0) + 1;\n      return acc;\n    },\n    {} as Record<string, number>\n  );\n\n  const handleReaction = (type: string) => {\n    toggleMutation.mutate({ type, postId, commentId });\n    setIsOpen(false);\n  };\n\n  const hasReactions = count > 0;\n\n  return (\n    <TooltipProvider>\n      <Popover open={isOpen} onOpenChange={setIsOpen}>\n        <PopoverTrigger asChild>\n          <Button\n            variant=\"ghost\"\n            size=\"sm\"\n            className={cn(\n              \"gap-2 rounded-full px-2 text-muted-foreground\",\n              hasReactions && \"text-primary\"\n            )}\n          >\n            {hasReactions ? (\n              <div className=\"flex -space-x-1\">\n                {Object.keys(reactionCounts)\n                  .slice(0, 3)\n                  .map((type) => {\n                    const reaction = DEFAULT_REACTIONS.find((r) => r.type === type);\n                    if (!reaction) return null;\n                    const Icon = reaction.icon;\n                    return (\n                      <div\n                        key={type}\n                        className=\"flex h-5 w-5 items-center justify-center rounded-full bg-primary/10 text-primary\"\n                      >\n                        <Icon className=\"h-3 w-3\" />\n                      </div>\n                    );\n                  })}\n              </div>\n            ) : (\n              <SmilePlus className=\"h-4 w-4\" />\n            )}\n            {count > 0 && <span>{count}</span>}\n          </Button>\n        </PopoverTrigger>\n        <PopoverContent className=\"w-auto p-2\" align=\"start\">\n          <div className=\"flex gap-1\">\n            {DEFAULT_REACTIONS.map((reaction) => {\n              const Icon = reaction.icon;\n              const userReacted = reactions.some(\n                (r) => r.type === reaction.type\n              );\n              const reactionCount = reactionCounts[reaction.type] || 0;\n\n              return (\n                <Tooltip key={reaction.type}>\n                  <TooltipTrigger asChild>\n                    <button\n                      onClick={() => handleReaction(reaction.type)}\n                      className={cn(\n                        \"flex h-10 w-10 items-center justify-center rounded-full transition-all hover:scale-110 hover:bg-muted\",\n                        userReacted && \"bg-primary/10 text-primary\"\n                      )}\n                    >\n                      <Icon className=\"h-5 w-5\" />\n                    </button>\n                  </TooltipTrigger>\n                  <TooltipContent>\n                    <p>\n                      {reaction.label}\n                      {reactionCount > 0 && ` (${reactionCount})`}\n                    </p>\n                  </TooltipContent>\n                </Tooltip>\n              );\n            })}\n          </div>\n        </PopoverContent>\n      </Popover>\n    </TooltipProvider>\n  );\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 409, "column": 0}, "map": {"version":3,"sources":["file:///Users/matejhrescak/src/draftboard/src/components/ui/lightbox.tsx"],"sourcesContent":["\"use client\";\n\nimport { useState, useEffect, useCallback } from \"react\";\nimport { createPortal } from \"react-dom\";\nimport { X, ChevronLeft, ChevronRight, Loader2 } from \"lucide-react\";\nimport { Button } from \"./button\";\nimport { api } from \"~/lib/trpc/client\";\n\ninterface LightboxImage {\n  id: string;\n  url: string;\n  filename: string;\n  thumbnailUrl?: string | null;\n}\n\ninterface LightboxProps {\n  images: LightboxImage[];\n  initialIndex?: number;\n  isOpen: boolean;\n  onClose: () => void;\n}\n\n// Extract R2 key from URL - handles both signed and unsigned URLs\nfunction extractR2Key(url: string): string | null {\n  // Remove query parameters first (signed URLs have ?X-Amz... parameters)\n  const urlWithoutParams = url.split('?')[0];\n  // Match the uploads path pattern\n  const match = urlWithoutParams?.match(/uploads\\/[^\\/]+\\/[^\\/]+$/);\n  return match ? match[0] : null;\n}\n\n// Check if URL is already a signed URL (has query parameters typical of signed URLs)\nfunction isSignedUrl(url: string): boolean {\n  return url.includes('X-Amz-') || url.includes('x-amz-');\n}\n\nfunction SignedLightboxImage({ url, filename }: { url: string; filename: string }) {\n  // If the URL is already signed, use it directly\n  const alreadySigned = isSignedUrl(url);\n  const r2Key = !alreadySigned ? extractR2Key(url) : null;\n  \n  const { data: signedUrlData, isLoading } = api.upload.getDownloadUrl.useQuery(\n    { key: r2Key! },\n    {\n      enabled: !!r2Key && !alreadySigned,\n      staleTime: 30 * 60 * 1000,\n      refetchOnWindowFocus: false,\n    }\n  );\n\n  // Use already signed URL directly, or wait for the signed URL query\n  const displayUrl = alreadySigned ? url : (signedUrlData?.url || url);\n\n  if (!alreadySigned && isLoading && r2Key) {\n    return (\n      <div className=\"flex h-full w-full items-center justify-center\">\n        <Loader2 className=\"h-12 w-12 animate-spin text-white/50\" />\n      </div>\n    );\n  }\n\n  return (\n    <img\n      src={displayUrl}\n      alt={filename}\n      className=\"max-h-[90vh] max-w-[90vw] object-contain\"\n    />\n  );\n}\n\nexport function Lightbox({ images, initialIndex = 0, isOpen, onClose }: LightboxProps) {\n  const [currentIndex, setCurrentIndex] = useState(initialIndex);\n  const [mounted, setMounted] = useState(false);\n\n  useEffect(() => {\n    setMounted(true);\n  }, []);\n\n  useEffect(() => {\n    setCurrentIndex(initialIndex);\n  }, [initialIndex, isOpen]);\n\n  const handlePrevious = useCallback(() => {\n    setCurrentIndex((prev) => (prev > 0 ? prev - 1 : images.length - 1));\n  }, [images.length]);\n\n  const handleNext = useCallback(() => {\n    setCurrentIndex((prev) => (prev < images.length - 1 ? prev + 1 : 0));\n  }, [images.length]);\n\n  useEffect(() => {\n    if (!isOpen) return;\n\n    const handleKeyDown = (e: KeyboardEvent) => {\n      if (e.key === \"Escape\") {\n        onClose();\n      } else if (e.key === \"ArrowLeft\") {\n        handlePrevious();\n      } else if (e.key === \"ArrowRight\") {\n        handleNext();\n      }\n    };\n\n    document.addEventListener(\"keydown\", handleKeyDown);\n    document.body.style.overflow = \"hidden\";\n\n    return () => {\n      document.removeEventListener(\"keydown\", handleKeyDown);\n      document.body.style.overflow = \"\";\n    };\n  }, [isOpen, onClose, handlePrevious, handleNext]);\n\n  if (!isOpen || !mounted || images.length === 0) return null;\n\n  const currentImage = images[currentIndex];\n  if (!currentImage) return null;\n\n  return createPortal(\n    <div\n      className=\"fixed inset-0 z-100 flex items-center justify-center bg-black/90\"\n      onClick={onClose}\n    >\n      {/* Close button */}\n      <Button\n        variant=\"ghost\"\n        size=\"icon\"\n        className=\"absolute right-4 top-4 z-10 text-white hover:bg-white/20\"\n        onClick={onClose}\n      >\n        <X className=\"h-6 w-6\" />\n        <span className=\"sr-only\">Close</span>\n      </Button>\n\n      {/* Navigation buttons */}\n      {images.length > 1 && (\n        <>\n          <Button\n            variant=\"ghost\"\n            size=\"icon\"\n            className=\"absolute left-4 top-1/2 z-10 -translate-y-1/2 text-white hover:bg-white/20\"\n            onClick={(e) => {\n              e.stopPropagation();\n              handlePrevious();\n            }}\n          >\n            <ChevronLeft className=\"h-8 w-8\" />\n            <span className=\"sr-only\">Previous</span>\n          </Button>\n          <Button\n            variant=\"ghost\"\n            size=\"icon\"\n            className=\"absolute right-4 top-1/2 z-10 -translate-y-1/2 text-white hover:bg-white/20\"\n            onClick={(e) => {\n              e.stopPropagation();\n              handleNext();\n            }}\n          >\n            <ChevronRight className=\"h-8 w-8\" />\n            <span className=\"sr-only\">Next</span>\n          </Button>\n        </>\n      )}\n\n      {/* Image */}\n      <div\n        className=\"flex items-center justify-center\"\n        onClick={(e) => e.stopPropagation()}\n      >\n        <SignedLightboxImage url={currentImage.url} filename={currentImage.filename} />\n      </div>\n\n      {/* Image counter */}\n      {images.length > 1 && (\n        <div className=\"absolute bottom-4 left-1/2 -translate-x-1/2 rounded-full bg-black/50 px-3 py-1 text-sm text-white\">\n          {currentIndex + 1} / {images.length}\n        </div>\n      )}\n\n      {/* Filename */}\n      <div className=\"absolute bottom-4 right-4 max-w-[200px] truncate rounded bg-black/50 px-3 py-1 text-sm text-white\">\n        {currentImage.filename}\n      </div>\n    </div>,\n    document.body\n  );\n}\n\n// Hook for managing lightbox state\nexport function useLightbox() {\n  const [isOpen, setIsOpen] = useState(false);\n  const [images, setImages] = useState<LightboxImage[]>([]);\n  const [initialIndex, setInitialIndex] = useState(0);\n\n  const openLightbox = useCallback((imgs: LightboxImage[], index = 0) => {\n    setImages(imgs);\n    setInitialIndex(index);\n    setIsOpen(true);\n  }, []);\n\n  const closeLightbox = useCallback(() => {\n    setIsOpen(false);\n  }, []);\n\n  return {\n    isOpen,\n    images,\n    initialIndex,\n    openLightbox,\n    closeLightbox,\n  };\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 692, "column": 0}, "map": {"version":3,"sources":["file:///Users/matejhrescak/src/draftboard/src/components/feed/AttachmentCarousel.tsx"],"sourcesContent":["\"use client\";\n\nimport { useState } from \"react\";\nimport Link from \"next/link\";\nimport { Play, FileIcon, Image as ImageIcon, Loader2 } from \"lucide-react\";\nimport { api } from \"~/lib/trpc/client\";\nimport { Lightbox } from \"~/components/ui/lightbox\";\n\ninterface Attachment {\n  id: string;\n  type: string;\n  url: string;\n  filename: string;\n  thumbnailUrl: string | null;\n}\n\ninterface AttachmentCarouselProps {\n  attachments: Attachment[];\n  postId: string;\n  totalCount: number;\n}\n\n// Extract R2 key from URL\nfunction extractR2Key(url: string): string | null {\n  const match = url.match(/uploads\\/[^\\/]+\\/[^\\/]+$/);\n  return match ? match[0] : null;\n}\n\nfunction getAttachmentIcon(type: string) {\n  switch (type) {\n    case \"IMAGE\":\n      return <ImageIcon className=\"h-8 w-8\" />;\n    case \"VIDEO\":\n    case \"LOOM\":\n      return <Play className=\"h-8 w-8\" />;\n    case \"FIGMA\":\n      return (\n        <svg viewBox=\"0 0 38 57\" className=\"h-8 w-8\" fill=\"none\">\n          <path d=\"M19 28.5a9.5 9.5 0 1 1 19 0 9.5 9.5 0 0 1-19 0z\" fill=\"#1ABCFE\" />\n          <path d=\"M0 47.5A9.5 9.5 0 0 1 9.5 38H19v9.5a9.5 9.5 0 1 1-19 0z\" fill=\"#0ACF83\" />\n          <path d=\"M19 0v19h9.5a9.5 9.5 0 1 0 0-19H19z\" fill=\"#FF7262\" />\n          <path d=\"M0 9.5A9.5 9.5 0 0 0 9.5 19H19V0H9.5A9.5 9.5 0 0 0 0 9.5z\" fill=\"#F24E1E\" />\n          <path d=\"M0 28.5A9.5 9.5 0 0 0 9.5 38H19V19H9.5A9.5 9.5 0 0 0 0 28.5z\" fill=\"#A259FF\" />\n        </svg>\n      );\n    default:\n      return <FileIcon className=\"h-8 w-8\" />;\n  }\n}\n\nfunction SignedImage({ url, filename, className }: { url: string; filename: string; className?: string }) {\n  const r2Key = extractR2Key(url);\n  const { data: signedUrlData, isLoading } = api.upload.getDownloadUrl.useQuery(\n    { key: r2Key! },\n    {\n      enabled: !!r2Key,\n      staleTime: 30 * 60 * 1000,\n      refetchOnWindowFocus: false,\n    }\n  );\n\n  if (isLoading) {\n    return (\n      <div className=\"flex h-full w-full items-center justify-center bg-muted\">\n        <Loader2 className=\"h-6 w-6 animate-spin text-muted-foreground\" />\n      </div>\n    );\n  }\n\n  return (\n    <img\n      src={signedUrlData?.url || url}\n      alt={filename}\n      className={className}\n    />\n  );\n}\n\nexport function AttachmentCarousel({\n  attachments,\n  postId,\n  totalCount,\n}: AttachmentCarouselProps) {\n  const [lightboxOpen, setLightboxOpen] = useState(false);\n  const [lightboxIndex, setLightboxIndex] = useState(0);\n\n  const visibleAttachments = attachments.slice(0, 2);\n  const remaining = totalCount - 2;\n\n  // Get all image attachments for the lightbox\n  const imageAttachments = attachments.filter((a) => a.type === \"IMAGE\");\n\n  const handleImageClick = (attachmentId: string, e: React.MouseEvent) => {\n    e.preventDefault();\n    e.stopPropagation();\n    const imageIndex = imageAttachments.findIndex((a) => a.id === attachmentId);\n    if (imageIndex >= 0) {\n      setLightboxIndex(imageIndex);\n      setLightboxOpen(true);\n    }\n  };\n\n  return (\n    <>\n      <div className=\"flex gap-2\">\n        {visibleAttachments.map((attachment, index) => {\n          if (attachment.type === \"IMAGE\") {\n            return (\n              <button\n                key={attachment.id}\n                onClick={(e) => handleImageClick(attachment.id, e)}\n                className=\"group relative flex-1 cursor-pointer overflow-hidden rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2\"\n              >\n                <div className=\"relative aspect-video w-full overflow-hidden bg-muted\">\n                  <SignedImage\n                    url={attachment.thumbnailUrl || attachment.url}\n                    filename={attachment.filename}\n                    className=\"h-full w-full object-cover transition-transform duration-200 ease-in-out group-hover:scale-[1.02]\"\n                  />\n                  {index === 1 && remaining > 0 && (\n                    <div className=\"absolute inset-0 flex items-center justify-center bg-black/60 text-white\">\n                      <span className=\"text-2xl font-semibold\">+{remaining}</span>\n                    </div>\n                  )}\n                </div>\n              </button>\n            );\n          }\n\n          return (\n            <Link\n              key={attachment.id}\n              href={`/post/${postId}#attachment-${attachment.id}`}\n              className=\"group relative flex-1 cursor-pointer overflow-hidden rounded-lg\"\n            >\n              {attachment.type === \"VIDEO\" ? (\n                <div className=\"relative aspect-video w-full overflow-hidden bg-muted\">\n                  {attachment.thumbnailUrl ? (\n                    <SignedImage\n                      url={attachment.thumbnailUrl}\n                      filename={attachment.filename}\n                      className=\"h-full w-full object-cover\"\n                    />\n                  ) : (\n                    <div className=\"flex h-full items-center justify-center\">\n                      <Play className=\"h-8 w-8 text-muted-foreground\" />\n                    </div>\n                  )}\n                  <div className=\"absolute inset-0 flex items-center justify-center bg-black/20\">\n                    <div className=\"flex h-12 w-12 items-center justify-center rounded-full bg-white/90\">\n                      <Play className=\"h-5 w-5 text-foreground\" />\n                    </div>\n                  </div>\n                  {index === 1 && remaining > 0 && (\n                    <div className=\"absolute inset-0 flex items-center justify-center bg-black/60 text-white\">\n                      <span className=\"text-2xl font-semibold\">+{remaining}</span>\n                    </div>\n                  )}\n                </div>\n              ) : (\n                <div className=\"relative flex aspect-video w-full items-center justify-center bg-muted\">\n                  <div className=\"flex flex-col items-center gap-2 text-muted-foreground\">\n                    {getAttachmentIcon(attachment.type)}\n                    <span className=\"max-w-[80%] truncate text-sm\">\n                      {attachment.filename}\n                    </span>\n                  </div>\n                  {index === 1 && remaining > 0 && (\n                    <div className=\"absolute inset-0 flex items-center justify-center bg-black/60 text-white\">\n                      <span className=\"text-2xl font-semibold\">+{remaining}</span>\n                    </div>\n                  )}\n                </div>\n              )}\n            </Link>\n          );\n        })}\n      </div>\n\n      <Lightbox\n        images={imageAttachments}\n        initialIndex={lightboxIndex}\n        isOpen={lightboxOpen}\n        onClose={() => setLightboxOpen(false)}\n      />\n    </>\n  );\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 1045, "column": 0}, "map": {"version":3,"sources":["file:///Users/matejhrescak/src/draftboard/src/components/feed/PostCard.tsx"],"sourcesContent":["\"use client\";\n\nimport Link from \"next/link\";\nimport { Avatar, AvatarFallback, AvatarImage } from \"~/components/ui/avatar\";\nimport { Button } from \"~/components/ui/button\";\nimport { Card, CardContent, CardFooter, CardHeader } from \"~/components/ui/card\";\nimport { Badge } from \"~/components/ui/badge\";\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuTrigger,\n} from \"~/components/ui/dropdown-menu\";\nimport {\n  formatRelativeTime,\n  getInitials,\n  truncateText,\n} from \"~/lib/utils\";\nimport { MessageCircle, ExternalLink, ChevronDown, Image as ImageIcon, Play, FileIcon } from \"lucide-react\";\nimport { ReactionButton } from \"~/components/reactions/ReactionButton\";\nimport { AttachmentCarousel } from \"./AttachmentCarousel\";\n\ninterface PostCardProps {\n  post: {\n    id: string;\n    title: string | null;\n    content: unknown;\n    liveUrl: string | null;\n    createdAt: Date;\n    author: {\n      id: string;\n      displayName: string;\n      avatarUrl: string | null;\n    };\n    attachments: Array<{\n      id: string;\n      type: string;\n      url: string;\n      filename: string;\n      thumbnailUrl: string | null;\n    }>;\n    projects: Array<{\n      project: {\n        id: string;\n        name: string;\n      };\n    }>;\n    reactions: Array<{\n      type: string;\n      userId: string;\n    }>;\n    _count: {\n      comments: number;\n      reactions: number;\n      attachments: number;\n    };\n  };\n}\n\nfunction extractPlainText(content: unknown): string {\n  if (!content || typeof content !== \"object\") return \"\";\n\n  const root = (content as Record<string, unknown>).root;\n  if (!root || typeof root !== \"object\") return \"\";\n\n  const children = (root as Record<string, unknown>).children;\n  if (!Array.isArray(children)) return \"\";\n\n  const texts: string[] = [];\n\n  function extractFromNode(node: unknown): void {\n    if (!node || typeof node !== \"object\") return;\n\n    const nodeObj = node as Record<string, unknown>;\n\n    if (nodeObj.type === \"text\" && typeof nodeObj.text === \"string\") {\n      texts.push(nodeObj.text);\n    }\n\n    if (Array.isArray(nodeObj.children)) {\n      nodeObj.children.forEach(extractFromNode);\n    }\n  }\n\n  children.forEach(extractFromNode);\n  return texts.join(\" \");\n}\n\nexport function PostCard({ post }: PostCardProps) {\n  const plainText = extractPlainText(post.content);\n  const truncatedContent = truncateText(plainText, 300);\n  const projectCount = post.projects.length;\n\n  return (\n    <Card className=\"overflow-hidden transition-shadow\">\n      <CardHeader className=\"px-5 pt-5 pb-3\">\n        <div className=\"flex items-center justify-between\">\n          <div className=\"flex items-center gap-3\">\n            <Link href={`/user/${post.author.id}`}>\n              <Avatar className=\"h-10 w-10\">\n                <AvatarImage src={post.author.avatarUrl ?? undefined} />\n                <AvatarFallback>\n                  {getInitials(post.author.displayName)}\n                </AvatarFallback>\n              </Avatar>\n            </Link>\n            <div className=\"flex flex-col\">\n              <div className=\"flex items-center gap-2 text-sm\">\n                <Link\n                  href={`/user/${post.author.id}`}\n                  className=\"font-medium hover:underline\"\n                >\n                  {post.author.displayName}\n                </Link>\n                {projectCount > 0 && (\n                  <>\n                    <span className=\"text-muted-foreground\">Â·</span>\n                    {projectCount === 1 ? (\n                      <Link\n                        href={`/projects/${post.projects[0]?.project.id}`}\n                        className=\"text-muted-foreground hover:text-foreground hover:underline\"\n                      >\n                        in {post.projects[0]?.project.name}\n                      </Link>\n                    ) : (\n                      <DropdownMenu>\n                        <DropdownMenuTrigger className=\"flex items-center gap-1 text-muted-foreground hover:text-foreground\">\n                          in {projectCount} projects\n                          <ChevronDown className=\"h-3 w-3\" />\n                        </DropdownMenuTrigger>\n                        <DropdownMenuContent>\n                          {post.projects.map(({ project }) => (\n                            <DropdownMenuItem key={project.id} asChild>\n                              <Link href={`/projects/${project.id}`}>\n                                {project.name}\n                              </Link>\n                            </DropdownMenuItem>\n                          ))}\n                        </DropdownMenuContent>\n                      </DropdownMenu>\n                    )}\n                  </>\n                )}\n              </div>\n              <Link\n                href={`/post/${post.id}`}\n                className=\"text-xs text-muted-foreground hover:underline\"\n              >\n                {formatRelativeTime(new Date(post.createdAt))}\n              </Link>\n            </div>\n          </div>\n        </div>\n      </CardHeader>\n\n      <CardContent className=\"px-5 pb-3\">\n        <Link href={`/post/${post.id}`} className=\"block\">\n          {post.title && (\n            <h2 className=\"mb-2 text-lg font-semibold hover:underline\">\n              {post.title}\n            </h2>\n          )}\n          {truncatedContent && (\n            <p className=\"text-sm text-muted-foreground line-clamp-3\">\n              {truncatedContent}\n            </p>\n          )}\n        </Link>\n\n        {post.attachments.length > 0 && (\n          <div className=\"mt-4\">\n            <AttachmentCarousel\n              attachments={post.attachments}\n              postId={post.id}\n              totalCount={post._count.attachments}\n            />\n          </div>\n        )}\n      </CardContent>\n\n      <CardFooter className=\"px-5 pt-1 pb-3\">\n        <div className=\"flex w-full items-center justify-between\">\n          <div className=\"flex items-center gap-2\">\n            <ReactionButton\n              postId={post.id}\n              reactions={post.reactions}\n              count={post._count.reactions}\n            />\n            <Link href={`/post/${post.id}#comments`}>\n              <Button variant=\"ghost\" size=\"sm\" className=\"gap-2 rounded-full px-2 text-muted-foreground\">\n                <MessageCircle className=\"h-4 w-4\" />\n                {post._count.comments > 0 && post._count.comments}\n              </Button>\n            </Link>\n          </div>\n          {post.liveUrl && (\n            <Button variant=\"outline\" size=\"sm\" asChild>\n              <a\n                href={post.liveUrl}\n                target=\"_blank\"\n                rel=\"noopener noreferrer\"\n                className=\"gap-2\"\n              >\n                View live\n                <ExternalLink className=\"h-3.5 w-3.5\" />\n              </a>\n            </Button>\n          )}\n        </div>\n      </CardFooter>\n    </Card>\n  );\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 1410, "column": 0}, "map": {"version":3,"sources":["file:///Users/matejhrescak/src/draftboard/src/components/user/UserProfile.tsx"],"sourcesContent":["\"use client\";\n\nimport { useCallback, useEffect, useRef } from \"react\";\nimport { useSession, signOut } from \"next-auth/react\";\nimport Link from \"next/link\";\nimport { Avatar, AvatarFallback, AvatarImage } from \"~/components/ui/avatar\";\nimport { Button } from \"~/components/ui/button\";\nimport { formatRelativeTime, getInitials } from \"~/lib/utils\";\nimport { Loader2, Calendar, Settings, LogOut } from \"lucide-react\";\nimport { PostCard } from \"~/components/feed/PostCard\";\nimport { api } from \"~/lib/trpc/client\";\n\ninterface UserProfileProps {\n  user: {\n    id: string;\n    email: string;\n    displayName: string;\n    avatarUrl: string | null;\n    createdAt: Date;\n  };\n}\n\nexport function UserProfile({ user }: UserProfileProps) {\n  const { data: session } = useSession();\n  const isOwnProfile = session?.user?.id === user.id;\n  const loadMoreRef = useRef<HTMLDivElement>(null);\n\n  const {\n    data,\n    fetchNextPage,\n    hasNextPage,\n    isFetchingNextPage,\n    isLoading,\n  } = api.post.byUser.useInfiniteQuery(\n    { userId: user.id, limit: 10 },\n    {\n      getNextPageParam: (lastPage) => lastPage.nextCursor,\n    }\n  );\n\n  const handleObserver = useCallback(\n    (entries: IntersectionObserverEntry[]) => {\n      const [target] = entries;\n      if (target?.isIntersecting && hasNextPage && !isFetchingNextPage) {\n        fetchNextPage();\n      }\n    },\n    [fetchNextPage, hasNextPage, isFetchingNextPage]\n  );\n\n  useEffect(() => {\n    const element = loadMoreRef.current;\n    if (!element) return;\n\n    const observer = new IntersectionObserver(handleObserver, {\n      root: null,\n      rootMargin: \"100px\",\n      threshold: 0,\n    });\n\n    observer.observe(element);\n    return () => observer.disconnect();\n  }, [handleObserver]);\n\n  const posts = data?.pages.flatMap((page) => page.posts) ?? [];\n\n  return (\n    <div className=\"space-y-8\">\n      {/* Profile Header */}\n      <div className=\"flex items-start gap-6\">\n        <Avatar className=\"h-24 w-24\">\n          <AvatarImage src={user.avatarUrl ?? undefined} />\n          <AvatarFallback className=\"text-2xl\">\n            {getInitials(user.displayName)}\n          </AvatarFallback>\n        </Avatar>\n        <div className=\"flex-1 space-y-2\">\n          <h1 className=\"text-3xl font-bold\">{user.displayName}</h1>\n          <p className=\"text-muted-foreground\">{user.email}</p>\n          <div className=\"flex items-center gap-2 text-sm text-muted-foreground\">\n            <Calendar className=\"h-4 w-4\" />\n            <span>Joined {formatRelativeTime(new Date(user.createdAt))}</span>\n          </div>\n        </div>\n      </div>\n\n      {/* Mobile-only: Settings and Sign Out for own profile */}\n      {isOwnProfile && (\n        <div className=\"flex gap-3 sm:hidden\">\n          <Button variant=\"outline\" className=\"flex-1\" asChild>\n            <Link href=\"/settings\">\n              <Settings className=\"mr-2 h-4 w-4\" />\n              Settings\n            </Link>\n          </Button>\n          <Button\n            variant=\"outline\"\n            className=\"flex-1 text-destructive hover:text-destructive\"\n            onClick={() => signOut({ callbackUrl: \"/sign-in\" })}\n          >\n            <LogOut className=\"mr-2 h-4 w-4\" />\n            Sign out\n          </Button>\n        </div>\n      )}\n\n      {/* Posts Section */}\n      <div className=\"space-y-4\">\n        {isLoading ? (\n          <div className=\"flex justify-center py-8\">\n            <Loader2 className=\"h-6 w-6 animate-spin text-muted-foreground\" />\n          </div>\n        ) : posts.length === 0 ? (\n          <div className=\"flex flex-col items-center justify-center py-12 text-center\">\n            <p className=\"text-muted-foreground\">\n              {user.displayName} hasn&apos;t posted anything yet.\n            </p>\n          </div>\n        ) : (\n          <div className=\"space-y-4\">\n            {posts.map((post) => (\n              <PostCard key={post.id} post={post} />\n            ))}\n          </div>\n        )}\n\n        <div ref={loadMoreRef} className=\"flex justify-center py-4\">\n          {isFetchingNextPage && (\n            <Loader2 className=\"h-6 w-6 animate-spin text-muted-foreground\" />\n          )}\n        </div>\n      </div>\n    </div>\n  );\n}\n"],"names":[],"mappings":"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","debugId":null}}]
}