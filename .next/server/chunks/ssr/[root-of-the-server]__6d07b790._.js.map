{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}},
    {"offset": {"line": 17, "column": 0}, "map": {"version":3,"sources":["file:///Users/matejhrescak/src/draftboard/src/server/api/trpc.ts"],"sourcesContent":["import { initTRPC, TRPCError } from \"@trpc/server\";\nimport superjson from \"superjson\";\nimport { ZodError } from \"zod\";\nimport { db } from \"~/server/db\";\nimport { auth } from \"~/server/auth\";\n\nexport const createTRPCContext = async (opts: { headers: Headers }) => {\n  const session = await auth();\n\n  return {\n    db,\n    session,\n    ...opts,\n  };\n};\n\nconst t = initTRPC.context<typeof createTRPCContext>().create({\n  transformer: superjson,\n  errorFormatter({ shape, error }) {\n    return {\n      ...shape,\n      data: {\n        ...shape.data,\n        zodError:\n          error.cause instanceof ZodError ? error.cause.flatten() : null,\n      },\n    };\n  },\n});\n\nexport const createCallerFactory = t.createCallerFactory;\n\nexport const createTRPCRouter = t.router;\n\nconst timingMiddleware = t.middleware(async ({ next, path }) => {\n  const start = Date.now();\n\n  const result = await next();\n\n  const end = Date.now();\n  console.log(`[TRPC] ${path} took ${end - start}ms`);\n\n  return result;\n});\n\nexport const publicProcedure = t.procedure.use(timingMiddleware);\n\nexport const protectedProcedure = t.procedure\n  .use(timingMiddleware)\n  .use(({ ctx, next }) => {\n    if (!ctx.session || !ctx.session.user) {\n      throw new TRPCError({ code: \"UNAUTHORIZED\" });\n    }\n    return next({\n      ctx: {\n        session: { ...ctx.session, user: ctx.session.user },\n      },\n    });\n  });\n\nexport const adminProcedure = protectedProcedure.use(({ ctx, next }) => {\n  if (ctx.session.user.role !== \"ADMIN\" && ctx.session.user.role !== \"OWNER\") {\n    throw new TRPCError({ code: \"FORBIDDEN\" });\n  }\n  return next();\n});\n"],"names":[],"mappings":";;;;;;;;;;;;;;AAAA;AAAA;AACA;AACA;AACA;AACA;;;;;;AAEO,MAAM,oBAAoB,OAAO;IACtC,MAAM,UAAU,MAAM,IAAA,6HAAI;IAE1B,OAAO;QACL,IAAA,yHAAE;QACF;QACA,GAAG,IAAI;IACT;AACF;AAEA,MAAM,IAAI,6KAAQ,CAAC,OAAO,GAA6B,MAAM,CAAC;IAC5D,aAAa,qJAAS;IACtB,gBAAe,EAAE,KAAK,EAAE,KAAK,EAAE;QAC7B,OAAO;YACL,GAAG,KAAK;YACR,MAAM;gBACJ,GAAG,MAAM,IAAI;gBACb,UACE,MAAM,KAAK,YAAY,iJAAQ,GAAG,MAAM,KAAK,CAAC,OAAO,KAAK;YAC9D;QACF;IACF;AACF;AAEO,MAAM,sBAAsB,EAAE,mBAAmB;AAEjD,MAAM,mBAAmB,EAAE,MAAM;AAExC,MAAM,mBAAmB,EAAE,UAAU,CAAC,OAAO,EAAE,IAAI,EAAE,IAAI,EAAE;IACzD,MAAM,QAAQ,KAAK,GAAG;IAEtB,MAAM,SAAS,MAAM;IAErB,MAAM,MAAM,KAAK,GAAG;IACpB,QAAQ,GAAG,CAAC,CAAC,OAAO,EAAE,KAAK,MAAM,EAAE,MAAM,MAAM,EAAE,CAAC;IAElD,OAAO;AACT;AAEO,MAAM,kBAAkB,EAAE,SAAS,CAAC,GAAG,CAAC;AAExC,MAAM,qBAAqB,EAAE,SAAS,CAC1C,GAAG,CAAC,kBACJ,GAAG,CAAC,CAAC,EAAE,GAAG,EAAE,IAAI,EAAE;IACjB,IAAI,CAAC,IAAI,OAAO,IAAI,CAAC,IAAI,OAAO,CAAC,IAAI,EAAE;QACrC,MAAM,IAAI,6KAAS,CAAC;YAAE,MAAM;QAAe;IAC7C;IACA,OAAO,KAAK;QACV,KAAK;YACH,SAAS;gBAAE,GAAG,IAAI,OAAO;gBAAE,MAAM,IAAI,OAAO,CAAC,IAAI;YAAC;QACpD;IACF;AACF;AAEK,MAAM,iBAAiB,mBAAmB,GAAG,CAAC,CAAC,EAAE,GAAG,EAAE,IAAI,EAAE;IACjE,IAAI,IAAI,OAAO,CAAC,IAAI,CAAC,IAAI,KAAK,WAAW,IAAI,OAAO,CAAC,IAAI,CAAC,IAAI,KAAK,SAAS;QAC1E,MAAM,IAAI,6KAAS,CAAC;YAAE,MAAM;QAAY;IAC1C;IACA,OAAO;AACT","debugId":null}},
    {"offset": {"line": 99, "column": 0}, "map": {"version":3,"sources":["file:///Users/matejhrescak/src/draftboard/src/lib/validators.ts"],"sourcesContent":["import { z } from \"zod\";\n\n// User validators\nexport const signUpSchema = z.object({\n  email: z.string().email(\"Invalid email address\"),\n  password: z\n    .string()\n    .min(8, \"Password must be at least 8 characters\")\n    .max(100, \"Password is too long\"),\n  displayName: z.string().min(2, \"Name must be at least 2 characters\").max(50),\n});\n\nexport const signInSchema = z.object({\n  email: z.string().email(\"Invalid email address\"),\n  password: z.string().min(1, \"Password is required\"),\n});\n\nexport const updateProfileSchema = z.object({\n  displayName: z.string().min(2).max(50).optional(),\n  avatarUrl: z.string().url().optional().nullable(),\n});\n\n// Post validators\nexport const createPostSchema = z.object({\n  title: z.string().max(200).optional(),\n  content: z.any(), // Lexical editor state JSON\n  liveUrl: z.string().url().optional().nullable(),\n  projectIds: z.array(z.string()).default([]),\n  attachments: z.array(\n    z.object({\n      type: z.enum([\"IMAGE\", \"VIDEO\", \"FILE\", \"FIGMA\", \"LOOM\"]),\n      url: z.string().url(),\n      filename: z.string(),\n      mimeType: z.string(),\n      size: z.number(),\n      width: z.number().optional(),\n      height: z.number().optional(),\n      thumbnailUrl: z.string().url().optional(),\n      metadata: z.any().optional(),\n      order: z.number(),\n    })\n  ).default([]),\n});\n\nexport const updatePostSchema = createPostSchema.partial().extend({\n  id: z.string(),\n});\n\n// Comment validators\nexport const createCommentSchema = z.object({\n  postId: z.string(),\n  content: z.any(), // Lexical editor state JSON\n  parentId: z.string().optional(),\n  attachmentId: z.string().optional(),\n  coordinates: z\n    .object({\n      x: z.number().optional(),\n      y: z.number().optional(),\n      width: z.number().optional(),\n      height: z.number().optional(),\n      timestamp: z.number().optional(),\n    })\n    .optional(),\n});\n\nexport const updateCommentSchema = z.object({\n  id: z.string(),\n  content: z.any(),\n});\n\n// Reaction validators\nexport const toggleReactionSchema = z.object({\n  type: z.string().min(1).max(50),\n  postId: z.string().optional(),\n  commentId: z.string().optional(),\n}).refine(\n  (data) => data.postId || data.commentId,\n  \"Either postId or commentId must be provided\"\n);\n\n// Project validators\nexport const createProjectSchema = z.object({\n  name: z.string().min(1, \"Project name is required\").max(100),\n  description: z.any().optional(), // Lexical editor state JSON\n  coverUrl: z.string().url().optional().nullable(),\n  urls: z.array(\n    z.object({\n      title: z.string().min(1).max(100),\n      url: z.string().url(),\n    })\n  ).default([]),\n});\n\nexport const updateProjectSchema = createProjectSchema.partial().extend({\n  id: z.string(),\n});\n\n// Pagination\nexport const paginationSchema = z.object({\n  cursor: z.string().optional(),\n  limit: z.number().min(1).max(50).default(20),\n});\n\n// Upload validators\nexport const presignedUrlSchema = z.object({\n  filename: z.string(),\n  contentType: z.string(),\n  size: z.number().max(100 * 1024 * 1024), // 100MB max\n});\n\n// Custom emoji\nexport const createEmojiSchema = z.object({\n  name: z.string().min(2).max(32).regex(/^[a-z0-9_]+$/, \"Only lowercase letters, numbers, and underscores\"),\n  imageUrl: z.string().url(),\n});\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 220, "column": 0}, "map": {"version":3,"sources":["file:///Users/matejhrescak/src/draftboard/src/server/api/routers/post.ts"],"sourcesContent":["import { TRPCError } from \"@trpc/server\";\nimport { z } from \"zod\";\nimport {\n  createTRPCRouter,\n  protectedProcedure,\n} from \"~/server/api/trpc\";\nimport { createPostSchema, updatePostSchema, paginationSchema } from \"~/lib/validators\";\n\nexport const postRouter = createTRPCRouter({\n  create: protectedProcedure\n    .input(createPostSchema)\n    .mutation(async ({ ctx, input }) => {\n      const post = await ctx.db.post.create({\n        data: {\n          title: input.title,\n          content: input.content,\n          liveUrl: input.liveUrl,\n          authorId: ctx.session.user.id,\n          attachments: {\n            create: input.attachments.map((att) => ({\n              type: att.type,\n              url: att.url,\n              filename: att.filename,\n              mimeType: att.mimeType,\n              size: att.size,\n              width: att.width,\n              height: att.height,\n              thumbnailUrl: att.thumbnailUrl,\n              metadata: att.metadata,\n              order: att.order,\n            })),\n          },\n          projects: {\n            create: input.projectIds.map((projectId) => ({\n              projectId,\n            })),\n          },\n        },\n        include: {\n          author: {\n            select: {\n              id: true,\n              displayName: true,\n              avatarUrl: true,\n            },\n          },\n          attachments: {\n            orderBy: { order: \"asc\" },\n          },\n          projects: {\n            include: {\n              project: {\n                select: {\n                  id: true,\n                  name: true,\n                },\n              },\n            },\n          },\n          _count: {\n            select: {\n              comments: true,\n              reactions: true,\n            },\n          },\n        },\n      });\n\n      return post;\n    }),\n\n  getById: protectedProcedure\n    .input(z.object({ id: z.string() }))\n    .query(async ({ ctx, input }) => {\n      const post = await ctx.db.post.findUnique({\n        where: { id: input.id },\n        include: {\n          author: {\n            select: {\n              id: true,\n              displayName: true,\n              avatarUrl: true,\n            },\n          },\n          attachments: {\n            orderBy: { order: \"asc\" },\n          },\n          projects: {\n            include: {\n              project: {\n                select: {\n                  id: true,\n                  name: true,\n                },\n              },\n            },\n          },\n          reactions: {\n            include: {\n              user: {\n                select: {\n                  id: true,\n                  displayName: true,\n                },\n              },\n            },\n          },\n          _count: {\n            select: {\n              comments: true,\n            },\n          },\n        },\n      });\n\n      if (!post) {\n        throw new TRPCError({ code: \"NOT_FOUND\" });\n      }\n\n      return post;\n    }),\n\n  feed: protectedProcedure\n    .input(paginationSchema)\n    .query(async ({ ctx, input }) => {\n      const posts = await ctx.db.post.findMany({\n        take: input.limit + 1,\n        cursor: input.cursor ? { id: input.cursor } : undefined,\n        orderBy: { createdAt: \"desc\" },\n        include: {\n          author: {\n            select: {\n              id: true,\n              displayName: true,\n              avatarUrl: true,\n            },\n          },\n          attachments: {\n            orderBy: { order: \"asc\" },\n            take: 3, // For preview\n          },\n          projects: {\n            include: {\n              project: {\n                select: {\n                  id: true,\n                  name: true,\n                },\n              },\n            },\n          },\n          reactions: {\n            select: {\n              type: true,\n              userId: true,\n            },\n          },\n          _count: {\n            select: {\n              comments: true,\n              reactions: true,\n              attachments: true,\n            },\n          },\n        },\n      });\n\n      let nextCursor: string | undefined;\n      if (posts.length > input.limit) {\n        const nextItem = posts.pop();\n        nextCursor = nextItem?.id;\n      }\n\n      return { posts, nextCursor };\n    }),\n\n  byProject: protectedProcedure\n    .input(\n      paginationSchema.extend({\n        projectId: z.string(),\n      })\n    )\n    .query(async ({ ctx, input }) => {\n      const posts = await ctx.db.post.findMany({\n        where: {\n          projects: {\n            some: {\n              projectId: input.projectId,\n            },\n          },\n        },\n        take: input.limit + 1,\n        cursor: input.cursor ? { id: input.cursor } : undefined,\n        orderBy: { createdAt: \"desc\" },\n        include: {\n          author: {\n            select: {\n              id: true,\n              displayName: true,\n              avatarUrl: true,\n            },\n          },\n          attachments: {\n            orderBy: { order: \"asc\" },\n            take: 3,\n          },\n          projects: {\n            include: {\n              project: {\n                select: {\n                  id: true,\n                  name: true,\n                },\n              },\n            },\n          },\n          reactions: {\n            select: {\n              type: true,\n              userId: true,\n            },\n          },\n          _count: {\n            select: {\n              comments: true,\n              reactions: true,\n              attachments: true,\n            },\n          },\n        },\n      });\n\n      let nextCursor: string | undefined;\n      if (posts.length > input.limit) {\n        const nextItem = posts.pop();\n        nextCursor = nextItem?.id;\n      }\n\n      return { posts, nextCursor };\n    }),\n\n  update: protectedProcedure\n    .input(updatePostSchema)\n    .mutation(async ({ ctx, input }) => {\n      const existingPost = await ctx.db.post.findUnique({\n        where: { id: input.id },\n        select: { authorId: true },\n      });\n\n      if (!existingPost) {\n        throw new TRPCError({ code: \"NOT_FOUND\" });\n      }\n\n      if (existingPost.authorId !== ctx.session.user.id) {\n        throw new TRPCError({ code: \"FORBIDDEN\" });\n      }\n\n      // Delete existing attachments and project links if updating\n      if (input.attachments) {\n        await ctx.db.attachment.deleteMany({\n          where: { postId: input.id },\n        });\n      }\n\n      if (input.projectIds) {\n        await ctx.db.postProject.deleteMany({\n          where: { postId: input.id },\n        });\n      }\n\n      const post = await ctx.db.post.update({\n        where: { id: input.id },\n        data: {\n          title: input.title,\n          content: input.content,\n          liveUrl: input.liveUrl,\n          attachments: input.attachments\n            ? {\n                create: input.attachments.map((att) => ({\n                  type: att.type,\n                  url: att.url,\n                  filename: att.filename,\n                  mimeType: att.mimeType,\n                  size: att.size,\n                  width: att.width,\n                  height: att.height,\n                  thumbnailUrl: att.thumbnailUrl,\n                  metadata: att.metadata,\n                  order: att.order,\n                })),\n              }\n            : undefined,\n          projects: input.projectIds\n            ? {\n                create: input.projectIds.map((projectId) => ({\n                  projectId,\n                })),\n              }\n            : undefined,\n        },\n        include: {\n          author: {\n            select: {\n              id: true,\n              displayName: true,\n              avatarUrl: true,\n            },\n          },\n          attachments: {\n            orderBy: { order: \"asc\" },\n          },\n          projects: {\n            include: {\n              project: {\n                select: {\n                  id: true,\n                  name: true,\n                },\n              },\n            },\n          },\n        },\n      });\n\n      return post;\n    }),\n\n  delete: protectedProcedure\n    .input(z.object({ id: z.string() }))\n    .mutation(async ({ ctx, input }) => {\n      const existingPost = await ctx.db.post.findUnique({\n        where: { id: input.id },\n        select: { authorId: true },\n      });\n\n      if (!existingPost) {\n        throw new TRPCError({ code: \"NOT_FOUND\" });\n      }\n\n      const isAdmin =\n        ctx.session.user.role === \"ADMIN\" ||\n        ctx.session.user.role === \"OWNER\";\n\n      if (existingPost.authorId !== ctx.session.user.id && !isAdmin) {\n        throw new TRPCError({ code: \"FORBIDDEN\" });\n      }\n\n      await ctx.db.post.delete({\n        where: { id: input.id },\n      });\n\n      return { success: true };\n    }),\n});\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 597, "column": 0}, "map": {"version":3,"sources":["file:///Users/matejhrescak/src/draftboard/src/server/api/routers/user.ts"],"sourcesContent":["import { TRPCError } from \"@trpc/server\";\nimport { hash } from \"bcryptjs\";\nimport { z } from \"zod\";\nimport {\n  createTRPCRouter,\n  publicProcedure,\n  protectedProcedure,\n  adminProcedure,\n} from \"~/server/api/trpc\";\nimport { signUpSchema, updateProfileSchema } from \"~/lib/validators\";\n\nexport const userRouter = createTRPCRouter({\n  register: publicProcedure\n    .input(signUpSchema)\n    .mutation(async ({ ctx, input }) => {\n      const existingUser = await ctx.db.user.findUnique({\n        where: { email: input.email },\n      });\n\n      if (existingUser) {\n        throw new TRPCError({\n          code: \"CONFLICT\",\n          message: \"User with this email already exists\",\n        });\n      }\n\n      const passwordHash = await hash(input.password, 12);\n\n      // Check if this is the first user (make them OWNER)\n      const userCount = await ctx.db.user.count();\n      const role = userCount === 0 ? \"OWNER\" : \"MEMBER\";\n\n      const user = await ctx.db.user.create({\n        data: {\n          email: input.email,\n          passwordHash,\n          displayName: input.displayName,\n          role,\n        },\n        select: {\n          id: true,\n          email: true,\n          displayName: true,\n          role: true,\n        },\n      });\n\n      return user;\n    }),\n\n  me: protectedProcedure.query(async ({ ctx }) => {\n    const user = await ctx.db.user.findUnique({\n      where: { id: ctx.session.user.id },\n      select: {\n        id: true,\n        email: true,\n        displayName: true,\n        avatarUrl: true,\n        role: true,\n        createdAt: true,\n      },\n    });\n\n    if (!user) {\n      throw new TRPCError({ code: \"NOT_FOUND\" });\n    }\n\n    return user;\n  }),\n\n  getById: protectedProcedure\n    .input(z.object({ id: z.string() }))\n    .query(async ({ ctx, input }) => {\n      const user = await ctx.db.user.findUnique({\n        where: { id: input.id },\n        select: {\n          id: true,\n          email: true,\n          displayName: true,\n          avatarUrl: true,\n          createdAt: true,\n        },\n      });\n\n      if (!user) {\n        throw new TRPCError({ code: \"NOT_FOUND\" });\n      }\n\n      return user;\n    }),\n\n  updateProfile: protectedProcedure\n    .input(updateProfileSchema)\n    .mutation(async ({ ctx, input }) => {\n      const user = await ctx.db.user.update({\n        where: { id: ctx.session.user.id },\n        data: input,\n        select: {\n          id: true,\n          email: true,\n          displayName: true,\n          avatarUrl: true,\n        },\n      });\n\n      return user;\n    }),\n\n  search: protectedProcedure\n    .input(z.object({ query: z.string().min(1) }))\n    .query(async ({ ctx, input }) => {\n      const users = await ctx.db.user.findMany({\n        where: {\n          OR: [\n            { displayName: { contains: input.query, mode: \"insensitive\" } },\n            { email: { contains: input.query, mode: \"insensitive\" } },\n          ],\n        },\n        select: {\n          id: true,\n          displayName: true,\n          avatarUrl: true,\n        },\n        take: 10,\n      });\n\n      return users;\n    }),\n\n  // Admin endpoints\n  list: adminProcedure\n    .input(\n      z.object({\n        cursor: z.string().optional(),\n        limit: z.number().min(1).max(100).default(50),\n      })\n    )\n    .query(async ({ ctx, input }) => {\n      const users = await ctx.db.user.findMany({\n        take: input.limit + 1,\n        cursor: input.cursor ? { id: input.cursor } : undefined,\n        orderBy: { createdAt: \"desc\" },\n        select: {\n          id: true,\n          email: true,\n          displayName: true,\n          avatarUrl: true,\n          role: true,\n          createdAt: true,\n        },\n      });\n\n      let nextCursor: string | undefined;\n      if (users.length > input.limit) {\n        const nextItem = users.pop();\n        nextCursor = nextItem?.id;\n      }\n\n      return { users, nextCursor };\n    }),\n\n  updateRole: adminProcedure\n    .input(\n      z.object({\n        userId: z.string(),\n        role: z.enum([\"MEMBER\", \"ADMIN\"]),\n      })\n    )\n    .mutation(async ({ ctx, input }) => {\n      // Can't change owner's role or their own role\n      const targetUser = await ctx.db.user.findUnique({\n        where: { id: input.userId },\n      });\n\n      if (!targetUser) {\n        throw new TRPCError({ code: \"NOT_FOUND\" });\n      }\n\n      if (targetUser.role === \"OWNER\") {\n        throw new TRPCError({\n          code: \"FORBIDDEN\",\n          message: \"Cannot change owner's role\",\n        });\n      }\n\n      if (input.userId === ctx.session.user.id) {\n        throw new TRPCError({\n          code: \"FORBIDDEN\",\n          message: \"Cannot change your own role\",\n        });\n      }\n\n      const user = await ctx.db.user.update({\n        where: { id: input.userId },\n        data: { role: input.role },\n        select: {\n          id: true,\n          role: true,\n        },\n      });\n\n      return user;\n    }),\n});\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 812, "column": 0}, "map": {"version":3,"sources":["file:///Users/matejhrescak/src/draftboard/src/server/api/routers/comment.ts"],"sourcesContent":["import { TRPCError } from \"@trpc/server\";\nimport { z } from \"zod\";\nimport {\n  createTRPCRouter,\n  protectedProcedure,\n} from \"~/server/api/trpc\";\nimport { createCommentSchema, updateCommentSchema } from \"~/lib/validators\";\n\nexport const commentRouter = createTRPCRouter({\n  create: protectedProcedure\n    .input(createCommentSchema)\n    .mutation(async ({ ctx, input }) => {\n      // Verify post exists\n      const post = await ctx.db.post.findUnique({\n        where: { id: input.postId },\n        select: { id: true, authorId: true },\n      });\n\n      if (!post) {\n        throw new TRPCError({ code: \"NOT_FOUND\", message: \"Post not found\" });\n      }\n\n      // If replying, verify parent exists and is not already a reply\n      if (input.parentId) {\n        const parent = await ctx.db.comment.findUnique({\n          where: { id: input.parentId },\n          select: { parentId: true, authorId: true },\n        });\n\n        if (!parent) {\n          throw new TRPCError({ code: \"NOT_FOUND\", message: \"Parent comment not found\" });\n        }\n\n        // Enforce max 2 levels of nesting\n        if (parent.parentId) {\n          throw new TRPCError({\n            code: \"BAD_REQUEST\",\n            message: \"Cannot reply to a reply\",\n          });\n        }\n      }\n\n      const comment = await ctx.db.comment.create({\n        data: {\n          content: input.content,\n          postId: input.postId,\n          authorId: ctx.session.user.id,\n          parentId: input.parentId,\n          attachmentId: input.attachmentId,\n          coordinates: input.coordinates,\n        },\n        include: {\n          author: {\n            select: {\n              id: true,\n              displayName: true,\n              avatarUrl: true,\n            },\n          },\n          replies: {\n            include: {\n              author: {\n                select: {\n                  id: true,\n                  displayName: true,\n                  avatarUrl: true,\n                },\n              },\n            },\n          },\n        },\n      });\n\n      // Create notification for post author (if not self)\n      if (post.authorId !== ctx.session.user.id) {\n        await ctx.db.notification.create({\n          data: {\n            type: input.parentId ? \"COMMENT_REPLY\" : \"COMMENT\",\n            userId: post.authorId,\n            actorId: ctx.session.user.id,\n            postId: input.postId,\n            commentId: comment.id,\n          },\n        });\n      }\n\n      // If replying, also notify the parent comment author\n      if (input.parentId) {\n        const parent = await ctx.db.comment.findUnique({\n          where: { id: input.parentId },\n          select: { authorId: true },\n        });\n\n        if (parent && parent.authorId !== ctx.session.user.id && parent.authorId !== post.authorId) {\n          await ctx.db.notification.create({\n            data: {\n              type: \"COMMENT_REPLY\",\n              userId: parent.authorId,\n              actorId: ctx.session.user.id,\n              postId: input.postId,\n              commentId: comment.id,\n            },\n          });\n        }\n      }\n\n      return comment;\n    }),\n\n  byPost: protectedProcedure\n    .input(z.object({ postId: z.string() }))\n    .query(async ({ ctx, input }) => {\n      const comments = await ctx.db.comment.findMany({\n        where: {\n          postId: input.postId,\n          parentId: null, // Only top-level comments\n        },\n        orderBy: { createdAt: \"asc\" },\n        include: {\n          author: {\n            select: {\n              id: true,\n              displayName: true,\n              avatarUrl: true,\n            },\n          },\n          replies: {\n            orderBy: { createdAt: \"asc\" },\n            include: {\n              author: {\n                select: {\n                  id: true,\n                  displayName: true,\n                  avatarUrl: true,\n                },\n              },\n              reactions: {\n                select: {\n                  type: true,\n                  userId: true,\n                },\n              },\n            },\n          },\n          reactions: {\n            select: {\n              type: true,\n              userId: true,\n            },\n          },\n        },\n      });\n\n      return comments;\n    }),\n\n  byAttachment: protectedProcedure\n    .input(z.object({ attachmentId: z.string() }))\n    .query(async ({ ctx, input }) => {\n      const comments = await ctx.db.comment.findMany({\n        where: {\n          attachmentId: input.attachmentId,\n        },\n        orderBy: { createdAt: \"asc\" },\n        include: {\n          author: {\n            select: {\n              id: true,\n              displayName: true,\n              avatarUrl: true,\n            },\n          },\n          reactions: {\n            select: {\n              type: true,\n              userId: true,\n            },\n          },\n        },\n      });\n\n      return comments;\n    }),\n\n  update: protectedProcedure\n    .input(updateCommentSchema)\n    .mutation(async ({ ctx, input }) => {\n      const existingComment = await ctx.db.comment.findUnique({\n        where: { id: input.id },\n        select: { authorId: true },\n      });\n\n      if (!existingComment) {\n        throw new TRPCError({ code: \"NOT_FOUND\" });\n      }\n\n      if (existingComment.authorId !== ctx.session.user.id) {\n        throw new TRPCError({ code: \"FORBIDDEN\" });\n      }\n\n      const comment = await ctx.db.comment.update({\n        where: { id: input.id },\n        data: { content: input.content },\n        include: {\n          author: {\n            select: {\n              id: true,\n              displayName: true,\n              avatarUrl: true,\n            },\n          },\n        },\n      });\n\n      return comment;\n    }),\n\n  delete: protectedProcedure\n    .input(z.object({ id: z.string() }))\n    .mutation(async ({ ctx, input }) => {\n      const existingComment = await ctx.db.comment.findUnique({\n        where: { id: input.id },\n        select: { authorId: true },\n      });\n\n      if (!existingComment) {\n        throw new TRPCError({ code: \"NOT_FOUND\" });\n      }\n\n      const isAdmin =\n        ctx.session.user.role === \"ADMIN\" ||\n        ctx.session.user.role === \"OWNER\";\n\n      if (existingComment.authorId !== ctx.session.user.id && !isAdmin) {\n        throw new TRPCError({ code: \"FORBIDDEN\" });\n      }\n\n      await ctx.db.comment.delete({\n        where: { id: input.id },\n      });\n\n      return { success: true };\n    }),\n});\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 1084, "column": 0}, "map": {"version":3,"sources":["file:///Users/matejhrescak/src/draftboard/src/server/api/routers/reaction.ts"],"sourcesContent":["import { z } from \"zod\";\nimport {\n  createTRPCRouter,\n  protectedProcedure,\n} from \"~/server/api/trpc\";\nimport { toggleReactionSchema } from \"~/lib/validators\";\n\nexport const reactionRouter = createTRPCRouter({\n  toggle: protectedProcedure\n    .input(toggleReactionSchema)\n    .mutation(async ({ ctx, input }) => {\n      const userId = ctx.session.user.id;\n\n      // Check if reaction already exists\n      const existingReaction = await ctx.db.reaction.findFirst({\n        where: {\n          userId,\n          type: input.type,\n          postId: input.postId ?? undefined,\n          commentId: input.commentId ?? undefined,\n        },\n      });\n\n      if (existingReaction) {\n        // Remove the reaction\n        await ctx.db.reaction.delete({\n          where: { id: existingReaction.id },\n        });\n        return { added: false, type: input.type };\n      }\n\n      // Add the reaction\n      const reaction = await ctx.db.reaction.create({\n        data: {\n          type: input.type,\n          userId,\n          postId: input.postId,\n          commentId: input.commentId,\n        },\n      });\n\n      // Create notification\n      if (input.postId) {\n        const post = await ctx.db.post.findUnique({\n          where: { id: input.postId },\n          select: { authorId: true },\n        });\n\n        if (post && post.authorId !== userId) {\n          await ctx.db.notification.create({\n            data: {\n              type: \"REACTION_POST\",\n              userId: post.authorId,\n              actorId: userId,\n              postId: input.postId,\n            },\n          });\n        }\n      }\n\n      if (input.commentId) {\n        const comment = await ctx.db.comment.findUnique({\n          where: { id: input.commentId },\n          select: { authorId: true, postId: true },\n        });\n\n        if (comment && comment.authorId !== userId) {\n          await ctx.db.notification.create({\n            data: {\n              type: \"REACTION_COMMENT\",\n              userId: comment.authorId,\n              actorId: userId,\n              postId: comment.postId,\n              commentId: input.commentId,\n            },\n          });\n        }\n      }\n\n      return { added: true, type: input.type, id: reaction.id };\n    }),\n\n  byPost: protectedProcedure\n    .input(z.object({ postId: z.string() }))\n    .query(async ({ ctx, input }) => {\n      const reactions = await ctx.db.reaction.findMany({\n        where: { postId: input.postId },\n        include: {\n          user: {\n            select: {\n              id: true,\n              displayName: true,\n            },\n          },\n        },\n      });\n\n      // Group reactions by type\n      const grouped = reactions.reduce(\n        (acc, reaction) => {\n          if (!acc[reaction.type]) {\n            acc[reaction.type] = [];\n          }\n          acc[reaction.type].push({\n            userId: reaction.userId,\n            userName: reaction.user.displayName,\n          });\n          return acc;\n        },\n        {} as Record<string, { userId: string; userName: string }[]>\n      );\n\n      return grouped;\n    }),\n\n  // Custom emoji management\n  listEmoji: protectedProcedure.query(async ({ ctx }) => {\n    const emoji = await ctx.db.customEmoji.findMany({\n      orderBy: { name: \"asc\" },\n    });\n    return emoji;\n  }),\n\n  createEmoji: protectedProcedure\n    .input(\n      z.object({\n        name: z.string().min(2).max(32).regex(/^[a-z0-9_]+$/),\n        imageUrl: z.string().url(),\n      })\n    )\n    .mutation(async ({ ctx, input }) => {\n      const emoji = await ctx.db.customEmoji.create({\n        data: {\n          name: input.name,\n          imageUrl: input.imageUrl,\n          createdBy: ctx.session.user.id,\n        },\n      });\n      return emoji;\n    }),\n\n  deleteEmoji: protectedProcedure\n    .input(z.object({ id: z.string() }))\n    .mutation(async ({ ctx, input }) => {\n      await ctx.db.customEmoji.delete({\n        where: { id: input.id },\n      });\n      return { success: true };\n    }),\n});\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 1244, "column": 0}, "map": {"version":3,"sources":["file:///Users/matejhrescak/src/draftboard/src/server/api/routers/project.ts"],"sourcesContent":["import { TRPCError } from \"@trpc/server\";\nimport { z } from \"zod\";\nimport {\n  createTRPCRouter,\n  protectedProcedure,\n} from \"~/server/api/trpc\";\nimport { createProjectSchema, updateProjectSchema, paginationSchema } from \"~/lib/validators\";\n\nexport const projectRouter = createTRPCRouter({\n  create: protectedProcedure\n    .input(createProjectSchema)\n    .mutation(async ({ ctx, input }) => {\n      const project = await ctx.db.project.create({\n        data: {\n          name: input.name,\n          description: input.description,\n          coverUrl: input.coverUrl,\n          createdById: ctx.session.user.id,\n          urls: {\n            create: input.urls.map((url) => ({\n              title: url.title,\n              url: url.url,\n            })),\n          },\n          members: {\n            create: {\n              userId: ctx.session.user.id,\n              role: \"OWNER\",\n            },\n          },\n        },\n        include: {\n          urls: true,\n          _count: {\n            select: {\n              posts: true,\n              members: true,\n            },\n          },\n        },\n      });\n\n      return project;\n    }),\n\n  getById: protectedProcedure\n    .input(z.object({ id: z.string() }))\n    .query(async ({ ctx, input }) => {\n      const project = await ctx.db.project.findUnique({\n        where: { id: input.id },\n        include: {\n          urls: true,\n          members: {\n            include: {\n              user: {\n                select: {\n                  id: true,\n                  displayName: true,\n                  avatarUrl: true,\n                },\n              },\n            },\n          },\n          _count: {\n            select: {\n              posts: true,\n            },\n          },\n        },\n      });\n\n      if (!project) {\n        throw new TRPCError({ code: \"NOT_FOUND\" });\n      }\n\n      // Include createdById for authorization checks\n      return {\n        ...project,\n        createdById: project.createdById,\n      };\n    }),\n\n  list: protectedProcedure\n    .input(paginationSchema)\n    .query(async ({ ctx, input }) => {\n      const projects = await ctx.db.project.findMany({\n        take: input.limit + 1,\n        cursor: input.cursor ? { id: input.cursor } : undefined,\n        orderBy: { createdAt: \"desc\" },\n        include: {\n          urls: {\n            take: 3,\n          },\n          _count: {\n            select: {\n              posts: true,\n              members: true,\n            },\n          },\n        },\n      });\n\n      let nextCursor: string | undefined;\n      if (projects.length > input.limit) {\n        const nextItem = projects.pop();\n        nextCursor = nextItem?.id;\n      }\n\n      return { projects, nextCursor };\n    }),\n\n  search: protectedProcedure\n    .input(z.object({ query: z.string().min(1) }))\n    .query(async ({ ctx, input }) => {\n      const projects = await ctx.db.project.findMany({\n        where: {\n          name: { contains: input.query, mode: \"insensitive\" },\n        },\n        select: {\n          id: true,\n          name: true,\n          coverUrl: true,\n        },\n        take: 10,\n      });\n\n      return projects;\n    }),\n\n  update: protectedProcedure\n    .input(updateProjectSchema)\n    .mutation(async ({ ctx, input }) => {\n      const existingProject = await ctx.db.project.findUnique({\n        where: { id: input.id },\n        select: { createdById: true },\n      });\n\n      if (!existingProject) {\n        throw new TRPCError({ code: \"NOT_FOUND\" });\n      }\n\n      const isAdmin =\n        ctx.session.user.role === \"ADMIN\" ||\n        ctx.session.user.role === \"OWNER\";\n\n      if (existingProject.createdById !== ctx.session.user.id && !isAdmin) {\n        throw new TRPCError({ code: \"FORBIDDEN\" });\n      }\n\n      // Delete existing URLs if updating\n      if (input.urls) {\n        await ctx.db.projectUrl.deleteMany({\n          where: { projectId: input.id },\n        });\n      }\n\n      const project = await ctx.db.project.update({\n        where: { id: input.id },\n        data: {\n          name: input.name,\n          description: input.description,\n          coverUrl: input.coverUrl,\n          urls: input.urls\n            ? {\n                create: input.urls.map((url) => ({\n                  title: url.title,\n                  url: url.url,\n                })),\n              }\n            : undefined,\n        },\n        include: {\n          urls: true,\n          _count: {\n            select: {\n              posts: true,\n              members: true,\n            },\n          },\n        },\n      });\n\n      return project;\n    }),\n\n  delete: protectedProcedure\n    .input(z.object({ id: z.string() }))\n    .mutation(async ({ ctx, input }) => {\n      const existingProject = await ctx.db.project.findUnique({\n        where: { id: input.id },\n        select: { createdById: true },\n      });\n\n      if (!existingProject) {\n        throw new TRPCError({ code: \"NOT_FOUND\" });\n      }\n\n      const isAdmin =\n        ctx.session.user.role === \"ADMIN\" ||\n        ctx.session.user.role === \"OWNER\";\n\n      if (existingProject.createdById !== ctx.session.user.id && !isAdmin) {\n        throw new TRPCError({ code: \"FORBIDDEN\" });\n      }\n\n      await ctx.db.project.delete({\n        where: { id: input.id },\n      });\n\n      return { success: true };\n    }),\n\n  addMember: protectedProcedure\n    .input(\n      z.object({\n        projectId: z.string(),\n        userId: z.string(),\n      })\n    )\n    .mutation(async ({ ctx, input }) => {\n      const project = await ctx.db.project.findUnique({\n        where: { id: input.projectId },\n        select: { createdById: true },\n      });\n\n      if (!project) {\n        throw new TRPCError({ code: \"NOT_FOUND\" });\n      }\n\n      const member = await ctx.db.projectMember.create({\n        data: {\n          projectId: input.projectId,\n          userId: input.userId,\n          role: \"MEMBER\",\n        },\n        include: {\n          user: {\n            select: {\n              id: true,\n              displayName: true,\n              avatarUrl: true,\n            },\n          },\n        },\n      });\n\n      return member;\n    }),\n\n  removeMember: protectedProcedure\n    .input(\n      z.object({\n        projectId: z.string(),\n        userId: z.string(),\n      })\n    )\n    .mutation(async ({ ctx, input }) => {\n      await ctx.db.projectMember.deleteMany({\n        where: {\n          projectId: input.projectId,\n          userId: input.userId,\n        },\n      });\n\n      return { success: true };\n    }),\n});\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 1517, "column": 0}, "map": {"version":3,"sources":["file:///Users/matejhrescak/src/draftboard/src/server/api/routers/notification.ts"],"sourcesContent":["import { z } from \"zod\";\nimport {\n  createTRPCRouter,\n  protectedProcedure,\n} from \"~/server/api/trpc\";\nimport { paginationSchema } from \"~/lib/validators\";\n\nexport const notificationRouter = createTRPCRouter({\n  list: protectedProcedure\n    .input(paginationSchema)\n    .query(async ({ ctx, input }) => {\n      const notifications = await ctx.db.notification.findMany({\n        where: { userId: ctx.session.user.id },\n        take: input.limit + 1,\n        cursor: input.cursor ? { id: input.cursor } : undefined,\n        orderBy: { createdAt: \"desc\" },\n        include: {\n          actor: {\n            select: {\n              id: true,\n              displayName: true,\n              avatarUrl: true,\n            },\n          },\n          post: {\n            select: {\n              id: true,\n              title: true,\n            },\n          },\n          comment: {\n            select: {\n              id: true,\n            },\n          },\n        },\n      });\n\n      let nextCursor: string | undefined;\n      if (notifications.length > input.limit) {\n        const nextItem = notifications.pop();\n        nextCursor = nextItem?.id;\n      }\n\n      return { notifications, nextCursor };\n    }),\n\n  unreadCount: protectedProcedure.query(async ({ ctx }) => {\n    const count = await ctx.db.notification.count({\n      where: {\n        userId: ctx.session.user.id,\n        read: false,\n      },\n    });\n\n    return count;\n  }),\n\n  markAsRead: protectedProcedure\n    .input(z.object({ id: z.string() }))\n    .mutation(async ({ ctx, input }) => {\n      await ctx.db.notification.update({\n        where: {\n          id: input.id,\n          userId: ctx.session.user.id,\n        },\n        data: { read: true },\n      });\n\n      return { success: true };\n    }),\n\n  markAllAsRead: protectedProcedure.mutation(async ({ ctx }) => {\n    await ctx.db.notification.updateMany({\n      where: {\n        userId: ctx.session.user.id,\n        read: false,\n      },\n      data: { read: true },\n    });\n\n    return { success: true };\n  }),\n});\n"],"names":[],"mappings":";;;;AAAA;AACA;AAIA;;;;AAEO,MAAM,qBAAqB,IAAA,gJAAgB,EAAC;IACjD,MAAM,kJAAkB,CACrB,KAAK,CAAC,4IAAgB,EACtB,KAAK,CAAC,OAAO,EAAE,GAAG,EAAE,KAAK,EAAE;QAC1B,MAAM,gBAAgB,MAAM,IAAI,EAAE,CAAC,YAAY,CAAC,QAAQ,CAAC;YACvD,OAAO;gBAAE,QAAQ,IAAI,OAAO,CAAC,IAAI,CAAC,EAAE;YAAC;YACrC,MAAM,MAAM,KAAK,GAAG;YACpB,QAAQ,MAAM,MAAM,GAAG;gBAAE,IAAI,MAAM,MAAM;YAAC,IAAI;YAC9C,SAAS;gBAAE,WAAW;YAAO;YAC7B,SAAS;gBACP,OAAO;oBACL,QAAQ;wBACN,IAAI;wBACJ,aAAa;wBACb,WAAW;oBACb;gBACF;gBACA,MAAM;oBACJ,QAAQ;wBACN,IAAI;wBACJ,OAAO;oBACT;gBACF;gBACA,SAAS;oBACP,QAAQ;wBACN,IAAI;oBACN;gBACF;YACF;QACF;QAEA,IAAI;QACJ,IAAI,cAAc,MAAM,GAAG,MAAM,KAAK,EAAE;YACtC,MAAM,WAAW,cAAc,GAAG;YAClC,aAAa,UAAU;QACzB;QAEA,OAAO;YAAE;YAAe;QAAW;IACrC;IAEF,aAAa,kJAAkB,CAAC,KAAK,CAAC,OAAO,EAAE,GAAG,EAAE;QAClD,MAAM,QAAQ,MAAM,IAAI,EAAE,CAAC,YAAY,CAAC,KAAK,CAAC;YAC5C,OAAO;gBACL,QAAQ,IAAI,OAAO,CAAC,IAAI,CAAC,EAAE;gBAC3B,MAAM;YACR;QACF;QAEA,OAAO;IACT;IAEA,YAAY,kJAAkB,CAC3B,KAAK,CAAC,uKAAC,CAAC,MAAM,CAAC;QAAE,IAAI,uKAAC,CAAC,MAAM;IAAG,IAChC,QAAQ,CAAC,OAAO,EAAE,GAAG,EAAE,KAAK,EAAE;QAC7B,MAAM,IAAI,EAAE,CAAC,YAAY,CAAC,MAAM,CAAC;YAC/B,OAAO;gBACL,IAAI,MAAM,EAAE;gBACZ,QAAQ,IAAI,OAAO,CAAC,IAAI,CAAC,EAAE;YAC7B;YACA,MAAM;gBAAE,MAAM;YAAK;QACrB;QAEA,OAAO;YAAE,SAAS;QAAK;IACzB;IAEF,eAAe,kJAAkB,CAAC,QAAQ,CAAC,OAAO,EAAE,GAAG,EAAE;QACvD,MAAM,IAAI,EAAE,CAAC,YAAY,CAAC,UAAU,CAAC;YACnC,OAAO;gBACL,QAAQ,IAAI,OAAO,CAAC,IAAI,CAAC,EAAE;gBAC3B,MAAM;YACR;YACA,MAAM;gBAAE,MAAM;YAAK;QACrB;QAEA,OAAO;YAAE,SAAS;QAAK;IACzB;AACF","debugId":null}},
    {"offset": {"line": 1639, "column": 0}, "map": {"version":3,"sources":["file:///Users/matejhrescak/src/draftboard/src/lib/r2.ts"],"sourcesContent":["import {\n  S3Client,\n  PutObjectCommand,\n  GetObjectCommand,\n} from \"@aws-sdk/client-s3\";\nimport { getSignedUrl } from \"@aws-sdk/s3-request-presigner\";\n\nconst R2_ACCOUNT_ID = process.env.R2_ACCOUNT_ID;\nconst R2_ACCESS_KEY_ID = process.env.R2_ACCESS_KEY_ID;\nconst R2_SECRET_ACCESS_KEY = process.env.R2_SECRET_ACCESS_KEY;\nconst R2_BUCKET_NAME = process.env.R2_BUCKET_NAME;\nconst R2_PUBLIC_URL = process.env.R2_PUBLIC_URL;\n\n// Check if R2 is configured\nexport function isR2Configured(): boolean {\n  return !!(R2_ACCOUNT_ID && R2_ACCESS_KEY_ID && R2_SECRET_ACCESS_KEY && R2_BUCKET_NAME);\n}\n\n// Only create S3 client if configured\nconst s3Client = isR2Configured()\n  ? new S3Client({\n      region: \"auto\",\n      endpoint: `https://${R2_ACCOUNT_ID}.r2.cloudflarestorage.com`,\n      credentials: {\n        accessKeyId: R2_ACCESS_KEY_ID!,\n        secretAccessKey: R2_SECRET_ACCESS_KEY!,\n      },\n    })\n  : null;\n\ninterface UploadUrlOptions {\n  filename: string;\n  contentType: string;\n  userId: string;\n}\n\nexport async function getPresignedUploadUrl({\n  filename,\n  contentType,\n  userId,\n}: UploadUrlOptions): Promise<{ uploadUrl: string; key: string; publicUrl: string }> {\n  if (!s3Client || !R2_BUCKET_NAME) {\n    throw new Error(\n      \"R2 storage is not configured. Please set R2_ACCOUNT_ID, R2_ACCESS_KEY_ID, R2_SECRET_ACCESS_KEY, and R2_BUCKET_NAME environment variables.\"\n    );\n  }\n\n  // Generate a unique key with user ID and timestamp\n  const timestamp = Date.now();\n  const sanitizedFilename = filename.replace(/[^a-zA-Z0-9.-]/g, \"_\");\n  const key = `uploads/${userId}/${timestamp}-${sanitizedFilename}`;\n\n  const command = new PutObjectCommand({\n    Bucket: R2_BUCKET_NAME,\n    Key: key,\n    ContentType: contentType,\n  });\n\n  const uploadUrl = await getSignedUrl(s3Client, command, { expiresIn: 3600 });\n\n  // Public URL for accessing the file after upload\n  const publicUrl = R2_PUBLIC_URL\n    ? `${R2_PUBLIC_URL}/${key}`\n    : `https://${R2_BUCKET_NAME}.${R2_ACCOUNT_ID}.r2.cloudflarestorage.com/${key}`;\n\n  return { uploadUrl, key, publicUrl };\n}\n\nexport async function getPresignedDownloadUrl(key: string): Promise<string> {\n  if (!s3Client || !R2_BUCKET_NAME) {\n    throw new Error(\n      \"R2 storage is not configured. Please set R2_ACCOUNT_ID, R2_ACCESS_KEY_ID, R2_SECRET_ACCESS_KEY, and R2_BUCKET_NAME environment variables.\"\n    );\n  }\n\n  const command = new GetObjectCommand({\n    Bucket: R2_BUCKET_NAME,\n    Key: key,\n  });\n\n  const url = await getSignedUrl(s3Client, command, { expiresIn: 3600 });\n  return url;\n}\n\nexport function getPublicUrl(key: string): string {\n  if (R2_PUBLIC_URL) {\n    return `${R2_PUBLIC_URL}/${key}`;\n  }\n  return `https://${R2_BUCKET_NAME}.${R2_ACCOUNT_ID}.r2.cloudflarestorage.com/${key}`;\n}\n\n// Helper to determine file type\nexport function getFileType(mimeType: string): \"IMAGE\" | \"VIDEO\" | \"FILE\" {\n  if (mimeType.startsWith(\"image/\")) return \"IMAGE\";\n  if (mimeType.startsWith(\"video/\")) return \"VIDEO\";\n  return \"FILE\";\n}\n\n// Helper to check if URL is a Figma URL\nexport function isFigmaUrl(url: string): boolean {\n  return url.includes(\"figma.com\");\n}\n\n// Helper to check if URL is a Loom URL\nexport function isLoomUrl(url: string): boolean {\n  return url.includes(\"loom.com\");\n}\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;AAAA;AAKA;;;AAEA,MAAM,gBAAgB,QAAQ,GAAG,CAAC,aAAa;AAC/C,MAAM,mBAAmB,QAAQ,GAAG,CAAC,gBAAgB;AACrD,MAAM,uBAAuB,QAAQ,GAAG,CAAC,oBAAoB;AAC7D,MAAM,iBAAiB,QAAQ,GAAG,CAAC,cAAc;AACjD,MAAM,gBAAgB,QAAQ,GAAG,CAAC,aAAa;AAGxC,SAAS;IACd,OAAO,CAAC,CAAC,CAAC,iBAAiB,oBAAoB,wBAAwB,cAAc;AACvF;AAEA,sCAAsC;AACtC,MAAM,WAAW,mBACb,IAAI,6JAAQ,CAAC;IACX,QAAQ;IACR,UAAU,CAAC,QAAQ,EAAE,cAAc,yBAAyB,CAAC;IAC7D,aAAa;QACX,aAAa;QACb,iBAAiB;IACnB;AACF,KACA;AAQG,eAAe,sBAAsB,EAC1C,QAAQ,EACR,WAAW,EACX,MAAM,EACW;IACjB,IAAI,CAAC,YAAY,CAAC,gBAAgB;QAChC,MAAM,IAAI,MACR;IAEJ;IAEA,mDAAmD;IACnD,MAAM,YAAY,KAAK,GAAG;IAC1B,MAAM,oBAAoB,SAAS,OAAO,CAAC,mBAAmB;IAC9D,MAAM,MAAM,CAAC,QAAQ,EAAE,OAAO,CAAC,EAAE,UAAU,CAAC,EAAE,mBAAmB;IAEjE,MAAM,UAAU,IAAI,qKAAgB,CAAC;QACnC,QAAQ;QACR,KAAK;QACL,aAAa;IACf;IAEA,MAAM,YAAY,MAAM,IAAA,wMAAY,EAAC,UAAU,SAAS;QAAE,WAAW;IAAK;IAE1E,iDAAiD;IACjD,MAAM,YAAY,gBACd,GAAG,cAAc,CAAC,EAAE,KAAK,GACzB,CAAC,QAAQ,EAAE,eAAe,CAAC,EAAE,cAAc,0BAA0B,EAAE,KAAK;IAEhF,OAAO;QAAE;QAAW;QAAK;IAAU;AACrC;AAEO,eAAe,wBAAwB,GAAW;IACvD,IAAI,CAAC,YAAY,CAAC,gBAAgB;QAChC,MAAM,IAAI,MACR;IAEJ;IAEA,MAAM,UAAU,IAAI,qKAAgB,CAAC;QACnC,QAAQ;QACR,KAAK;IACP;IAEA,MAAM,MAAM,MAAM,IAAA,wMAAY,EAAC,UAAU,SAAS;QAAE,WAAW;IAAK;IACpE,OAAO;AACT;AAEO,SAAS,aAAa,GAAW;IACtC,IAAI,eAAe;QACjB,OAAO,GAAG,cAAc,CAAC,EAAE,KAAK;IAClC;IACA,OAAO,CAAC,QAAQ,EAAE,eAAe,CAAC,EAAE,cAAc,0BAA0B,EAAE,KAAK;AACrF;AAGO,SAAS,YAAY,QAAgB;IAC1C,IAAI,SAAS,UAAU,CAAC,WAAW,OAAO;IAC1C,IAAI,SAAS,UAAU,CAAC,WAAW,OAAO;IAC1C,OAAO;AACT;AAGO,SAAS,WAAW,GAAW;IACpC,OAAO,IAAI,QAAQ,CAAC;AACtB;AAGO,SAAS,UAAU,GAAW;IACnC,OAAO,IAAI,QAAQ,CAAC;AACtB","debugId":null}},
    {"offset": {"line": 1734, "column": 0}, "map": {"version":3,"sources":["file:///Users/matejhrescak/src/draftboard/src/server/api/routers/upload.ts"],"sourcesContent":["import { TRPCError } from \"@trpc/server\";\nimport { z } from \"zod\";\nimport {\n  createTRPCRouter,\n  protectedProcedure,\n} from \"~/server/api/trpc\";\nimport { presignedUrlSchema } from \"~/lib/validators\";\nimport { getPresignedUploadUrl, getPresignedDownloadUrl, isR2Configured } from \"~/lib/r2\";\n\nexport const uploadRouter = createTRPCRouter({\n  getUploadUrl: protectedProcedure\n    .input(presignedUrlSchema)\n    .mutation(async ({ ctx, input }) => {\n      // Check if R2 is configured\n      if (!isR2Configured()) {\n        throw new TRPCError({\n          code: \"PRECONDITION_FAILED\",\n          message: \"File uploads are not configured. Please set up R2 storage credentials (R2_ACCOUNT_ID, R2_ACCESS_KEY_ID, R2_SECRET_ACCESS_KEY, R2_BUCKET_NAME) in your environment variables.\",\n        });\n      }\n\n      try {\n        const result = await getPresignedUploadUrl({\n          filename: input.filename,\n          contentType: input.contentType,\n          userId: ctx.session.user.id,\n        });\n\n        return result;\n      } catch (error) {\n        console.error(\"Error generating presigned URL:\", error);\n        throw new TRPCError({\n          code: \"INTERNAL_SERVER_ERROR\",\n          message: error instanceof Error ? error.message : \"Failed to generate upload URL\",\n        });\n      }\n    }),\n\n  getDownloadUrl: protectedProcedure\n    .input(z.object({ key: z.string() }))\n    .query(async ({ input }) => {\n      if (!isR2Configured()) {\n        throw new TRPCError({\n          code: \"PRECONDITION_FAILED\",\n          message: \"File downloads are not configured. Please set up R2 storage credentials.\",\n        });\n      }\n\n      try {\n        const url = await getPresignedDownloadUrl(input.key);\n        return { url };\n      } catch (error) {\n        console.error(\"Error generating download URL:\", error);\n        throw new TRPCError({\n          code: \"INTERNAL_SERVER_ERROR\",\n          message: error instanceof Error ? error.message : \"Failed to generate download URL\",\n        });\n      }\n    }),\n});\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;AAIA;AACA;;;;;;AAEO,MAAM,eAAe,IAAA,gJAAgB,EAAC;IAC3C,cAAc,kJAAkB,CAC7B,KAAK,CAAC,8IAAkB,EACxB,QAAQ,CAAC,OAAO,EAAE,GAAG,EAAE,KAAK,EAAE;QAC7B,4BAA4B;QAC5B,IAAI,CAAC,IAAA,kIAAc,KAAI;YACrB,MAAM,IAAI,6KAAS,CAAC;gBAClB,MAAM;gBACN,SAAS;YACX;QACF;QAEA,IAAI;YACF,MAAM,SAAS,MAAM,IAAA,yIAAqB,EAAC;gBACzC,UAAU,MAAM,QAAQ;gBACxB,aAAa,MAAM,WAAW;gBAC9B,QAAQ,IAAI,OAAO,CAAC,IAAI,CAAC,EAAE;YAC7B;YAEA,OAAO;QACT,EAAE,OAAO,OAAO;YACd,QAAQ,KAAK,CAAC,mCAAmC;YACjD,MAAM,IAAI,6KAAS,CAAC;gBAClB,MAAM;gBACN,SAAS,iBAAiB,QAAQ,MAAM,OAAO,GAAG;YACpD;QACF;IACF;IAEF,gBAAgB,kJAAkB,CAC/B,KAAK,CAAC,uKAAC,CAAC,MAAM,CAAC;QAAE,KAAK,uKAAC,CAAC,MAAM;IAAG,IACjC,KAAK,CAAC,OAAO,EAAE,KAAK,EAAE;QACrB,IAAI,CAAC,IAAA,kIAAc,KAAI;YACrB,MAAM,IAAI,6KAAS,CAAC;gBAClB,MAAM;gBACN,SAAS;YACX;QACF;QAEA,IAAI;YACF,MAAM,MAAM,MAAM,IAAA,2IAAuB,EAAC,MAAM,GAAG;YACnD,OAAO;gBAAE;YAAI;QACf,EAAE,OAAO,OAAO;YACd,QAAQ,KAAK,CAAC,kCAAkC;YAChD,MAAM,IAAI,6KAAS,CAAC;gBAClB,MAAM;gBACN,SAAS,iBAAiB,QAAQ,MAAM,OAAO,GAAG;YACpD;QACF;IACF;AACJ","debugId":null}},
    {"offset": {"line": 1799, "column": 0}, "map": {"version":3,"sources":["file:///Users/matejhrescak/src/draftboard/src/server/api/root.ts"],"sourcesContent":["import { createCallerFactory, createTRPCRouter } from \"~/server/api/trpc\";\nimport { postRouter } from \"~/server/api/routers/post\";\nimport { userRouter } from \"~/server/api/routers/user\";\nimport { commentRouter } from \"~/server/api/routers/comment\";\nimport { reactionRouter } from \"~/server/api/routers/reaction\";\nimport { projectRouter } from \"~/server/api/routers/project\";\nimport { notificationRouter } from \"~/server/api/routers/notification\";\nimport { uploadRouter } from \"~/server/api/routers/upload\";\n\nexport const appRouter = createTRPCRouter({\n  post: postRouter,\n  user: userRouter,\n  comment: commentRouter,\n  reaction: reactionRouter,\n  project: projectRouter,\n  notification: notificationRouter,\n  upload: uploadRouter,\n});\n\nexport type AppRouter = typeof appRouter;\n\nexport const createCaller = createCallerFactory(appRouter);\n"],"names":[],"mappings":";;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;AAEO,MAAM,YAAY,IAAA,gJAAgB,EAAC;IACxC,MAAM,qJAAU;IAChB,MAAM,qJAAU;IAChB,SAAS,2JAAa;IACtB,UAAU,6JAAc;IACxB,SAAS,2JAAa;IACtB,cAAc,qKAAkB;IAChC,QAAQ,yJAAY;AACtB;AAIO,MAAM,eAAe,IAAA,mJAAmB,EAAC","debugId":null}},
    {"offset": {"line": 1835, "column": 0}, "map": {"version":3,"sources":["file:///Users/matejhrescak/src/draftboard/src/lib/trpc/server.ts"],"sourcesContent":["import \"server-only\";\n\nimport { headers } from \"next/headers\";\nimport { cache } from \"react\";\n\nimport { createCaller, type AppRouter } from \"~/server/api/root\";\nimport { createTRPCContext } from \"~/server/api/trpc\";\n\nconst createContext = cache(async () => {\n  const heads = new Headers(await headers());\n  heads.set(\"x-trpc-source\", \"rsc\");\n\n  return createTRPCContext({\n    headers: heads,\n  });\n});\n\nexport const api = createCaller(createContext) as ReturnType<typeof createCaller>;\n"],"names":[],"mappings":";;;;AAAA;AAEA;AACA;AAEA;AACA;;;;;;AAEA,MAAM,gBAAgB,IAAA,8MAAK,EAAC;IAC1B,MAAM,QAAQ,IAAI,QAAQ,MAAM,IAAA,0IAAO;IACvC,MAAM,GAAG,CAAC,iBAAiB;IAE3B,OAAO,IAAA,iJAAiB,EAAC;QACvB,SAAS;IACX;AACF;AAEO,MAAM,MAAM,IAAA,4IAAY,EAAC","debugId":null}},
    {"offset": {"line": 1861, "column": 0}, "map": {"version":3,"sources":["file:///Users/matejhrescak/src/draftboard/src/components/projects/ProjectDetail.tsx/__nextjs-internal-proxy.mjs"],"sourcesContent":["// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport const ProjectDetail = registerClientReference(\n    function() { throw new Error(\"Attempted to call ProjectDetail() from the server but ProjectDetail is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/src/components/projects/ProjectDetail.tsx <module evaluation>\",\n    \"ProjectDetail\",\n);\n"],"names":[],"mappings":"AAAA,uEAAuE;;;;;AACvE;;AACO,MAAM,gBAAgB,IAAA,wQAAuB,EAChD;IAAa,MAAM,IAAI,MAAM;AAA0O,GACvQ,2EACA","ignoreList":[0],"debugId":null}},
    {"offset": {"line": 1875, "column": 0}, "map": {"version":3,"sources":["file:///Users/matejhrescak/src/draftboard/src/components/projects/ProjectDetail.tsx/__nextjs-internal-proxy.mjs"],"sourcesContent":["// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport const ProjectDetail = registerClientReference(\n    function() { throw new Error(\"Attempted to call ProjectDetail() from the server but ProjectDetail is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/src/components/projects/ProjectDetail.tsx\",\n    \"ProjectDetail\",\n);\n"],"names":[],"mappings":"AAAA,uEAAuE;;;;;AACvE;;AACO,MAAM,gBAAgB,IAAA,wQAAuB,EAChD;IAAa,MAAM,IAAI,MAAM;AAA0O,GACvQ,uDACA","ignoreList":[0],"debugId":null}},
    {"offset": {"line": 1889, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}},
    {"offset": {"line": 1897, "column": 0}, "map": {"version":3,"sources":["file:///Users/matejhrescak/src/draftboard/src/app/%28main%29/projects/%5Bid%5D/page.tsx"],"sourcesContent":["import { notFound } from \"next/navigation\";\nimport { api } from \"~/lib/trpc/server\";\nimport { ProjectDetail } from \"~/components/projects/ProjectDetail\";\n\ninterface ProjectPageProps {\n  params: Promise<{ id: string }>;\n}\n\nexport default async function ProjectPage({ params }: ProjectPageProps) {\n  const { id } = await params;\n\n  const project = await api.project.getById({ id }).catch(() => null);\n\n  if (!project) {\n    notFound();\n  }\n\n  return <ProjectDetail project={project} />;\n}\n"],"names":[],"mappings":";;;;;AAAA;AAAA;AACA;AACA;;;;;AAMe,eAAe,YAAY,EAAE,MAAM,EAAoB;IACpE,MAAM,EAAE,EAAE,EAAE,GAAG,MAAM;IAErB,MAAM,UAAU,MAAM,mIAAG,CAAC,OAAO,CAAC,OAAO,CAAC;QAAE;IAAG,GAAG,KAAK,CAAC,IAAM;IAE9D,IAAI,CAAC,SAAS;QACZ,IAAA,iMAAQ;IACV;IAEA,qBAAO,8OAAC,gKAAa;QAAC,SAAS;;;;;;AACjC","debugId":null}}]
}